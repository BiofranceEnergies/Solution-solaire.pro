<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="data:,">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- SEO principal -->
  <title>Prix installation photovoltaïque en Dordogne (24) | Estimation rapide</title>
  <meta name="description" content="Découvrez le prix d’une installation photovoltaïque en Dordogne (24). Estimation personnalisée de votre projet solaire, production, économies et coût en quelques secondes.">

  <link rel="canonical" href="https://www.solution-solaire.pro/24/prix.html">

  <!-- Open Graph -->
  <meta property="og:title" content="Prix installation photovoltaïque en Dordogne (24)">
  <meta property="og:description" content="Estimez rapidement le prix d’une installation photovoltaïque en Dordogne (24). Produisez votre propre électricité, calculez le coût et les économies en toute transparence.">

  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.solution-solaire.pro/24/prix.html">
  <meta property="og:image" content="https://www.solution-solaire.pro/24/og-image-24.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">


  <!-- Préconnexions -->
  <link rel="preconnect" href="https://raw.githubusercontent.com" crossorigin>
  <link rel="dns-prefetch" href="//raw.githubusercontent.com">
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
  <link rel="dns-prefetch" href="//www.googletagmanager.com">

  <!-- Google tag (gtag.js) – Consent Mode V2 + init différée -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-11242044118"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }

    // Consent par défaut (avant choix)
    gtag('consent', 'default', {
      ad_storage: 'denied',
      analytics_storage: 'denied',
      ad_user_data: 'denied',
      ad_personalization: 'denied',
      wait_for_update: 500
    });

    // Recommandations Google
    gtag('set', 'ads_data_redaction', true);
    gtag('set', 'url_passthrough', true);

    // Init différée (après consentement)
    window.__initAds = function(){
      gtag('js', new Date());
      gtag('config', 'AW-11242044118'); // Ajouter GA4 si besoin
    };
  </script>

  <!-- Conversion Google Ads -->
  <script>
    function gtag_report_conversion() {
      try {
        gtag('event', 'conversion', { send_to: 'AW-11242044118/MslOCKGZzo0bENb1z_Ap' });
      } catch(e) {}
      return true;
    }
  </script>

  <style>
    :root{
      --bg:#0f172a; --card:#0b1222; --paper:#0b1428;
      --text:#e5e7eb; --muted:#9ca3af; --border:#1f2937;
      --accent:#2563eb; --accent2:#3b82f6; --accent-hover:#1e40af;
      --ok:#22c55e; --radius:14px; --shadow:0 14px 36px rgba(2,6,23,.35);
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    img{max-width:100%;height:auto}

    /* Conteneur principal */
    .wrap { max-width:980px; margin:0 auto; padding:28px 14px; }

    .logo{display:block;margin:0 auto 6px;width:92px;height:auto;filter:drop-shadow(0 2px 8px rgba(0,0,0,.35))}
    h1{font-size:clamp(24px,3.2vw,36px);text-align:center;color:#c7d2fe;margin:6px 0 8px 0;font-weight:800;line-height:1.18}
    h2{font-size:clamp(18px,2.2vw,22px);text-align:center;color:#a5b4fc;margin:0 0 10px 0;font-weight:700}
    .lead-sub{color:var(--muted);text-align:center;margin:8px auto 14px auto}

    .card{background:linear-gradient(180deg,var(--card),#0a1020);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;margin:0 auto 18px auto}
    .form-section{max-width:720px}
    .inputs{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:640px){.inputs{grid-template-columns:1fr}}
    input,button{width:100%;padding:12px 14px;border-radius:12px;border:1.5px solid #1e3a5f;background:#0a1326;color:#e5e7eb;font-size:17px}
    input::placeholder{color:#8aa0c2}
    a.helper{color:#93c5fd;text-decoration:underline;font-size:14px}

    /* CTA plus contrastée */
    button.primary{
      background: linear-gradient(90deg,#60a5fa,#3b82f6);
      color:#fff;
      border:0;
      font-weight:900; letter-spacing:.2px; cursor:pointer;
      box-shadow:0 8px 22px rgba(59,130,246,.35);
    }
    button.primary:hover{ filter:brightness(1.05); }
    button.primary:focus{ outline:2px solid #bfdbfe; outline-offset:2px; }

    .counter-wrap{display:flex;justify-content:center;margin:8px 0 18px 0}
    .counter-badge{display:inline-block;background:linear-gradient(180deg,#0b1324,#0b0f1a);color:#dbeafe;border:1px solid #1f2b4a;border-radius:999px;padding:10px 18px;font-weight:800;letter-spacing:.3px;box-shadow:var(--shadow)}

    .recap{max-width:720px}
    .recap-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:560px){.recap-grid{grid-template-columns:1fr}}
    .recap-item{background:#0a1326;border:1px dashed #1e3a5f;border-radius:12px;padding:12px 14px}
    .recap-item .label{color:#93c5fd;font-size:13px}
    .note { display: block; text-align: center; margin: 14px 0; color: #86efac; font-weight: 700; font-size: clamp(16px, 1.4vw, 20px); }

    .kpi{max-width:720px}
    .kpi-box{padding:10px 12px;border-radius:12px;background:#0a1326;border:1px dashed #1e3a5f;margin-bottom:10px}
    .kpi-box b{color:var(--ok)}

    #lockedSection{max-width:720px;position:relative}
    .lockedContent{filter:blur(7px);user-select:none;pointer-events:none}
    .veil{position:absolute;inset:0;border-radius:var(--radius);background:linear-gradient(180deg,rgba(15,23,42,.35),rgba(15,23,42,.86));backdrop-filter:blur(2px);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;text-align:center;padding:20px;border:1px solid #244a7d}
    .unlock{display:grid;grid-template-columns:1fr 1fr;gap:10px;max-width:560px;width:100%}
    @media(max-width:580px){.unlock{grid-template-columns:1fr}}
    .unlock input{background:#0c1730;border:1.5px solid #244a7d}
    .consent{display:flex;gap:8px;align-items:flex-start;color:#cbd5e1;font-size:13px;text-align:left}
    .consent input{width:auto;margin-top:3px}

    /* Mentions légales (visibles par défaut) */
    #mentions-legales-container{width:100%;text-align:center;margin:26px 0 8px 0;display:block}
    #mentions-legales-link{color:#93c5fd;text-decoration:underline;cursor:pointer}
    #mentions-popup{display:none;position:fixed;bottom:60px;left:50%;transform:translateX(-50%);width:340px;max-width:95vw;background:#0b1222;color:#e5e7eb;border-radius:13px;box-shadow:0 8px 32px rgba(0,0,0,.45);padding:18px 20px 12px 20px;z-index:10000;font-size:13px;line-height:1.7;border:1px solid #244a7d}
    #close-mentions{position:absolute;top:6px;right:12px;background:none;color:#e5e7eb;border:none;font-size:18px;font-weight:bold;cursor:pointer;padding:0}

    .sep{border:none;border-top:2px solid var(--border);margin:30px 0 16px 0}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}

    /* — Ce que nous vous proposons — */
    .propo { margin: 8px 0 14px 0; }
    .propo-title{ font-weight:800; color:#dbeafe; margin-bottom:10px; letter-spacing:.2px }
    .propo-list{ list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:10px }
    .propo-list li{ background:#0a1326; border:1px dashed #244a7d; border-radius:12px; padding:10px 12px; color:#e5e7eb }
    .point-title{ font-weight:700; color:#dbeafe }
    .badge{ display:inline-block; padding:2px 8px; border-radius:999px; background:linear-gradient(180deg,#0b1324,#0b0f1a); border:1px solid #1f2b4a; font-weight:900; color:#fde68a }

    /* — Financement — */
    .financement-bloc{ background:#0a1326; border-left:4px solid #2563eb; border-radius:12px; padding:14px; margin-top:12px; color:#e5e7eb }
    .financement-conditions{ margin-bottom:10px; line-height:1.6 }
    .badge-fin{ display:inline-block; background:#1e3a5f; color:#fff; padding:2px 8px; border-radius:999px; font-weight:700; font-size:0.9em }
    .badge-fin--clair{ background:#0f213a }
    .prix-install{ margin-bottom:14px; line-height:1.6 }
    .option-fin{ margin:10px 0 8px 0; color:#93c5fd; font-weight:700; letter-spacing:.2px }
    .hint{ color:#a7b6d6; font-size:.82em; margin-left:8px; opacity:.9 }
    .financement-warning{ color:#9ca3af; font-size:12px; font-weight:400; margin-top:8px }
    .financement-note{ color:#9ca3af; font-size:12px; margin-top:6px }
    .offre-speciale{ background: linear-gradient(180deg, #10243e, #0e2038); border: 1px solid #1e3a8a; border-radius: 14px; padding: 18px; text-align: center; margin: 16px 0; box-shadow: 0 10px 26px rgba(2,6,23,.35); }
    .offre-titre{ color:#fde047; font-weight:800; font-size:1.08rem; margin-bottom:10px; letter-spacing:.2px }
    .offre-montant{ display:flex; justify-content:center; align-items:center; gap:10px; font-size:1.35rem; font-weight:800; color:#fff; margin-bottom:4px; }
    .badge-offre{ display:inline-block; background:#2563eb; color:#fff; padding:8px 14px; border-radius:999px; font-weight:900; font-size:1.1rem; box-shadow: 0 6px 16px rgba(37,99,235,.35); }
    .offre-sous-titre{ font-size:.92rem; color:#cbd5e1; margin-bottom:10px }
    .offre-conditions{ font size:.88rem; color:#a7b6d6 }

    /* — Témoignages — */
    .temoins{ background: linear-gradient(180deg,#0b1428,#0a1224); border:1px solid #1e3a5f; border-radius:14px; padding:18px; box-shadow:0 14px 36px rgba(2,6,23,.35); max-width:720px; margin:0 auto 18px auto;}
    .temoins h2{ color:#a5b4fc; margin:0 0 14px 0; font-weight:800 }
    .temoins-list{ display:grid; gap:12px }
    .temoin{ background:#0a1326; border:1px dashed #244a7d; border-radius:12px; padding:12px 14px 12px 44px; position:relative; transition:all .18s ease }
    .temoin svg{ position:absolute; left:12px; top:12px; width:22px; height:22px; opacity:.9; filter:drop-shadow(0 2px 8px rgba(0,0,0,.25)) }
    .temoin blockquote{ margin:0; color:#e5e7eb; font-size:15.5px; line-height:1.6 }
    .temoin cite{ display:block; margin-top:6px; color:#9fb3d9; font-style:italic; font-size:14px }
    .temoin strong{ color:#dbeafe; font-weight:700 }
    .temoin:hover{ border-color:#2a5aa0; transform:translateY(-1px) }

    /* Overlay calcul */
    body.no-scroll { overflow: hidden; }
    #calc-overlay{
      position: fixed; inset: 0;
      background: rgba(2, 6, 23, 0.72);
      backdrop-filter: blur(2px);
      display: none;
      z-index: 9998;
      align-items: center; justify-content: center;
      padding: 20px;
    }
    #calc-overlay .panel{
      width: 100%; max-width: 360px;
      background: #0b1222;
      border: 1px solid #244a7d;
      border-radius: 14px;
      box-shadow: var(--shadow);
      padding: 18px;
      text-align: center;
      outline: none;
    }
    #calc-overlay .spinner{
      width: 42px; height: 42px;
      margin: 6px auto 12px auto;
      border: 4px solid #1f2b4a;
      border-top: 4px solid var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    #calc-overlay .title{ color:#bfdbfe; font-weight:800; margin: 0 0 6px 0; }
    #calc-overlay .desc{ color:#cbd5e1; font-size: 14px; margin: 0; }
    @media (prefers-reduced-motion: reduce){ #calc-overlay .spinner{ animation: none; } }

    /* --- Bandeau cookies (restyle) --- */
    .consent-banner { position: fixed; left: 0; right: 0; bottom: 0; background: #0a1326; border-top: 1px solid #1f2b4a; color: #e2e8f0; padding: 12px; z-index: 9999; display: none; box-shadow: 0 -6px 26px rgba(0,0,0,.35); font: 14px/1.5 system-ui,Segoe UI,Roboto; min-height: 56px; will-change: opacity, transform; }
    .consent-inner { max-width: 900px; margin: 0 auto; display: flex; gap: 14px; align-items: center; justify-content: space-between; flex-wrap: wrap; }
    .consent-text { flex: 1 1 520px; font-size: 14px; color: #cbd5e1; }
    .consent-buttons { display: flex; gap: 10px; }
    .consent-btn { padding: 8px 16px; border-radius: 999px; font-weight: 700; cursor: pointer; border: none; font-size: 14px; transition: all 0.2s ease; }
    .consent-btn.reject { background: #1e293b; color: #e2e8f0; }
    .consent-btn.reject:hover { background: #334155; }
    .consent-btn.accept { background: linear-gradient(90deg,#22c55e,#16a34a); color: #fff; font-weight: 800; box-shadow: 0 4px 12px rgba(34,197,94,.35); }
    .consent-btn.accept:hover { background: #15803d; }

    /* --- Accordéon SEO --- */
    #bloc-seo { max-width:720px; }
    #bloc-seo details {
      border: 1px solid #1f2b4a;
      border-radius: 12px;
      margin: 10px 0;
      background: #0a1326;
      overflow: hidden;
    }
    #bloc-seo summary {
      cursor: pointer;
      padding: 12px 14px;
      font-weight: 700;
      color: #a5b4fc;
      display: flex;
      align-items: center;
      justify-content: space-between;
      list-style: none;
    }
    #bloc-seo summary::-webkit-details-marker { display: none; }
    #bloc-seo details[open] summary {
      background: #0b1428;
      border-bottom: 1px solid #1f2b4a;
    }
    #bloc-seo details p {
      margin: 0;
      padding: 12px 14px;
      color: #e5e7eb;
      font-size: 15px;
      line-height: 1.55;
    }
    #bloc-seo summary::after {
      content: "▸";
      font-size: 16px;
      transition: transform 0.2s ease;
      color: #93c5fd;
    }
    #bloc-seo details[open] summary::after { transform: rotate(90deg); }
    #bloc-seo summary h2{display:inline;margin:0;color:#a5b4fc;font-size:clamp(18px,2.2vw,22px);font-weight:700;text-align:left}

    /* === VARIANTE B : Encadré plus présent pour .card.form-section === */
    .card.form-section{
      position: relative;
      background: linear-gradient(180deg,#0b1222 0%, #0b1324 60%, #0a1020 100%);
      border: 1px solid rgba(99,147,216,.22);
      box-shadow:
        0 16px 40px rgba(2,6,23,.55),
        0 1px 0 rgba(147,197,253,.10) inset;
      padding: 24px 18px;
    }
    .card.form-section::before{
      content:"";
      position:absolute; inset:-1px;
      border-radius: var(--radius);
      pointer-events:none;
      background:
        linear-gradient(180deg, rgba(147,197,253,.10), transparent 30%) padding-box,
        radial-gradient(60% 40% at 50% -10%, rgba(59,130,246,.22), transparent 60%) border-box;
    }
    .card.form-section > h2{
      color:#f1f5ff; font-weight:900; letter-spacing:.25px;
      text-align:center; margin:2px 0 12px 0;
    }
    .card.form-section > h2::after{
      content:""; display:block; width:140px; height:2px;
      margin:10px auto 2px;
      background: linear-gradient(90deg,transparent,#93c5fd 35%,#3b82f6 65%,transparent);
      opacity:.65;
    }
    .card.form-section .inputs{ gap:16px; }
    .card.form-section input{
      background:#0a1326; border:1.6px solid #204067;
      transition:border-color .18s, box-shadow .18s, background .18s;
    }
    .card.form-section input:focus{
      outline:none; border-color:#4e93ff;
      box-shadow:0 0 0 3px rgba(78,147,255,.20);
      background:#0b162e;
    }
    .card.form-section .primary{
      font-size:17px; padding:15px 18px; border-radius:12px;
      box-shadow:0 12px 28px rgba(59,130,246,.38), 0 1px 0 rgba(255,255,255,.10) inset;
    }
    .card.form-section .primary + div{
      margin-top:12px !important; padding-top:10px; border-top:1px dashed #1f2b4a;
    }
    @media (max-width:480px){
      .card.form-section{ padding:20px 14px; }
    }
  </style>
</head>
<body>

  <!-- Bandeau Consent Mode V2 -->
  <div id="consent-banner" class="consent-banner" role="dialog" aria-live="polite" aria-label="Préférences de confidentialité">
    <div class="consent-inner">
      <div class="consent-text">
        Nous utilisons des technologies pour la mesure et la publicité.
        Vous pouvez refuser.
      </div>
      <div class="consent-buttons">
        <button id="consent-reject" class="consent-btn reject" type="button">Tout refuser</button>
        <button id="consent-accept" class="consent-btn accept" type="button">Tout accepter</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <!-- Logo -->
    <img src="https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/52db4f3ab1c38909b33d9037e74d7371c32a9cf5/logo%20SSP.webp"
         alt="Logo Solution Solaire Pro"
         class="logo"
         width="184" height="92"
         fetchpriority="high"
         decoding="async">

    <!-- Compteur dynamique -->
    <div class="counter-wrap">
      <div class="counter-badge">
        <span id="compteurValeur" style="font-weight:900;letter-spacing:.5px">1 234</span>
        <span style="opacity:.85"> simulations depuis le 1ᵉʳ mai 2025</span>
      </div>
    </div>

    <!-- Accroche principale -->
    <h1 style="margin:6px 0 4px 0">Prix installation photovoltaïque en Dordogne (24)</h1>


    <p class="lead-sub" style="margin:6px auto 6px auto;max-width:760px;font-size:14px;line-height:1.45;color:#9ca3af;text-align:center">
      Obtenez une estimation claire&nbsp;: prix de l’installation, production attendue et économies possibles — en une minute.
    </p>

    <div class="lead-sub" style="text-align:center; margin:6px auto 10px auto;">
      <span style="display:inline-block;background:linear-gradient(90deg,#2563eb,#3b82f6);color:#fff;padding:7px 12px;border-radius:999px;font-weight:700;font-size:14.5px;box-shadow:0 3px 10px rgba(37,99,235,.28);">
        Prix, production et économies en 30 s • Estimation en temps réel
      </span>
    </div>

    <!-- H2 SEO visible -->
    <h2 id="prix">Combien coûte une installation&nbsp;?</h2>


    <!-- Formulaire -->
    <div class="card form-section">
      <h2>Simulation personnalisée</h2>
      <form onsubmit="calculerSimulation(); return false;" novalidate>
        <div class="inputs" style="margin-bottom:8px">
          <input type="text" id="codePostal" placeholder="Votre code postal" maxlength="5"
                 inputmode="numeric" pattern="[0-9]{5}" autocomplete="postal-code" autofocus>
          <input type="text" id="facture" placeholder="Votre facture élec /an (ex : 1800 €)"
                 inputmode="decimal" autocomplete="off">
        </div>
        <div id="modeAvance" style="display:none;">
          <input type="text" id="conso" placeholder="Conso annuelle (kWh, optionnel)" inputmode="decimal" autocomplete="off">
        </div>
        <a href="#" id="lienAvance" class="helper">➕ Vous connaissez votre consommation annuelle ? Cliquez ici pour une estimation ultra-précise</a>
        <div style="margin-top:6px;font-size:13px;color:#a7b6d6;text-align:center">Pas votre conso ? La facture suffit.</div>
        <div style="height:10px"></div>
        <button id="simuler" type="submit" class="primary" aria-label="Obtenir mon estimation photovoltaïque">🔍 Obtenir mon estimation</button>
        <div style="margin-top:8px;font-size:14px;color:#93c5fd;text-align:center">
          ⚡ <strong>Résultat instantané :</strong> production, prix TTC et option de financement calculés en temps réel.
        </div>
      </form>
    </div>

    <!-- ===== Sections SEO ciblées (à masquer après simulation) ===== -->
    <div class="card" style="max-width:720px" data-hide-after-sim="1" id="bloc-seo">
      <h2 style="text-align:left;margin-bottom:8px">Questions fréquentes</h2>

      <!-- 1. Prix installation -->
      <details>
        <summary><h2 style="display:inline">Prix, production et économies : notre méthode</h2></summary>
        <p>
          Le coût dépend de la puissance posée, du nombre de modules et des contraintes de toiture.
          Notre outil calcule un prix TTC indicatif et met en regard la production estimée et les économies attendues.
        </p>
      </details>

      <!-- 2. Devis -->
      <details>
        <summary><h2 style="display:inline">Obtenir un devis</h2></summary>
        <p>
          Lancez la simulation ci-dessus : vous obtenez un chiffrage clair (matériel, pose, démarches).
          Débloquez ensuite l’étude complète pour recevoir votre devis personnalisé.
        </p>
      </details>

      <!-- 3. Simulateur -->
      <details>
        <summary><h2 style="display:inline">Le simulateur, en pratique</h2></summary>
        <p>
          Saisissez votre facture (et, si vous l’avez, votre consommation).
          Le simulateur estime la puissance conseillée, le nombre de panneaux et la production annuelle, puis projette vos économies en autoconsommation.
        </p>
      </details>

      <!-- 4. Production -->
      <details>
        <summary><h2 style="display:inline">Production estimée</h2></summary>
        <p>
          La production tient compte d’un rendement réaliste et d’un taux d’utilisation.
          L’objectif est de fournir un ordre de grandeur fiable avant visite technique.
        </p>
      </details>

      <!-- 5. Facture électricité par surface & chauffage -->
      <details>
        <summary><h2 style="display:inline">Facture d’électricité selon surface et chauffage (4 pers.)</h2></summary>

        <p>
          Repères de facture annuelle pour une maison de 4 personnes en climat tempéré (Dordogne), logement standard rénové (DPE C–D).
          Objectif : aider à saisir une valeur si vous n’avez pas votre facture sous la main.
        </p>

        <p><em>Lecture :</em> convecteurs = tout élec (facture haute) • PAC = chauffage électrique optimisé (intermédiaire) •
          Fioul/Gaz/Bois = chauffage non électrique (l’électricité couvre surtout usages domestiques + ECS).</p>

        <!-- Styles responsives, strictement scoped -->
        <style>
          .rtable-pv { width:100%; border-collapse:collapse; font-size:15px; }
          .rtable-pv th, .rtable-pv td { padding:6px 8px; border-bottom:1px solid #1f2b4a; }
          .rtable-pv th { text-align:left; }
          .rtable-pv td.num, .rtable-pv th.num { text-align:right; }
          @media (max-width: 560px){
            .rtable-pv thead { display:none; }
            .rtable-pv, .rtable-pv tbody, .rtable-pv tr, .rtable-pv td { display:block; width:100%; }
            .rtable-pv tr {
              background:#0a1326; border:1px solid #1f2b4a; border-radius:12px;
              padding:6px 10px; margin:10px 0;
            }
            .rtable-pv td { border:none; padding:6px 0; }
            .rtable-pv td[data-label]::before {
              content: attr(data-label);
              display:inline-block; margin-right:10px; color:#93c5fd; font-weight:700;
            }
            .rtable-pv td.surface { font-weight:800; color:#dbeafe; padding-bottom:2px; }
          }
          .rtable-pv td.surface { font-weight:800; color:#dbeafe; padding-bottom:2px; }


/* === Styles pour le nouveau .veil === */

/* Titre + sous-titre */
.pw-head{text-align:center;margin:2px 0 10px}
.pw-title{margin:0;color:#f1f5ff;font-weight:900;letter-spacing:.25px}
.pw-title::after{
  content:"";display:block;width:140px;height:2px;margin:10px auto 2px;
  background:linear-gradient(90deg,transparent,#93c5fd 35%,#3b82f6 65%,transparent);opacity:.65;
}
.pw-sub{color:#cbd5e1;font-size:13.5px;margin:4px auto 0;max-width:65ch}

/* Badges de réassurance */
.trust-list{
  display:flex;justify-content:center;gap:8px 12px;flex-wrap:wrap;
  list-style:none;padding:0;margin:10px 0 16px;
}
.trust-badge{
  display:inline-flex;align-items:center;gap:6px;white-space:nowrap;
  background:#0b162e;border:1px solid #1f2b4a;border-radius:999px;
  padding:6px 12px;font-size:12.5px;color:#cfe1ff;font-weight:700;line-height:1;
}

/* Champs du formulaire */
.field{display:flex;flex-direction:column;gap:6px}
.label{font-size:13px;color:#cbd5e1;font-weight:700;line-height:1.2}
.help{color:#9ca3af;font-size:12px;margin-top:2px;max-width:36ch}
</style>

        <table class="rtable-pv">
          <thead>
            <tr>
              <th>Surface</th>
              <th class="num">Convecteurs (tout élec)</th>
              <th class="num">PAC</th>
              <th class="num">Fioul / Gaz / Bois</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="surface" data-label="Surface">110 m²</td>
              <td class="num" data-label="Convecteurs (tout élec)">≈ 3 600 €</td>
              <td class="num" data-label="PAC">≈ 2 050 €</td>
              <td class="num" data-label="Fioul / Gaz / Bois">≈ 1 150 €</td>
            </tr>
            <tr>
              <td class="surface" data-label="Surface">120 m²</td>
              <td class="num" data-label="Convecteurs (tout élec)">≈ 3 800 €</td>
              <td class="num" data-label="PAC">≈ 2 150 €</td>
              <td class="num" data-label="Fioul / Gaz / Bois">≈ 1 200 €</td>
            </tr>
            <tr>
              <td class="surface" data-label="Surface">130 m²</td>
              <td class="num" data-label="Convecteurs (tout élec)">≈ 4 000 €</td>
              <td class="num" data-label="PAC">≈ 2 250 €</td>
              <td class="num" data-label="Fioul / Gaz / Bois">≈ 1 250 €</td>
            </tr>
            <tr>
              <td class="surface" data-label="Surface">140 m²</td>
              <td class="num" data-label="Convecteurs (tout élec)">≈ 4 200 €</td>
              <td class="num" data-label="PAC">≈ 2 350 €</td>
              <td class="num" data-label="Fioul / Gaz / Bois">≈ 1 300 €</td>
            </tr>
            <tr>
              <td class="surface" data-label="Surface">150 m²</td>
              <td class="num" data-label="Convecteurs (tout élec)">≈ 4 400 €</td>
              <td class="num" data-label="PAC">≈ 2 450 €</td>
              <td class="num" data-label="Fioul / Gaz / Bois">≈ 1 350 €</td>
            </tr>
          </tbody>
        </table>

        <p style="margin-top:12px">
          ✅ Pour un <strong>chiffrage fiable et personnalisé</strong>, saisissez votre <strong>vraie facture annuelle</strong> dans le simulateur ci-dessus.
          Le dimensionnement et les économies sont alors calculés à partir de vos données.
        </p>

        <p style="margin-top:6px;color:#93c5fd">
          Ajustements rapides : DPE A–B ≈ –20 % • DPE E–F ≈ +25 % • DPE G ≈ +50 % • ±1 personne ≈ ±10 %.  
          ECS non électrique (côté fioul/gaz/bois)&nbsp;: retirez ~200 €.
        </p>
      </details>

    </div>

    <!-- ===== Fin sections SEO ===== -->

    <!-- Témoignages (à masquer après simulation) -->
    <div class="card temoins" data-hide-after-sim="1" id="bloc-temoins">
      <h2>Ils l'ont testé</h2>
      <div class="temoins-list">
        <div class="temoin">
          <svg viewBox="0 0 24 24" fill="#2563eb" aria-hidden="true"><path d="M7.2 5.5C4.9 7.1 3.5 9.5 3.5 12.3c0 3 2.1 5.2 4.9 5.2 2.3 0 4.1-1.8 4.1-4.2 0-2.4-1.8-4.2-4.1-4.2-.5 0-1 .1-1.5.3.3-1.5 1.1-2.7 2.4-3.6l-2-0.3z"/></svg>
          <blockquote>
            “En moins de 2 minutes, j’ai obtenu un prix précis et le montant de mes économies.
            L’étude complète s’est affichée immédiatement après déblocage.
            Aucun démarchage, juste les infos utiles.”
          </blockquote>
          <cite>— <strong>Michel L.</strong>, Périgueux</cite>
        </div>
        <div class="temoin">
          <svg viewBox="0 0 24 24" fill="#2563eb" aria-hidden="true"><path d="M7.2 5.5C4.9 7.1 3.5 9.5 3.5 12.3c0 3 2.1 5.2 4.9 5.2 2.3 0 4.1-1.8 4.1-4.2 0-2.4-1.8-4.2-4.1-4.2-.5 0-1 .1-1.5.3.3-1.5 1.1-2.7 2.4-3.6l-2.1-.3z"/></svg>
          <blockquote>
            “Process simple et clair.
            Les étapes sont rapides et l’étude personnalisée est limpide.
            Je me suis sentie en confiance du début à la fin.”
          </blockquote>
          <cite>— <strong>Sophie G.</strong>, Sarlat</cite>
        </div>
        <div class="temoin">
          <svg viewBox="0 0 24 24" fill="#2563eb" aria-hidden="true"><path d="M7.2 5.5C4.9 7.1 3.5 9.5 3.5 12.3c0 3 2.1 5.2 4.9 5.2 2.3 0 4.1-1.8 4.1-4.2 0-2.4-1.8-4.2-4.1-4.2-.5 0-1 .1-1.5.3.3-1.5 1.1-2.7 2.4-3.6l-2.1-.3z"/></svg>
          <blockquote>
            “Chiffrage détaillé affiché instantanément, avec toutes les infos dont j’avais besoin.
            Sérieux, rapide et transparent.”
          </blockquote>
          <cite>— <strong>Paul D.</strong>, Ribérac</cite>
        </div>
        <div class="temoin">
          <svg viewBox="0 0 24 24" fill="#2563eb" aria-hidden="true"><path d="M7.2 5.5C4.9 7.1 3.5 9.5 3.5 12.3c0 3 2.1 5.2 4.9 5.2 2.3 0 4.1-1.8 4.1-4.2 0-2.4-1.8-4.2-4.1-4.2-.5 0-1 .1-1.5.3.3-1.5 1.1-2.7 2.4-3.6l-2.1-.3z"/></svg>
          <blockquote>
            “Le simulateur m’a montré plus de 1 000 € d’économies possibles la 1ʳᵉ année.
            Présentation claire, affichée à l’écran, et aucune sollicitation derrière.
            Ça met en confiance.”
          </blockquote>
          <cite>— <strong>Claire M.</strong>, Nontron</cite>
        </div>
      </div>
    </div>

    <!-- Récap -->
    <div id="recap" class="card recap" style="display:none;visibility:hidden;height:0;overflow:hidden;"></div>

    <!-- KPI 1 -->
    <div id="kpi1" class="card kpi" style="display:none;visibility:hidden;height:0;overflow:hidden;"></div>

    <!-- SECTION VERROUILLÉE -->
    <div id="lockedSection" class="card" style="display:none;visibility:hidden;height:0;overflow:hidden;">
      <div id="lockedContent" class="lockedContent"></div>
      <div class="veil" id="veil">
        <div class="pw-head">
          <h2 class="pw-title"><span aria-hidden="true">📊</span> Affichez votre étude complète personnalisée</h2>
          <p class="pw-sub">
            Accédez au détail de vos économies ,
            à la projection sur 15 ans et à votre offre personnalisée.
          </p>
        </div>

        <ul class="trust-list" aria-label="Réassurances">
          <li class="trust-badge">🔒 Données protégées</li>
          <li class="trust-badge">💬 SMS unique (pas de démarchage massif)</li>
          <li class="trust-badge">🏠 Visite réelle indispensable pour confirmer votre étude</li>
        </ul>

        <div class="unlock" style="margin-top:10px">
          <!-- Email optionnel -->
          <div class="field">
            <label for="emailUnlock" class="label">Email <span style="color:#9ca3af;font-weight:600">(optionnel)</span></label>
            <input type="email" id="emailUnlock" placeholder="votre@email.fr" autocomplete="email">
            <div class="help">Facultatif : pour recevoir un récapitulatif ultérieurement.</div>
          </div>

          <!-- Téléphone obligatoire -->
          <div class="field">
            <label for="telUnlock" class="label">Téléphone <span>(obligatoire)</span></label>
            <input type="tel" id="telUnlock" placeholder="06 12 34 56 78" autocomplete="tel" required>
            <div class="help">
              Un SMS unique confirmera la prise en compte de votre étude.<br>
              Un conseiller pourra ensuite vous appeler, <strong>si vous le souhaitez</strong>,
              pour échanger sur votre projet ou convenir d’une visite technique — <strong>sans engagement</strong>.
            </div>
          </div>

          <!-- Consentement -->
          <label class="consent" style="grid-column:1/-1">
            <input type="checkbox" id="rgpdUnlock" required>
            <span>J’autorise Solution Solaire Pro à me recontacter <strong>au sujet de mon étude</strong>. (requis)</span>
          </label>

          <!-- CTA -->
          <button type="button" class="primary" style="grid-column:1/-1" onclick="submitUnlock(event)">
            <span aria-hidden="true">📊</span> Voir mon étude complète et mes économies
          </button>

          <div class="foot" style="grid-column:1/-1;text-align:center;color:#9ca3af;font-size:12px;margin-top:8px">
            Affichage immédiat à l’écran — aucun démarchage massif.
          </div>
        </div>
      </div>
    </div> 

    <!-- Mentions (visibles au chargement) -->
    <div id="mentions-legales-container">
      <span id="mentions-legales-link">Mentions légales</span>
    </div>
    <div id="mentions-popup" role="dialog" aria-modal="true" aria-labelledby="mentions-title">
      <button id="close-mentions" type="button" aria-label="Fermer">&times;</button>
      <strong id="mentions-title">Mentions légales :</strong><br>
     Solution Solaire Pro partenaire de Biofrance Energies<br>
      SIRET : 422 231 928 00025<br>
      Adresse : 4 rue du Pont Saint Jean, 27530 Ézy-sur-Eure<br>
      Contact : solutionsolairepro@gmail.com br>
      Hébergeur : GitHub Pages, 88 Colin P. Kelly Jr. Street, San Francisco, CA 94107, USA<br>
      Données personnelles : Les informations saisies sont utilisées uniquement pour traiter votre demande. Aucun démarchage ni revente.<br>
      RGPD : Vous pouvez demander la suppression de vos données à tout moment par simple email.
    </div>

    <hr class="sep">
  </div>

  <!-- ===== Overlay de calcul (plein écran) ===== -->
  <div id="calc-overlay" role="alertdialog" aria-modal="true" aria-labelledby="calc-title" aria-describedby="calc-desc">
    <div class="panel" tabindex="-1">
      <div class="spinner" aria-hidden="true"></div>
      <h3 id="calc-title" class="title">Calcul en cours…</h3>
      <p id="calc-desc" class="desc">Nous générons votre estimation (quelques secondes).</p>
    </div>
  </div>

  <script>
    /* --- HELPERS MASQUAGE APRÈS SIMULATION --- */
    function hideAfterSimulationBlocks() {
      document.querySelectorAll('[data-hide-after-sim]')
        .forEach(el => { el.style.display = 'none'; });
    }
    function showAfterSimulationBlocks() {
      document.querySelectorAll('[data-hide-after-sim]')
        .forEach(el => { el.style.display = ''; });
    }

    /* --- MODE TEST & PERSISTANCE 24h --- */
    const qs = new URLSearchParams(location.search);
    const UNLOCK_KEY = 'pv_unlock_until_v3';
    const FORCE_LOCK = qs.get('lock') === '1';

    function esc(s){
      return String(s).replace(/[&<>"']/g, function(m){
        return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];
      });
    }

    document.addEventListener("DOMContentLoaded", function() {
      // Conso avancée
      const lienAvance = document.getElementById('lienAvance');
      if (lienAvance) {
        lienAvance.onclick = function(e){
          e.preventDefault();
          document.getElementById('modeAvance').style.display='block';
          this.style.display='none';
        };
      }

      // Mentions légales (popup)
      const link = document.getElementById('mentions-legales-link');
      const popup = document.getElementById('mentions-popup');
      const closeBtn = document.getElementById('close-mentions');
      if (link && popup && closeBtn) {
        link.onclick = function(e){ e.preventDefault(); popup.style.display='block'; };
        closeBtn.onclick = function(e){ e.preventDefault(); popup.style.display='none'; };
      }

      // Format téléphone FR
      const telUnlock = document.getElementById('telUnlock');
      if(telUnlock){
        telUnlock.addEventListener('input', function(e){
          let val = e.target.value.replace(/\D/g,'').slice(0,10);
          e.target.value = val.replace(/(\d{2})(?=\d)/g,'$1 ').trim();
        });
      }

      // Bloquer Enter (déblocage)
      ['emailUnlock','telUnlock'].forEach(id=>{
        const el = document.getElementById(id);
        if(el){
          el.addEventListener('keydown', (ev)=>{
            if(ev.key === 'Enter'){ ev.preventDefault(); ev.stopPropagation(); }
          });
        }
      });
    });

    let scenarios = [];
    let selectedScenario = null;

    function isUnlocked(){
      if (FORCE_LOCK) return false;
      try { return Date.now() < parseInt(localStorage.getItem(UNLOCK_KEY)||'0',10); }
      catch(e){ return false; }
    }
    function setUnlocked(hours){
      if (FORCE_LOCK) return;
      const ms = (hours||24)*60*60*1000;
      localStorage.setItem(UNLOCK_KEY, String(Date.now()+ms));
    }
    function unlockUI(){
      document.getElementById('lockedContent').style.filter='none';
      document.getElementById('lockedContent').style.userSelect='auto';
      document.getElementById('lockedContent').style.pointerEvents='auto';
      document.getElementById('veil').style.display='none';
    }

    // ===== Overlay helpers =====
    function showCalcOverlay(message){
      const ov = document.getElementById('calc-overlay');
      if (!ov) return;
      if (message) {
        const t = ov.querySelector('#calc-title');
        if (t) t.textContent = message;
      }
      ov.style.display = 'flex';
      document.body.classList.add('no-scroll');
      const panel = ov.querySelector('.panel');
      if (panel) panel.focus();
    }
    function hideCalcOverlay(){
      const ov = document.getElementById('calc-overlay');
      if (!ov) return;
      ov.style.display = 'none';
      document.body.classList.remove('no-scroll');
    }

    function fetchScenarios(departement) {
      return fetch('https://script.google.com/macros/s/AKfycbwhlyD_FMMm2g9JIQAm2Se2xehUqIM2MzWMl1YGl_gP1DJKM_-jZFj_YStDMhWi-0F8XA/exec')
        .then(r => r.json())
        .then(data => data
          .filter(row => String(row.Departement||'') == String(departement))
          .map(row => ({
            prixKwh: parseFloat((row.PrixKwh || '').toString().replace(',', '.').replace(/[^0-9.]/g, '')),
            puissance: row.Puissance,
            prod: parseFloat(row.Prod),
            seuil: parseFloat(row.Seuil),
            panels: parseInt(row.Panels),
            prix: parseFloat(row.Prix),
            remiseChantier: parseFloat((row.RemiseChantier || '').toString().replace(',', '.').replace(/[^0-9.]/g, '')),
            mensualite: parseFloat(row.Mensualite),
            taeg: parseFloat(row.Taeg),
            total: parseFloat(row.Total),
            dureeMois: parseInt(row.Mois)
          })))
        .catch(_ => { alert("Impossible de charger les données, réessayez plus tard."); return []; });
    }

    async function calculerSimulation() {
      const btn = document.getElementById('simuler');
      if (btn) { btn.disabled = true; btn.style.opacity = '0.7'; }
      showCalcOverlay('Calcul en cours…');

      try {
        ['recap','kpi1','lockedSection'].forEach(id=>{
          const el=document.getElementById(id);
          el.style.display='none'; el.style.visibility='hidden'; el.style.height='0';
        });

        const codePostal = document.getElementById('codePostal').value.trim();
        const facture = parseFloat((document.getElementById('facture').value + '').replace(',', '.'));
        const consoInput = document.getElementById('conso');

        if (!/^[0-9]{5}$/.test(codePostal)) { alert("Veuillez entrer un code postal valide."); return; }
        if (isNaN(facture) || facture <= 0) { alert("Merci de remplir correctement tous les champs."); return; }

        const departement = codePostal.substring(0, 2);
        const data = await fetchScenarios(departement);
        if (data.length === 0) { alert("Aucune donnée disponible pour ce département."); return; }
        scenarios = data;

        // Conso / prix kWh
        let conso, prixKwh, consommationEstimee;
        let consoReelleVal = "";
        let sourceConso = "estimee";

        if (consoInput && consoInput.value) {
          const consoVal = (consoInput.value + '').replace(',', '.');
          const consoParsed = parseFloat(consoVal);
          if (isNaN(consoParsed) || consoParsed <= 0) { alert("Merci d’indiquer une consommation kWh correcte."); return; }
          conso = consoParsed;
          prixKwh = facture / conso;
          consommationEstimee = conso;
          consoReelleVal = Math.round(consoParsed);
          sourceConso = "reelle";
        } else {
          prixKwh = scenarios[0].prixKwh;
          consommationEstimee = facture / prixKwh;
          conso = consommationEstimee;
        }

        // Dimensionnement
        const minProd = Math.min(...scenarios.map(s => s.prod));
        if (consommationEstimee < minProd) { alert("Consommation trop faible : installation non conseillée."); return; }
        let scenario = scenarios.filter(s => s.prod <= consommationEstimee).sort((a,b) => b.prod - a.prod)[0];
        if (!scenario) scenario = scenarios.sort((a,b) => b.prod - a.prod)[0];
        selectedScenario = scenario;

        // Calculs
        const autoKwh = scenario.prod * 0.6;
        const stockKwh = scenario.prod * 0.4;
        const acheminement = 0.05;
        const factureAvant = conso * prixKwh;
        const autoValue = autoKwh * prixKwh;
        const stockValue = stockKwh * prixKwh;
        const coutAcheminement = stockKwh * acheminement;
        const factureApres = factureAvant - autoValue - stockValue + coutAcheminement;
        const economieAnnuelle = factureAvant - factureApres;
        const economieMensuelle = economieAnnuelle / 12;
        let gain15ans = 0, prixActuel = prixKwh;
        for (let i=0;i<15;i++){
          const autoVal = autoKwh * prixActuel, stockVal = stockKwh * prixActuel, coutAch = stockKwh * acheminement;
          const factureAv = conso * prixActuel, factureAp = factureAv - autoVal - stockVal + coutAch;
          gain15ans += (factureAv - factureAp); prixActuel *= 1.05;
        }

        // Formats
        const taegTxt = Number.isFinite(scenario.taeg) ? scenario.taeg.toFixed(2) + " %" : "—";
        const mensualiteTxt = Number.isFinite(scenario.mensualite) ? scenario.mensualite.toLocaleString('fr-FR',{minimumFractionDigits:2,maximumFractionDigits:2}) + " €" : "—";
        const totalTxt = Number.isFinite(scenario.total) ? scenario.total.toLocaleString('fr-FR',{minimumFractionDigits:2,maximumFractionDigits:2}) + " €" : "—";
        const dureeTxt = Number.isFinite(scenario.dureeMois) ? scenario.dureeMois + " mois" : "—";

        // Récap
        const recapEl = document.getElementById('recap');
        const libConso = (sourceConso === "reelle") ? "Conso annuelle (réelle)" : "Conso annuelle estimée";
        recapEl.innerHTML = `
          <h2>Votre estimation personnalisée</h2>
          <div class="recap-grid">
            <div class="recap-item"><div class="label">Code postal</div><div class="value">${esc(codePostal)}</div></div>
            <div class="recap-item"><div class="label">${libConso}</div><div class="value">${Math.round(conso).toLocaleString('fr-FR')} kWh</div></div>
            <div class="recap-item"><div class="label">Prix kWh TTC utilisé</div><div class="value">${prixKwh.toFixed(3)} €</div></div>
            <div class="recap-item"><div class="label">Facture annuelle</div><div class="value">${facture.toLocaleString('fr-FR')} €</div></div>
            <div class="recap-item" style="grid-column:1/-1">
              <div class="label">Puissance & production</div>
              <div class="value" style="font-size:18px">${esc(scenario.puissance)} — ${scenario.panels} panneaux (500 W) • ${scenario.prod.toLocaleString('fr-FR')} kWh/an</div>
            </div>
            <div class="recap-item" style="grid-column:1/-1">
              <div class="label">% de votre conso couverte</div>
              <div class="value">${((scenario.prod / conso) * 100).toFixed(2)} %</div>
            </div>
          </div>
          <span class="note">“Votre production est valorisée à 100 % grâce à la batterie virtuelle, même si elle ne couvre pas 100 % de votre consommation.”.</span>
        `;
        recapEl.style.display='block'; recapEl.style.visibility='visible'; recapEl.style.height='auto';

        // KPI
        const k1 = document.getElementById('kpi1');
        k1.innerHTML = `
          <div class="kpi-box">
            <strong>Gain estimé la 1ʳᵉ année :</strong>
            <b>${Math.round(economieAnnuelle).toLocaleString('fr-FR')} €</b>
          </div>
        `;
        k1.style.display='block'; k1.style.visibility='visible'; k1.style.height='auto';

        // Contenu verrouillé
        const locked = document.getElementById('lockedContent');
        locked.innerHTML = `
          <div class="kpi-box"><strong>Soit un gain par mois de :</strong> <b>${Math.round(economieMensuelle).toLocaleString('fr-FR')} €</b></div>
          <div class="kpi-box"><strong>Économie cumulée sur 15 ans :</strong> <b>${Math.round(gain15ans).toLocaleString('fr-FR')} €</b></div>

          <div style="border-top:1px solid var(--border);margin:10px 0 12px 0"></div>

          <div class="propo">
            <div class="propo-title">Ce que nous vous proposons</div>
            <ul class="propo-list">
              <li><span class="point-title">Remplacer votre facture par un investissement</span><br>Une partie de votre budget électricité finance votre installation solaire.</li>
              <li><span class="point-title">Autofinancement simple</span><br>Les économies générées couvrent votre mensualité.</li>
              <li><span class="point-title">Mensualité fixe</span><br><span class="badge">${mensualiteTxt}</span> hors assurance.</li>
              <li><span class="point-title">Aucune charge supplémentaire</span><br>Cette mensualité remplace ce que vous payez déjà, elle ne s’ajoute pas.</li>
              <li><span class="point-title">Protégez-vous des hausses</span><br>Devenez propriétaire de votre production et sécurisez vos coûts.</li>
            </ul>
          </div>

          <div class="offre-speciale">
            <div class="offre-titre">Offre spéciale “Groupage chantiers”</div>
            <div class="offre-montant">
              <span class="badge-offre">${Number.isFinite(scenario.remiseChantier) ? scenario.remiseChantier.toLocaleString('fr-FR') : "—"} €</span>
              <span>de remise immédiate</span>
            </div>
            <div class="offre-sous-titre">(à déduire du prix TTC affiché ci-dessous)</div>
            <div class="offre-conditions">Offre valable jusqu’au <strong>30 septembre 2025</strong> — Places limitées</div>
          </div>

          <div class="financement-bloc">
            <div class="financement-conditions">
              <div class="prix-install">
                <span class="point-title">Installation ${esc(scenario.puissance)} :</span>
                <span class="badge-fin badge-fin--clair">${scenario.prix.toLocaleString('fr-FR')} € TTC</span>
                <span class="hint">(prix indicatif hors options)</span>
              </div>
              <div class="option-fin">Option financement <span class="hint">(facultatif)</span></div>
              <div>
                <span class="badge-fin">${mensualiteTxt}</span> par mois (hors assurance)
                • Durée : <span class="badge-fin">${dureeTxt}</span>
                • TAEG fixe : <span class="badge-fin">${taegTxt}</span>
              </div>
              <div style="margin-top:6px">Prix total : <span class="badge-fin">${totalTxt}</span></div>
              <div style="margin-top:6px">Financement proposé par notre partenaire Projexio, sous réserve d’acceptation.</div>
            </div>
            <div class="financement-warning">⚠️ Un crédit vous engage et doit être remboursé. Vérifiez vos capacités de remboursement avant de vous engager.</div>
            <div class="financement-note">L’estimation affichée est indicative. Une visite technique est nécessaire pour établir un devis ferme et adapté à votre situation.</div>
          </div>
        `;

        const section = document.getElementById('lockedSection');
        section.style.display='block'; section.style.visibility='visible'; section.style.height='auto';

        /* >>> Masquer les pavés texte + témoignages après simulation <<< */
        hideAfterSimulationBlocks();

        if (isUnlocked()) { unlockUI(); }

        // Envoi auto (lead anonyme)
        const fd = new FormData();
        fd.append("code_postal", codePostal);
        fd.append("conso", Math.round(conso));          // valeur utilisée
        fd.append("conso_reelle", consoReelleVal);      // si saisie
        fd.append("source_conso", sourceConso);         // "reelle" | "estimee"
        fd.append("facture", facture);
        fd.append("prod", scenario.prod);
        fd.append("eco1", Math.round(economieAnnuelle));
        fd.append("ecomensuelle", Math.round(economieMensuelle));
        fd.append("eco15", Math.round(gain15ans));
        fd.append("puissance", scenario.puissance);
        fd.append("panneaux", scenario.panels);
        fd.append("prix", scenario.prix);
        fd.append("mensualite", Number.isFinite(scenario.mensualite) ? scenario.mensualite : "");
        fd.append("taeg", Number.isFinite(scenario.taeg) ? scenario.taeg : "");
        fd.append("totalcredit", Number.isFinite(scenario.total) ? scenario.total : "");
        fd.append("mois", Number.isFinite(scenario.dureeMois) ? scenario.dureeMois : "");
        fd.append("email", ""); fd.append("tel", "");
        fd.append("emailUser", ""); fd.append("telephone", "");
        fd.append("unlock", "0");
        fetch('https://script.google.com/macros/s/AKfycbwhlyD_FMMm2g9JIQAm2Se2xehUqIM2MzWMl1YGl_gP1DJKM_-jZFj_YStDMhWi-0F8XA/exec', {method:'POST', mode:'no-cors', body:fd});

      } finally {
        hideCalcOverlay();
        const btn = document.getElementById('simuler');
        if (btn) { btn.disabled = false; btn.style.opacity = '1'; }
      }
    }

    function submitUnlock(e){
      if(e){ e.preventDefault(); e.stopPropagation(); }

      const email = (document.getElementById('emailUnlock').value||'').trim();
      const tel = (document.getElementById('telUnlock').value||'').replace(/\D/g,'');
      const consent = document.getElementById('rgpdUnlock').checked;

      if (email && !/^\S+@\S+\.\S+$/.test(email)) {
        alert("Email invalide.");
        return;
      }

      if(!tel || tel.length<10){ alert("Téléphone invalide (10 chiffres)."); return; }
      if(!consent){ alert("Merci de cocher la case de consentement."); return; }
      if(!selectedScenario){ alert("Veuillez d’abord lancer une simulation."); return; }

      const codePostal = document.getElementById('codePostal').value.trim();
      const facture = parseFloat((document.getElementById('facture').value + '').replace(',', '.'));

      // Recalcule comme dans calculerSimulation()
      const consoInput = document.getElementById('conso');
      let conso, prixKwh, consoReelleVal = "", sourceConso = "estimee";

      if (consoInput && consoInput.value) {
        const v = parseFloat((consoInput.value + '').replace(',', '.'));
        if (!isNaN(v) && v > 0) {
          conso = v;
          prixKwh = facture / conso;
          consoReelleVal = Math.round(v);
          sourceConso = "reelle";
        }
      }
      if (!conso) {
        prixKwh = selectedScenario.prixKwh;
        conso = facture / prixKwh;
      }

      const autoKwh = selectedScenario.prod * 0.6;
      const stockKwh = selectedScenario.prod * 0.4;
      const acheminement = 0.05;

      const factureAvant = conso * prixKwh;
      const autoValue = autoKwh * prixKwh;
      const stockValue = stockKwh * prixKwh;
      const coutAcheminement = stockKwh * acheminement;

      const factureApres = factureAvant - autoValue - stockValue + coutAcheminement;
      const economieAnnuelle = factureAvant - factureApres;
      const economieMensuelle = economieAnnuelle / 12;

      let gain15ans = 0, prixActuel = prixKwh;
      for (let i=0;i<15;i++){
        const autoVal = autoKwh * prixActuel;
        const stockVal = stockKwh * prixActuel;
        const coutAch = stockKwh * acheminement;
        const factureAv = conso * prixActuel;
        const factureAp = factureAv - autoVal - stockVal + coutAch;
        gain15ans += (factureAv - factureAp);
        prixActuel *= 1.05;
      }

      // Envoi (mêmes champs/ordre)
      const fd = new FormData();
      fd.append("code_postal", codePostal);
      fd.append("conso", Math.round(conso));
      fd.append("conso_reelle", consoReelleVal);
      fd.append("source_conso", sourceConso);
      fd.append("facture", facture);
      fd.append("prod", selectedScenario.prod);
      fd.append("eco1", Math.round(economieAnnuelle));
      fd.append("ecomensuelle", Math.round(economieMensuelle));
      fd.append("eco15", Math.round(gain15ans));
      fd.append("puissance", selectedScenario.puissance);
      fd.append("panneaux", selectedScenario.panels);
      fd.append("prix", selectedScenario.prix);
      fd.append("mensualite", Number.isFinite(selectedScenario.mensualite) ? selectedScenario.mensualite : "");
      fd.append("taeg", Number.isFinite(selectedScenario.taeg) ? selectedScenario.taeg : "");
      fd.append("totalcredit", Number.isFinite(selectedScenario.total) ? selectedScenario.total : "");
      fd.append("mois", Number.isFinite(selectedScenario.dureeMois) ? selectedScenario.dureeMois : "");
      fd.append("email", email); fd.append("tel", tel);
      fd.append("emailUser", email); fd.append("telephone", tel);
      fd.append("unlock", "1");

      fetch('https://script.google.com/macros/s/AKfycbwhlyD_FMMm2g9JIQAm2Se2xehUqIM2MzWMl1YGl_gP1DJKM_-jZFj_YStDMhWi-0F8XA/exec',{method:'POST',mode:'no-cors',body:fd});

      try{
        gtag('event','unlock_report',{method:'overlay'});
        gtag_report_conversion();
      }catch(e){}

      unlockUI();
      setUnlocked(24);
    }
  </script>

  <!-- Script Consent Mode V2 : logique Accepter/Refuser -->
  <script>
    (function(){
      const KEY = 'consent_v2';
      const banner = document.getElementById('consent-banner');
      const btnAccept = document.getElementById('consent-accept');
      const btnReject = document.getElementById('consent-reject');

      function updateConsent(state, init=true){
        gtag('consent', 'update', {
          analytics_storage:   state.analytics ? 'granted' : 'denied',
          ad_storage:          state.ads ? 'granted' : 'denied',
          ad_user_data:        state.adUserData ? 'granted' : 'denied',
          ad_personalization:  state.adPersonal ? 'granted' : 'denied'
        });
        if (init && (state.analytics || state.ads || state.adUserData || state.adPersonal)) {
          window.__initAds && window.__initAds();
        }
      }
      function save(state){ try{ localStorage.setItem(KEY, JSON.stringify(state)); } catch(e){} }
      function load(){ try{ return JSON.parse(localStorage.getItem(KEY) || 'null'); } catch(e){ return null; } }

      // Chargement initial
      const saved = load();
      if (saved) {
        updateConsent(saved, /*init=*/true);
        banner.style.display = 'none';
      } else {
        banner.style.display = 'block';
        banner.style.opacity = '0';
        banner.style.transform = 'translateY(10px)';
        requestAnimationFrame(()=> {
          banner.style.transition = 'opacity .18s ease, transform .18s ease';
          banner.style.opacity = '1';
          banner.style.transform = 'translateY(0)';
        });
      }

      // Acceptation globale
      btnAccept.addEventListener('click', function(){
        const state = { analytics:true, ads:true, adUserData:true, adPersonal:true };
        updateConsent(state);
        save(state);
        banner.style.display = 'none';
      });

      // Refus global
      btnReject.addEventListener('click', function(){
        const state = { analytics:false, ads:false, adUserData:false, adPersonal:false };
        updateConsent(state);
        save(state);
        banner.style.display = 'none';
      });
    })();
  </script>

  <!-- Compteur dynamique -->
  <script>
    const baseCount = 1234;
    const startDate = new Date('2025-05-01T00:00:00Z');
    const reduceMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    function updateCompteur() {
      const now = new Date();
      const secondsElapsed = Math.floor((now - startDate) / 1000);
      const increments = Math.floor(secondsElapsed / 47);
      const total = baseCount + increments;
      const el = document.getElementById('compteurValeur');
      const current = parseInt(el.innerText.replace(/\s/g, ''), 10) || 0;
      const frames = reduceMotion ? 1 : 90;
      const increment = (total - current) / frames;
      let frame = 0;
      const animate = () => {
        frame++;
        const value = Math.round(current + increment * frame);
        el.innerText = value.toLocaleString('fr-FR');
        if (frame < frames && !reduceMotion) requestAnimationFrame(animate);
      };
      animate();
    }
    updateCompteur(); setInterval(updateCompteur, 5000); /* 5 s */
  </script>

  <!-- === QS Booster === -->
  <script>
  (function(){
    // 1) Auto-ouverture des panneaux d’accordéon pour trafic Ads
    document.addEventListener('DOMContentLoaded', function () {
      const p = new URLSearchParams(location.search);
      const isAds = p.has('gclid') || p.has('wbraid') || p.has('gbraid')
        || (p.get('utm_source')||'').toLowerCase()==='google';
      if(!isAds) return;

      const TARGETS = [
        'Prix, production et économies : notre méthode',
        'Obtenir un devis',
        'Le simulateur, en pratique',
        'Production estimée'
      ];

      const term = (p.get('utm_term')||'').toLowerCase();
      const MAP = [
        ['devis panneaux solaires', 'Obtenir un devis'],
        ['prix installation photovoltaïque', 'Prix, production et économies : notre méthode'],
        ['simulateur photovoltaïque', 'Le simulateur, en pratique'],
        ['simulation production photovoltaïque', 'Production estimée']
      ];

      const faq = document.getElementById('bloc-seo');
      if(!faq) return;
      const details = Array.from(faq.querySelectorAll('details'));

      function normalize(txt){
        return (txt||'').replace(/\u00a0/g,' ').trim().toLowerCase();
      }

      function openByTitle(title){
        const target = normalize(title);
        const node = details.find(d => {
          const h = d.querySelector('summary h2');
          const txt = normalize(h ? h.textContent : '');
          return txt === target;
        });
        if(node){ node.setAttribute('open',''); node.querySelector('summary')?.setAttribute('aria-expanded','true'); }
      }

      const mapped = MAP.find(([kw]) => term.includes(kw));
      if(mapped){ openByTitle(mapped[1]); }

      TARGETS.forEach(openByTitle);

      const first = details.find(d=>d.hasAttribute('open'));
      if(first){ first.scrollIntoView({behavior:'smooth', block:'start'}); }
    });

    // 2) Intro dynamique sous H1 selon utm_term
    document.addEventListener('DOMContentLoaded', function () {
      const p = new URLSearchParams(location.search);
      const term = (p.get('utm_term')||'').toLowerCase();
      if(!term) return;

      const MAP = [
        ['devis panneaux solaires', 'Obtenez votre <strong>devis panneaux solaires</strong> après la simulation ci-dessous.'],
        ['prix installation photovoltaïque', 'Calculez le <strong>prix installation photovoltaïque</strong> à partir de votre facture.'],
        ['simulateur photovoltaïque', 'Utilisez notre <strong>simulateur photovoltaïque</strong> : production, panneaux, économies.'],
        ['simulation production photovoltaïque', 'Lancez la <strong>simulation production photovoltaïque</strong> en 30&nbsp;secondes.']
      ];
      const hit = MAP.find(([k]) => term.includes(k));
      if(!hit) return;

      const leadSub = document.querySelector('.lead-sub');
      if(!leadSub) return;

      const note = document.createElement('div');
      note.className = 'card';
      note.setAttribute('data-hide-after-sim','1');
      note.style.maxWidth = '720px';
      note.style.margin = '10px auto 18px';
      note.innerHTML = `<p style="margin:0;text-align:center">${hit[1]}</p>`;
      leadSub.parentNode.insertBefore(note, leadSub.nextSibling);
    });
  })();
  </script>
  <!-- === FIN QS Booster === -->

</body>
</html>
