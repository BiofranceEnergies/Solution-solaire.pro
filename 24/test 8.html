<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="data:,">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- SEO principal -->
  <title>Prix installation photovolta√Øque en Dordogne (24) | Estimation rapide</title>
  <meta name="description" content="D√©couvrez le prix d‚Äôune installation photovolta√Øque en Dordogne (24). Estimation personnalis√©e de votre projet solaire, production, √©conomies et co√ªt en quelques secondes.">
  <link rel="canonical" href="https://www.solution-solaire.pro/24/prix.html">

  <!-- Open Graph -->
  <meta property="og:title" content="Prix installation photovolta√Øque en Dordogne (24)">
  <meta property="og:description" content="Estimez rapidement le prix d‚Äôune installation photovolta√Øque en Dordogne (24). Produisez votre propre √©lectricit√©, calculez le co√ªt et les √©conomies en toute transparence.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.solution-solaire.pro/24/prix.html">
  <meta property="og:image" content="https://www.solution-solaire.pro/24/og-image-24.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">

  <!-- Pr√©connexions -->
  <link rel="preconnect" href="https://raw.githubusercontent.com" crossorigin>
  <link rel="dns-prefetch" href="//raw.githubusercontent.com">
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
  <link rel="dns-prefetch" href="//www.googletagmanager.com">

  <!-- Google tag (gtag.js) ‚Äì Consent Mode V2 + init diff√©r√©e -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-11242044118"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }

    gtag('consent', 'default', {
      ad_storage: 'denied',
      analytics_storage: 'denied',
      ad_user_data: 'denied',
      ad_personalization: 'denied',
      wait_for_update: 500
    });
    gtag('set', 'ads_data_redaction', true);
    gtag('set', 'url_passthrough', true);

    window.__initAds = function(){
      gtag('js', new Date());
      gtag('config', 'AW-11242044118');
    };
  </script>

  <!-- Conversion Google Ads -->
  <script>
    function gtag_report_conversion() {
      try { gtag('event', 'conversion', { send_to: 'AW-11242044118/MslOCKGZzo0bENb1z_Ap' }); } catch(e) {}
      return true;
    }
  </script>

  <style>
    :root{
      --bg:#f7fafc; --paper:#ffffff; --ink:#0f172a; --muted:#64748b; --line:#e2e8f0;
      --ring:#fde68a; --ok:#059669; --warn:#f59e0b; --warn-600:#d97706;
      --blue:#2563eb; --radius:14px; --shadow:0 14px 36px rgba(2,6,23,.06);
      --shadow-strong:0 16px 40px rgba(245,158,11,.25);
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    img{max-width:100%;height:auto;display:block}

    .wrap{max-width:980px;margin:0 auto;padding:28px 14px}
    .logo{display:block;margin:0 auto 10px;width:86px;filter:drop-shadow(0 2px 6px rgba(0,0,0,.15))}
    h1{font-size:clamp(24px,3.2vw,34px);text-align:center;margin:4px 0 6px;font-weight:800;line-height:1.18}
    h1 .accent{color:var(--warn)}
    h2{font-size:clamp(18px,2.2vw,22px);text-align:center;margin:0 0 10px;font-weight:700;color:#111827}
    .lead-sub{color:var(--muted);text-align:center;margin:6px auto 14px}

    .counter-wrap{display:flex;justify-content:center;margin:8px 0 18px}
    .counter-badge{display:inline-block;background:#fff;color:#111827;border:1px solid var(--line);border-radius:999px;padding:8px 14px;font-weight:800;letter-spacing:.2px;box-shadow:var(--shadow)}

    .card{background:var(--paper);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;margin:0 auto 18px}
    .form-section{max-width:720px}
    .inputs{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:640px){.inputs{grid-template-columns:1fr}}

    input,button{width:100%;padding:12px 14px;border-radius:12px;border:1.5px solid var(--line);background:#fff;color:#111827;font-size:17px}
    input::placeholder{color:#94a3b8}

    .mini-badges{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin:6px 0 10px}
    .mini-badge{display:inline-flex;align-items:center;gap:6px;background:#fff4e5;color:#92400e;border:1px solid #fed7aa;padding:6px 10px;border-radius:999px;font-weight:700;font-size:13px}

    a.helper{color:#2563eb;text-decoration:underline;font-size:14px}

    button.primary{
      background:linear-gradient(90deg,var(--warn),#fbbf24);color:#111827;border:0;font-weight:900;letter-spacing:.2px;cursor:pointer;box-shadow:var(--shadow-strong)
    }
    button.primary:hover{filter:brightness(1.06);transform:translateY(-1px);box-shadow:0 18px 46px rgba(245,158,11,.35)}
    button.primary:active{transform:translateY(0);filter:brightness(.98)}
    button.primary[disabled]{opacity:.7;cursor:not-allowed}
    button.primary:focus{outline:3px solid var(--ring);outline-offset:2px}

    .temoins{max-width:720px}
    .temoins-list{display:grid;gap:10px}
    .temoin{background:#fff;border:1px solid var(--line);border-radius:12px;padding:12px 14px;position:relative}
    .temoin:before{content:"‚úì";position:absolute;left:12px;top:12px;color:#16a34a;font-weight:900}
    .temoin blockquote{margin:0 0 4px;padding-left:20px;color:#111827;font-size:15.5px}
    .temoin cite{display:block;color:#64748b;font-style:normal;font-size:13.5px;padding-left:20px}

    .recap{max-width:720px}
    .recap-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:560px){.recap-grid{grid-template-columns:1fr}}
    .recap-item{background:#fff;border:1px solid var(--line);border-radius:12px;padding:12px 14px}
    .recap-item .label{color:#64748b;font-size:13px}
    .note{display:block;text-align:left;margin:12px 0 0;background:#ecfdf5;border:1px solid #a7f3d0;color:#065f46;font-weight:600;font-size:14.5px;padding:10px 12px;border-radius:12px}

    .kpi{max-width:720px}
    .kpi-box{padding:10px 12px;border-radius:12px;background:#fff;border:1px dashed var(--line);margin-bottom:10px}
    .kpi-box b{color:#059669}

    #lockedSection{max-width:720px;position:relative}
    .lockedContent{filter:blur(7px);user-select:none;pointer-events:none}
    .veil{position:absolute;inset:0;border-radius:var(--radius);background:rgba(255,255,255,.86);backdrop-filter:blur(2px);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;text-align:center;padding:20px;border:1px solid var(--line)}
    .pw-title{margin:0;color:#111827}
    .pw-sub{margin:0;color:#64748b}
    .trust-list{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
    .trust-badge{display:flex;align-items:center;gap:6px;background:#f1f5f9;border:1px solid var(--line);padding:8px 12px;border-radius:999px;font-weight:700;color:#334155}

    .unlock{display:grid;grid-template-columns:1fr 1fr;gap:10px;max-width:560px;width:100%}
    @media(max-width:580px){.unlock{grid-template-columns:1fr}}
    .unlock input{background:#fff;border:1.5px solid var(--line)}
    .consent{display:flex;gap:8px;align-items:flex-start;color:#334155;font-size:13px;text-align:left}
    .consent input{width:auto;margin-top:3px}

    #mentions-legales-container{text-align:center;margin:26px 0 8px}
    #mentions-legales-link{color:#2563eb;text-decoration:underline;cursor:pointer}
    #mentions-popup{display:none;position:fixed;bottom:60px;left:50%;transform:translateX(-50%);width:340px;max-width:95vw;background:#fff;color:#111827;border-radius:13px;box-shadow:0 8px 32px rgba(0,0,0,.15);padding:18px 20px 12px;z-index:10000;font-size:13px;line-height:1.7;border:1px solid var(--line)}
    #close-mentions{position:absolute;top:6px;right:12px;background:none;color:#111827;border:none;font-size:18px;font-weight:bold;cursor:pointer;padding:0}

    .sep{border:none;border-top:2px solid var(--line);margin:30px 0 16px}

    body.no-scroll{overflow:hidden}
    #calc-overlay{position:fixed;inset:0;background:rgba(2,6,23,.32);backdrop-filter:blur(2px);display:none;z-index:9998;align-items:center;justify-content:center;padding:20px}
    #calc-overlay .panel{width:100%;max-width:360px;background:#fff;border:1px solid var(--line);border-radius:14px;box-shadow:var(--shadow);padding:18px;text-align:center;outline:none}
    #calc-overlay .spinner{width:42px;height:42px;margin:6px auto 12px;border:4px solid #e2e8f0;border-top:4px solid var(--warn);border-radius:50%;animation:spin 1s linear infinite}
    #calc-overlay .title{color:#111827;font-weight:800;margin:0 0 6px}
    #calc-overlay .desc{color:#64748b;font-size:14px;margin:0}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}

    .consent-banner{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid var(--line);color:#111827;padding:12px;z-index:9999;display:none;box-shadow:0 -6px 26px rgba(0,0,0,.08);font:14px/1.5 system-ui,Segoe UI,Roboto;min-height:56px}
    .consent-inner{max-width:980px;margin:0 auto;display:flex;gap:14px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .consent-text{flex:1 1 520px;font-size:14px;color:#334155}
    .consent-buttons{display:flex;gap:10px}
    .consent-btn{padding:8px 16px;border-radius:999px;font-weight:700;cursor:pointer;border:none;font-size:14px;transition:all .2s ease}
    .consent-btn.reject{background:#e2e8f0;color:#0f172a}
    .consent-btn.reject:hover{background:#cbd5e1}
    .consent-btn.accept{background:linear-gradient(90deg,var(--warn),#fbbf24);color:#111827;font-weight:800;box-shadow:var(--shadow-strong)}
    .consent-btn.accept:hover{filter:brightness(1.05)}
  </style>
</head>
<body>

  <!-- Bandeau Consent Mode V2 -->
  <div id="consent-banner" class="consent-banner" role="dialog" aria-live="polite" aria-label="Pr√©f√©rences de confidentialit√©">
    <div class="consent-inner">
      <div class="consent-text">Nous utilisons des technologies pour la mesure et la publicit√©. Vous pouvez refuser.</div>
      <div class="consent-buttons">
        <button id="consent-reject" class="consent-btn reject" type="button">Tout refuser</button>
        <button id="consent-accept" class="consent-btn accept" type="button">Tout accepter</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <img src="https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/52db4f3ab1c38909b33d9037e74d7371c32a9cf5/logo%20SSP.webp" alt="Logo Solution Solaire Pro" class="logo" width="172" height="86" fetchpriority="high" decoding="async">

    <div class="counter-wrap">
      <div class="counter-badge">
        <span id="compteurValeur" style="font-weight:900;letter-spacing:.2px">1 234</span>
        <span style="opacity:.85"> simulations depuis le 1·µâ ≥ mai 2025</span>
      </div>
    </div>

    <h1>Prix installation <span class="accent">photovolta√Øque</span> en Dordogne (24)</h1>
    <p class="lead-sub">Prix TTC, production et √©conomies ‚Äî affich√©s en 1 minute, √† l‚Äô√©cran.</p>

    <h2 id="prix">Combien co√ªte une installation&nbsp;?</h2>

    <div class="card form-section">
      <h2>Simulation personnalis√©e</h2>

      <div class="mini-badges" aria-label="R√©assurances">
        <span class="mini-badge">üîí Donn√©es prot√©g√©es</span>
        <span class="mini-badge">‚è±Ô∏è 1 minute</span>
        <span class="mini-badge">üö´ Aucun d√©marchage</span>
      </div>

      <form onsubmit="calculerSimulation(); return false;" novalidate>
        <div class="inputs" style="margin-bottom:8px">
          <input type="text" id="codePostal" placeholder="Votre code postal" maxlength="5" inputmode="numeric" pattern="[0-9]{5}" autocomplete="postal-code" autofocus>
          <input type="text" id="facture" placeholder="Votre facture √©lec /an (ex : 1800 ‚Ç¨)" inputmode="decimal" autocomplete="off">
        </div>

        <div id="modeAvance" style="display:none;">
          <input type="text" id="conso" placeholder="Conso annuelle (kWh, optionnel)" inputmode="decimal" autocomplete="off">
        </div>

        <a href="#" id="lienAvance" class="helper">‚ûï Vous connaissez votre consommation annuelle ? Cliquez ici pour une estimation ultra-pr√©cise</a>
        <div style="margin-top:6px;font-size:13px;color:#64748b;text-align:center">Pas votre conso ? La facture suffit.</div>

        <div style="height:10px"></div>
        <button id="simuler" type="submit" class="primary" aria-label="Obtenir mon estimation photovolta√Øque">üîé Voir mon estimation</button>
        <div style="margin-top:10px;font-size:14.5px;color:#475569;text-align:center">Affichage imm√©diat. Aucun d√©marchage.</div>
      </form>
    </div>

    <div class="card temoins" data-hide-after-sim="1" id="bloc-temoins">
      <h2>Ils l'ont test√©</h2>
      <div class="temoins-list">
        <div class="temoin"><blockquote>‚ÄúEn moins de 2 minutes, j‚Äôai obtenu un prix pr√©cis et le montant de mes √©conomies. L‚Äô√©tude compl√®te s‚Äôest affich√©e imm√©diatement apr√®s d√©blocage. Aucun d√©marchage, juste les infos utiles.‚Äù</blockquote><cite>‚Äî Michel L., P√©rigueux</cite></div>
        <div class="temoin"><blockquote>‚ÄúProcess simple et clair. Les √©tapes sont rapides et l‚Äô√©tude personnalis√©e est limpide. Je me suis sentie en confiance du d√©but √† la fin.‚Äù</blockquote><cite>‚Äî Sophie G., Sarlat</cite></div>
        <div class="temoin"><blockquote>‚ÄúChiffrage d√©taill√© affich√© instantan√©ment, avec toutes les infos dont j‚Äôavais besoin. S√©rieux, rapide et transparent.‚Äù</blockquote><cite>‚Äî Paul D., Rib√©rac</cite></div>
        <div class="temoin"><blockquote>‚ÄúLe simulateur m‚Äôa montr√© plus de 1 000 ‚Ç¨ d‚Äô√©conomies possibles la 1 ≥·µâ ann√©e. Pr√©sentation claire, affich√©e √† l‚Äô√©cran, et aucune sollicitation derri√®re. √áa met en confiance.‚Äù</blockquote><cite>‚Äî Claire M., Nontron</cite></div>
      </div>
    </div>

    <div id="recap" class="card recap" style="display:none;visibility:hidden;height:0;overflow:hidden;"></div>

    <div id="lockedSection" class="card" style="display:none;visibility:hidden;height:0;overflow:hidden;">
      <div id="lockedContent" class="lockedContent"></div>
      <div class="veil" id="veil">
        <div class="pw-head">
          <h2 class="pw-title"><span aria-hidden="true">üìä</span> Affichez votre √©tude compl√®te personnalis√©e</h2>
          <p class="pw-sub">Acc√©dez au d√©tail de vos √©conomies, √† la projection sur 15 ans et √† votre offre personnalis√©e.</p>
        </div>

        <ul class="trust-list" aria-label="R√©assurances">
          <li class="trust-badge">üîí Donn√©es prot√©g√©es</li>
          <li class="trust-badge">‚ö° √âtude affich√©e imm√©diatement √† l‚Äô√©cran</li>
        </ul>

        <div class="unlock" style="margin-top:10px">
          <div class="field">
            <label for="emailUnlock" class="label">Email <span style="color:#6b7280;font-weight:600">(facultatif)</span></label>
            <input type="email" id="emailUnlock" placeholder="Votre email (facultatif)" autocomplete="email">
          </div>

          <div class="field">
            <label for="telUnlock" class="label">T√©l√©phone <span>(obligatoire)</span></label>
            <input type="tel" id="telUnlock" placeholder="06 12 34 56 78" autocomplete="tel" required>
            <div class="help" style="font-size:13px;color:#64748b;margin-top:4px">Un SMS de confirmation vous sera envoy√©. Libre √† vous d‚Äô√©changer ensuite.</div>
          </div>

          <label class="consent" style="grid-column:1/-1">
            <input type="checkbox" id="rgpdUnlock" required aria-required="true">
            <span>Je consens √† √™tre contact√© <strong>par SMS uniquement</strong>.</span>
          </label>

          <button type="button" class="primary" style="grid-column:1/-1" onclick="submitUnlock(event)">
            <span aria-hidden="true">üìä</span> Voir mon √©tude compl√®te et mes √©conomies
          </button>

          <div class="foot" style="grid-column:1/-1;text-align:center;color:#64748b;font-size:12px;margin-top:8px">
            Vos donn√©es ne seront jamais revendues ni utilis√©es √† d‚Äôautres fins.
          </div>
        </div>
      </div>
    </div>

    <div id="mentions-legales-container"><span id="mentions-legales-link">Mentions l√©gales</span></div>
    <div id="mentions-popup" role="dialog" aria-modal="true" aria-labelledby="mentions-title">
      <button id="close-mentions" type="button" aria-label="Fermer">&times;</button>
      <strong id="mentions-title">Mentions l√©gales :</strong><br>
      Solution Solaire Pro partenaire de Biofrance Energies<br>
      SIRET : 422 231 928 00025<br>
      Adresse : 4 rue du Pont Saint Jean, 27530 √âzy-sur-Eure<br>
      Contact : solutionsolairepro@gmail.com<br>
      H√©bergeur : GitHub Pages, 88 Colin P. Kelly Jr. Street, San Francisco, CA 94107, USA<br>
      Donn√©es personnelles : Les informations saisies sont utilis√©es uniquement pour traiter votre demande. Aucun d√©marchage ni revente.<br>
      RGPD : Vous pouvez demander la suppression de vos donn√©es √† tout moment par simple email.
    </div>

    <hr class="sep">
  </div>

  <!-- Overlay de calcul -->
  <div id="calc-overlay" role="alertdialog" aria-modal="true" aria-labelledby="calc-title" aria-describedby="calc-desc">
    <div class="panel" tabindex="-1">
      <div class="spinner" aria-hidden="true"></div>
      <h3 id="calc-title" class="title">Calcul en cours‚Ä¶</h3>
      <p id="calc-desc" class="desc">Nous g√©n√©rons votre estimation (quelques secondes).</p>
    </div>
  </div>

  <script>
    function hideAfterSimulationBlocks(){ document.querySelectorAll('[data-hide-after-sim]').forEach(el=>el.style.display='none'); }

    const qs = new URLSearchParams(location.search);
    const UNLOCK_KEY = 'pv_unlock_until_v3';
    const FORCE_LOCK = qs.get('lock') === '1';

    function esc(s){return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}

    document.addEventListener("DOMContentLoaded", function() {
      const lienAvance = document.getElementById('lienAvance');
      if (lienAvance) {
        lienAvance.onclick = function(e){ e.preventDefault(); document.getElementById('modeAvance').style.display='block'; this.style.display='none'; };
      }

      const link = document.getElementById('mentions-legales-link');
      const popup = document.getElementById('mentions-popup');
      const closeBtn = document.getElementById('close-mentions');
      if (link && popup && closeBtn) {
        link.onclick = e => { e.preventDefault(); popup.style.display='block'; };
        closeBtn.onclick = e => { e.preventDefault(); popup.style.display='none'; };
      }

      const telUnlock = document.getElementById('telUnlock');
      if(telUnlock){
        telUnlock.addEventListener('input', function(e){
          let val = e.target.value.replace(/\D/g,'').slice(0,10);
          e.target.value = val.replace(/(\d{2})(?=\d)/g,'$1 ').trim();
        });
      }

      ['emailUnlock','telUnlock'].forEach(id=>{
        const el = document.getElementById(id);
        if(el){ el.addEventListener('keydown', ev=>{ if(ev.key==='Enter'){ ev.preventDefault(); ev.stopPropagation(); } }); }
      });
    });

    let scenarios=[]; let selectedScenario=null;
    function isUnlocked(){ if(FORCE_LOCK) return false; try{ return Date.now()<parseInt(localStorage.getItem(UNLOCK_KEY)||'0',10);}catch(e){return false}}
    function setUnlocked(hours){ if(FORCE_LOCK) return; const ms=(hours||24)*60*60*1000; localStorage.setItem(UNLOCK_KEY, String(Date.now()+ms)); }
    function unlockUI(){ const lc=document.getElementById('lockedContent'); if(lc){lc.style.filter='none';lc.style.userSelect='auto';lc.style.pointerEvents='auto'} const veil=document.getElementById('veil'); if(veil){veil.style.display='none'} }

    function showCalcOverlay(message){ const ov=document.getElementById('calc-overlay'); if(!ov) return; if(message){ const t=ov.querySelector('#calc-title'); if(t) t.textContent=message; } ov.style.display='flex'; document.body.classList.add('no-scroll'); ov.querySelector('.panel')?.focus(); }
    function hideCalcOverlay(){ const ov=document.getElementById('calc-overlay'); if(!ov) return; ov.style.display='none'; document.body.classList.remove('no-scroll'); }

    function fetchScenarios(departement){
      return fetch('https://script.google.com/macros/s/AKfycbwhlyD_FMMm2g9JIQAm2Se2xehUqIM2MzWMl1YGl_gP1DJKM_-jZFj_YStDMhWi-0F8XA/exec')
        .then(r=>r.json())
        .then(data=>data.filter(row=>String(row.Departement||'')==String(departement)).map(row=>({
          prixKwh:parseFloat((row.PrixKwh||'').toString().replace(',', '.').replace(/[^0-9.]/g,'')),
          puissance:row.Puissance, prod:parseFloat(row.Prod), seuil:parseFloat(row.Seuil),
          panels:parseInt(row.Panels), prix:parseFloat(row.Prix),
          remiseChantier:parseFloat((row.RemiseChantier||'').toString().replace(',', '.').replace(/[^0-9.]/g,'')),
          mensualite:parseFloat(row.Mensualite), taeg:parseFloat(row.Taeg),
          total:parseFloat(row.Total), dureeMois:parseInt(row.Mois)
        })))
        .catch(_=>{ alert("Impossible de charger les donn√©es, r√©essayez plus tard."); return []; });
    }

    async function calculerSimulation(){
      const btn=document.getElementById('simuler'); if(btn){btn.disabled=true}
      showCalcOverlay('Calcul en cours‚Ä¶');
      try{
        ['recap','lockedSection'].forEach(id=>{
          const el=document.getElementById(id);
          el.style.display='none'; el.style.visibility='hidden'; el.style.height='0';
          if(id==='lockedSection'){ const lc=document.getElementById('lockedContent'); if(lc) lc.innerHTML=''; const v=document.getElementById('veil'); if(v) v.style.display=''; }
        });

        const codePostal=document.getElementById('codePostal').value.trim();
        const facture=parseFloat((document.getElementById('facture').value+'').replace(',', '.'));
        const consoInput=document.getElementById('conso');

        if(!/^[0-9]{5}$/.test(codePostal)){ alert("Veuillez entrer un code postal valide."); return; }
        if(isNaN(facture)||facture<=0){ alert("Merci de remplir correctement tous les champs."); return; }

        const departement=codePostal.substring(0,2);
        const data=await fetchScenarios(departement);
        if(data.length===0){ alert("Aucune donn√©e disponible pour ce d√©partement."); return; }
        scenarios=data;

        let conso, prixKwh, consommationEstimee; let consoReelleVal=""; let sourceConso="estimee";
        if(consoInput && consoInput.value){
          const v=parseFloat((consoInput.value+'').replace(',', '.'));
          if(isNaN(v)||v<=0){ alert("Merci d‚Äôindiquer une consommation kWh correcte."); return; }
          conso=v; prixKwh=facture/conso; consommationEstimee=conso; consoReelleVal=Math.round(v); sourceConso="reelle";
        }else{
          prixKwh=scenarios[0].prixKwh; consommationEstimee=facture/prixKwh; conso=consommationEstimee;
        }

        const minProd=Math.min(...scenarios.map(s=>s.prod));
        if(consommationEstimee<minProd){ alert("Consommation trop faible : installation non conseill√©e."); return; }
        let scenario=scenarios.filter(s=>s.prod<=consommationEstimee).sort((a,b)=>b.prod-a.prod)[0];
        if(!scenario) scenario=scenarios.sort((a,b)=>b.prod-a.prod)[0];
        selectedScenario=scenario;

        const autoKwh=scenario.prod*0.6, stockKwh=scenario.prod*0.4, acheminement=0.05;
        const factureAvant=conso*prixKwh, autoValue=autoKwh*prixKwh, stockValue=stockKwh*prixKwh, coutAcheminement=stockKwh*acheminement;
        const factureApres=factureAvant - autoValue - stockValue + coutAcheminement;
        const economieAnnuelle=factureAvant - factureApres, economieMensuelle=economieAnnuelle/12;
        let gain15ans=0, prixActuel=prixKwh;
        for(let i=0;i<15;i++){ const autoVal=autoKwh*prixActuel, stockVal=stockKwh*prixActuel, coutAch=stockKwh*acheminement; const factureAv=conso*prixActuel, factureAp=factureAv - autoVal - stockVal + coutAch; gain15ans += (factureAv - factureAp); prixActuel*=1.05; }

        const taegTxt=Number.isFinite(scenario.taeg)?scenario.taeg.toFixed(2)+" %":"‚Äî";
        const mensualiteTxt=Number.isFinite(scenario.mensualite)?scenario.mensualite.toLocaleString('fr-FR',{minimumFractionDigits:2,maximumFractionDigits:2})+" ‚Ç¨":"‚Äî";
        const totalTxt=Number.isFinite(scenario.total)?scenario.total.toLocaleString('fr-FR',{minimumFractionDigits:2,maximumFractionDigits:2})+" ‚Ç¨":"‚Äî";
        const dureeTxt=Number.isFinite(scenario.dureeMois)?scenario.dureeMois+" mois":"‚Äî";

        const recapEl=document.getElementById('recap');
        const libConso=(sourceConso==="reelle")?"Conso annuelle (r√©elle)":"Conso annuelle estim√©e";
        recapEl.innerHTML=`
          <h2>Votre estimation personnalis√©e</h2>
          <div class="recap-grid">
            <div class="recap-item"><div class="label">Code postal</div><div class="value">${esc(codePostal)}</div></div>
            <div class="recap-item"><div class="label">${libConso}</div><div class="value">${Math.round(conso).toLocaleString('fr-FR')} kWh</div></div>
            <div class="recap-item"><div class="label">Prix kWh TTC utilis√©</div><div class="value">${prixKwh.toFixed(3)} ‚Ç¨</div></div>
            <div class="recap-item"><div class="label">Facture annuelle</div><div class="value">${facture.toLocaleString('fr-FR')} ‚Ç¨</div></div>
            <div class="recap-item" style="grid-column:1/-1">
              <div class="label">Puissance & production</div>
              <div class="value" style="font-size:18px">${esc(scenario.puissance)} ‚Äî ${scenario.panels} panneaux (500 W) ‚Ä¢ ${scenario.prod.toLocaleString('fr-FR')} kWh/an</div>
            </div>
            <div class="recap-item" style="grid-column:1/-1">
              <div class="label">% de votre conso couverte</div>
              <div class="value">${((scenario.prod / conso) * 100).toFixed(2)} %</div>
            </div>
          </div>
          <span class="note">Votre production est valoris√©e √† 100 % gr√¢ce √† la batterie virtuelle, m√™me si elle ne couvre pas 100 % de votre consommation.</span>
        `;
        recapEl.style.display='block'; recapEl.style.visibility='visible'; recapEl.style.height='auto';

        const locked=document.getElementById('lockedContent');
        locked.innerHTML=`
          <div class="kpi"><div class="kpi-box"><strong>Gain estim√© la 1 ≥·µâ ann√©e :</strong> <b>${Math.round(economieAnnuelle).toLocaleString('fr-FR')} ‚Ç¨</b></div></div>
          <div class="kpi-box"><strong>Soit un gain par mois de :</strong> <b>${Math.round(economieMensuelle).toLocaleString('fr-FR')} ‚Ç¨</b></div>
          <div class="kpi-box"><strong>√âconomie cumul√©e sur 15 ans :</strong> <b>${Math.round(gain15ans).toLocaleString('fr-FR')} ‚Ç¨</b></div>
          <div style="border-top:1px solid var(--line);margin:10px 0 12px"></div>
          <div class="recap-item">Remplacer votre facture par un investissement<br><span style="color:#475569">Une partie de votre budget √©lectricit√© finance votre installation solaire.</span></div>
          <div class="recap-item">Autofinancement simple<br><span style="color:#475569">Les √©conomies g√©n√©r√©es couvrent votre mensualit√©.</span></div>
          <div class="recap-item">Mensualit√© fixe<br><span style="display:inline-block;background:#f1f5f9;border:1px solid var(--line);padding:2px 8px;border-radius:999px;font-weight:700">${mensualiteTxt}</span> <span style="color:#64748b">hors assurance.</span></div>
          <div class="recap-item">Aucune charge suppl√©mentaire<br><span style="color:#475569">Cette mensualit√© remplace ce que vous payez d√©j√†, elle ne s‚Äôajoute pas.</span></div>
          <div class="recap-item">Prot√©gez-vous des hausses<br><span style="color:#475569">Devenez propri√©taire de votre production et s√©curisez vos co√ªts.</span></div>

          <div style="background:#fff7ed;border:1px solid #fed7aa;border-radius:14px;padding:16px;text-align:center;margin:14px 0">
            <div style="color:#b45309;font-weight:800;margin-bottom:6px">Offre sp√©ciale ‚ÄúGroupage chantiers‚Äù</div>
            <div style="font-size:1.2rem;font-weight:800;color:#111827;display:flex;gap:10px;justify-content:center;align-items:center">
              <span style="display:inline-block;background:#f59e0b;color:#111827;padding:6px 12px;border-radius:999px;font-weight:900;box-shadow:0 6px 16px rgba(245,158,11,.25)">${Number.isFinite(scenario.remiseChantier) ? scenario.remiseChantier.toLocaleString('fr-FR') : "‚Äî"} ‚Ç¨</span>
              <span>de remise imm√©diate</span>
            </div>
            <div style="font-size:.92rem;color:#64748b;margin-top:4px">(√† d√©duire du prix TTC affich√© ci-dessous)</div>
            <div style="font-size:.88rem;color:#64748b;margin-top:6px">Offre valable jusqu‚Äôau <strong>30 septembre 2025</strong> ‚Äî Places limit√©es</div>
          </div>

          <div class="recap-item">
            <div style="margin-bottom:10px"><span style="font-weight:700;color:#111827">Installation ${esc(scenario.puissance)} :</span> <span style="display:inline-block;background:#eef2ff;border:1px solid #c7d2fe;color:#1e3a8a;padding:2px 8px;border-radius:999px;font-weight:700;margin-left:6px">${scenario.prix.toLocaleString('fr-FR')} ‚Ç¨ TTC</span> <span style="color:#64748b;margin-left:6px">(prix indicatif hors options)</span></div>
            <div style="font-weight:700;color:#111827;margin-bottom:6px">Option financement <span style="color:#64748b;font-weight:600">(facultatif)</span></div>
            <div>
              <span style="display:inline-block;background:#f1f5f9;border:1px solid var(--line);padding:2px 8px;border-radius:999px;font-weight:700">${mensualiteTxt}</span> par mois (hors assurance)
              ‚Ä¢ Dur√©e : <span style="display:inline-block;background:#f1f5f9;border:1px solid var(--line);padding:2px 8px;border-radius:999px;font-weight:700">${dureeTxt}</span>
              ‚Ä¢ TAEG fixe : <span style="display:inline-block;background:#f1f5f9;border:1px solid var(--line);padding:2px 8px;border-radius:999px;font-weight:700">${taegTxt}</span>
            </div>
            <div style="margin-top:6px">Prix total : <span style="display:inline-block;background:#f1f5f9;border:1px solid var(--line);padding:2px 8px;border-radius:999px;font-weight:700">${totalTxt}</span></div>
            <div style="margin-top:6px;color:#475569">Financement propos√© par notre partenaire Projexio, sous r√©serve d‚Äôacceptation.</div>
            <div style="margin-top:10px;color:#6b7280;font-size:12px">‚ö†Ô∏è Un cr√©dit vous engage et doit √™tre rembours√©. V√©rifiez vos capacit√©s de remboursement avant de vous engager.</div>
            <div style="margin-top:6px;color:#6b7280;font-size:12px">L‚Äôestimation affich√©e est indicative. Une visite technique est n√©cessaire pour √©tablir un devis ferme et adapt√© √† votre situation.</div>
          </div>
        `;

        const section=document.getElementById('lockedSection');
        section.style.display='block'; section.style.visibility='visible'; section.style.height='auto';

        hideAfterSimulationBlocks();
        if(isUnlocked()) unlockUI();

        const fd=new FormData();
        fd.append("code_postal", codePostal);
        fd.append("conso", Math.round(conso));
        fd.append("conso_reelle", consoReelleVal);
        fd.append("source_conso", sourceConso);
        fd.append("facture", facture);
        fd.append("prod", scenario.prod);
        fd.append("eco1", Math.round(economieAnnuelle));
        fd.append("ecomensuelle", Math.round(economieMensuelle));
        fd.append("eco15", Math.round(gain15ans));
        fd.append("puissance", scenario.puissance);
        fd.append("panneaux", scenario.panels);
        fd.append("prix", scenario.prix);
        fd.append("mensualite", Number.isFinite(scenario.mensualite)?scenario.mensualite:"");
        fd.append("taeg", Number.isFinite(scenario.taeg)?scenario.taeg:"");
        fd.append("totalcredit", Number.isFinite(scenario.total)?scenario.total:"");
        fd.append("mois", Number.isFinite(scenario.dureeMois)?scenario.dureeMois:"");
        fd.append("email",""); fd.append("tel",""); fd.append("emailUser",""); fd.append("telephone",""); fd.append("unlock","0");
        fetch('https://script.google.com/macros/s/AKfycbwhlyD_FMMm2g9JIQAm2Se2xehUqIM2MzWMl1YGl_gP1DJKM_-jZFj_YStDMhWi-0F8XA/exec',{method:'POST',mode:'no-cors',body:fd});
      } finally {
        hideCalcOverlay(); const btn=document.getElementById('simuler'); if(btn){btn.disabled=false}
      }
    }

    function submitUnlock(e){
      if(e){e.preventDefault();e.stopPropagation();}
      const email=(document.getElementById('emailUnlock').value||'').trim();
      const tel=(document.getElementById('telUnlock').value||'').replace(/\D/g,'');
      const consent=document.getElementById('rgpdUnlock').checked;

      if(email && !/^\S+@\S+\.\S+$/.test(email)){ alert("Email invalide."); return; }
      if(!tel || tel.length<10){ alert("T√©l√©phone invalide (10 chiffres)."); return; }
      if(!consent){ alert("Merci de cocher la case de consentement."); return; }
      if(!selectedScenario){ alert("Veuillez d‚Äôabord lancer une simulation."); return; }

      const codePostal=document.getElementById('codePostal').value.trim();
      const facture=parseFloat((document.getElementById('facture').value+'').replace(',', '.'));
      const consoInput=document.getElementById('conso');

      let conso, prixKwh, consoReelleVal="", sourceConso="estimee";
      if(consoInput && consoInput.value){
        const v=parseFloat((consoInput.value+'').replace(',', '.'));
        if(!isNaN(v) && v>0){ conso=v; prixKwh=facture/conso; consoReelleVal=Math.round(v); sourceConso="reelle"; }
      }
      if(!conso){ prixKwh=selectedScenario.prixKwh; conso=facture/prixKwh; }

      const autoKwh=selectedScenario.prod*0.6, stockKwh=selectedScenario.prod*0.4, acheminement=0.05;
      const factureAvant=conso*prixKwh, autoValue=autoKwh*prixKwh, stockValue=stockKwh*prixKwh, coutAcheminement=stockKwh*acheminement;
      const factureApres=factureAvant - autoValue - stockValue + coutAcheminement;
      const economieAnnuelle=factureAvant - factureApres, economieMensuelle=economieAnnuelle/12;

      let gain15ans=0, prixActuel=prixKwh;
      for(let i=0;i<15;i++){ const autoVal=autoKwh*prixActuel, stockVal=stockKwh*prixActuel, coutAch=stockKwh*acheminement; const factureAv=conso*prixActuel, factureAp=factureAv - autoVal - stockVal + coutAch; gain15ans += (factureAv - factureAp); prixActuel*=1.05; }

      const fd=new FormData();
      fd.append("code_postal", codePostal);
      fd.append("conso", Math.round(conso));
      fd.append("conso_reelle", consoReelleVal);
      fd.append("source_conso", sourceConso);
      fd.append("facture", facture);
      fd.append("prod", selectedScenario.prod);
      fd.append("eco1", Math.round(economieAnnuelle));
      fd.append("ecomensuelle", Math.round(economieMensuelle));
      fd.append("eco15", Math.round(gain15ans));
      fd.append("puissance", selectedScenario.puissance);
      fd.append("panneaux", selectedScenario.panels);
      fd.append("prix", selectedScenario.prix);
      fd.append("mensualite", Number.isFinite(selectedScenario.mensualite)?selectedScenario.mensualite:"");
      fd.append("taeg", Number.isFinite(selectedScenario.taeg)?selectedScenario.taeg:"");
      fd.append("totalcredit", Number.isFinite(selectedScenario.total)?selectedScenario.total:"");
      fd.append("mois", Number.isFinite(selectedScenario.dureeMois)?selectedScenario.dureeMois:"");
      fd.append("email", email); fd.append("tel", tel);
      fd.append("emailUser", email); fd.append("telephone", tel);
      fd.append("unlock", "1");

      fetch('https://script.google.com/macros/s/AKfycbwhlyD_FMMm2g9JIQAm2Se2xehUqIM2MzWMl1YGl_gP1DJKM_-jZFj_YStDMhWi-0F8XA/exec',{method:'POST',mode:'no-cors',body:fd});

      try{ gtag('event','unlock_report',{method:'overlay'}); gtag_report_conversion(); }catch(e){}
      unlockUI(); setUnlocked(24);
    }
  </script>

  <!-- Consent Mode V2 : logique Accepter/Refuser -->
  <script>
    (function(){
      const KEY='consent_v2';
      const banner=document.getElementById('consent-banner');
      const btnAccept=document.getElementById('consent-accept');
      const btnReject=document.getElementById('consent-reject');

      function updateConsent(state, init=true){
        gtag('consent','update',{
          analytics_storage: state.analytics?'granted':'denied',
          ad_storage: state.ads?'granted':'denied',
          ad_user_data: state.adUserData?'granted':'denied',
          ad_personalization: state.adPersonal?'granted':'denied'
        });
        if(init && (state.analytics||state.ads||state.adUserData||state.adPersonal)){
          window.__initAds && window.__initAds();
        }
      }
      function save(state){ try{localStorage.setItem(KEY, JSON.stringify(state));}catch(e){} }
      function load(){ try{return JSON.parse(localStorage.getItem(KEY)||'null');}catch(e){return null;} }

      const saved=load();
      if(saved){ updateConsent(saved,true); banner.style.display='none'; }
      else{
        banner.style.display='block'; banner.style.opacity='0'; banner.style.transform='translateY(10px)';
        requestAnimationFrame(()=>{ banner.style.transition='opacity .18s ease, transform .18s ease'; banner.style.opacity='1'; banner.style.transform='translateY(0)'; });
      }

      btnAccept.addEventListener('click', function(){ const s={analytics:true,ads:true,adUserData:true,adPersonal:true}; updateConsent(s); save(s); banner.style.display='none'; });
      btnReject.addEventListener('click', function(){ const s={analytics:false,ads:false,adUserData:false,adPersonal:false}; updateConsent(s); save(s); banner.style.display='none'; });
    })();
  </script>

  <!-- Compteur dynamique -->
  <script>
    const baseCount=1234;
    const startDate=new Date('2025-05-01T00:00:00Z');
    const reduceMotion=window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    function updateCompteur(){
      const now=new Date();
      const secondsElapsed=Math.floor((now-startDate)/1000);
      const increments=Math.floor(secondsElapsed/47);
      const total=baseCount+increments;
      const el=document.getElementById('compteurValeur');
      const current=parseInt(el.innerText.replace(/\s/g,''),10)||0;
      const frames=reduceMotion?1:90;
      const increment=(total-current)/frames;
      let frame=0;
      const animate=()=>{ frame++; const value=Math.round(current+increment*frame); el.innerText=value.toLocaleString('fr-FR'); if(frame<frames && !reduceMotion) requestAnimationFrame(animate); };
      animate();
    }
    updateCompteur(); setInterval(updateCompteur,5000);
  </script>

  <!-- === QS Booster (restaur√©) === -->
  <script>
  (function(){
    // 1) Auto-ouverture des panneaux d‚Äôaccord√©on pour trafic Ads (ne fait rien si #bloc-seo absent)
    document.addEventListener('DOMContentLoaded', function () {
      const p = new URLSearchParams(location.search);
      const isAds = p.has('gclid') || p.has('wbraid') || p.has('gbraid')
        || (p.get('utm_source')||'').toLowerCase()==='google';
      if(!isAds) return;

      const TARGETS = [
        'Prix, production et √©conomies : notre m√©thode',
        'Obtenir un devis',
        'Le simulateur, en pratique',
        'Production estim√©e'
      ];

      const term = (p.get('utm_term')||'').toLowerCase();
      const MAP = [
        ['devis panneaux solaires', 'Obtenir un devis'],
        ['prix installation photovolta√Øque', 'Prix, production et √©conomies : notre m√©thode'],
        ['simulateur photovolta√Øque', 'Le simulateur, en pratique'],
        ['simulation production photovolta√Øque', 'Production estim√©e']
      ];

      const faq = document.getElementById('bloc-seo');
      if(!faq) return; /* pas d‚Äôaccord√©on sur cette version, on sort proprement */

      const details = Array.from(faq.querySelectorAll('details'));
      function normalize(txt){ return (txt||'').replace(/\u00a0/g,' ').trim().toLowerCase(); }
      function openByTitle(title){
        const target = normalize(title);
        const node = details.find(d => {
          const h = d.querySelector('summary h2');
          const txt = normalize(h ? h.textContent : '');
          return txt === target;
        });
        if(node){ node.setAttribute('open',''); node.querySelector('summary')?.setAttribute('aria-expanded','true'); }
      }

      const mapped = MAP.find(([kw]) => term.includes(kw));
      if(mapped){ openByTitle(mapped[1]); }
      TARGETS.forEach(openByTitle);

      const first = details.find(d=>d.hasAttribute('open'));
      if(first){ first.scrollIntoView({behavior:'smooth', block:'start'}); }
    });

    // 2) Intro dynamique sous H1 selon utm_term (toujours actif)
    document.addEventListener('DOMContentLoaded', function () {
      const p = new URLSearchParams(location.search);
      const term = (p.get('utm_term')||'').toLowerCase();
      if(!term) return;

      const MAP = [
        ['devis panneaux solaires', 'Obtenez votre <strong>devis panneaux solaires</strong> apr√®s la simulation ci-dessous.'],
        ['prix installation photovolta√Øque', 'Calculez le <strong>prix installation photovolta√Øque</strong> √† partir de votre facture.'],
        ['simulateur photovolta√Øque', 'Utilisez notre <strong>simulateur photovolta√Øque</strong> : production, panneaux, √©conomies.'],
        ['simulation production photovolta√Øque', 'Lancez la <strong>simulation production photovolta√Øque</strong> en 30&nbsp;secondes.']
      ];
      const hit = MAP.find(([k]) => term.includes(k));
      if(!hit) return;

      const leadSub = document.querySelector('.lead-sub');
      if(!leadSub) return;

      const note = document.createElement('div');
      note.className = 'card';
      note.setAttribute('data-hide-after-sim','1');
      note.style.maxWidth = '720px';
      note.style.margin = '10px auto 18px';
      note.innerHTML = `<p style="margin:0;text-align:center">${hit[1]}</p>`;
      leadSub.parentNode.insertBefore(note, leadSub.nextSibling);
    });
  })();
  </script>
  <!-- === FIN QS Booster === -->

</body>
</html>
