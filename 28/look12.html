<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Coût installation panneaux solaires | Eure-et-Loir (28)</title>

<style>
  :root{
    /* Layout */
    --hero-h-desktop: 95vh;
    --hero-h-mobile: 100svh;
    --hero-min: 700px;
    --maxw: 1100px;

    /* Palette (sobre) */
    --accent:#f59e0b;         /* orange marque */
    --accent-2:#f7b733;
    --ink:#0f172a;
    --muted:#64748b;
    --border:#e6e8ef;
    --ok:#16a34a;
    --card:#ffffff;
    --surface:#f9fafb;
  }

  /* Reset & base */
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font:16px/1.45 system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
    color:var(--ink); background:var(--surface);
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    font-variant-numeric:tabular-nums;
  }

  /* ================== HERO ================== */
  header.hero{
    position:relative; height:var(--hero-h-desktop); min-height:var(--hero-min);
    overflow:hidden; isolation:isolate;
  }
  header.hero::before{
    content:""; position:absolute; inset:0;
    background:
      linear-gradient(90deg,
        rgba(5,12,24,.82) 0%,
        rgba(7,16,30,.66) 34%,
        rgba(10,18,28,.42) 62%,
        rgba(12,20,28,.22) 100%),
      url("https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/1ea92369de57361354807811188559129b45985c/foto%20fond.webp")
      center 35%/cover no-repeat;
    z-index:-1;
  }
  .hero__inner{
    max-width:var(--maxw); margin:0 auto;
    padding:60px clamp(16px,4vw,40px);
    display:grid; grid-template-columns:1.1fr 0.9fr; gap:clamp(20px,4vw,42px);
    height:100%; align-items:center; color:#fff;
  }
  @media (max-width:860px){
    .hero__inner{grid-template-columns:1fr;text-align:center;align-items:flex-end;padding-bottom:80px;}
  }
  .title{margin:0 0 14px;font-weight:900;line-height:1.1;font-size:clamp(28px,4.4vw,52px);color:#fff}
  .title em{color:var(--accent);font-style:normal;text-shadow:0 2px 10px rgba(245,158,11,.3);}
  .lead{margin:8px 0 0;color:rgba(255,255,255,.9);max-width:54ch;}

  .panel{display:flex;flex-direction:column;gap:12px;width:100%;}
  .pill{
    display:flex;align-items:center;justify-content:center;min-height:46px;
    background:linear-gradient(135deg,var(--accent),var(--accent-2));
    color:#1b1202;font-weight:800;border-radius:10px;border:0;
    box-shadow:0 8px 22px rgba(245,158,11,.25);
    transition:transform .2s ease, box-shadow .2s ease;
  }
  .pill:hover{transform:translateY(-1px);box-shadow:0 12px 28px rgba(245,158,11,.32);}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
  .rect,.option{
    display:flex;align-items:center;padding:12px 14px;
    background:rgba(255,255,255,.08);
    border:1px solid rgba(255,255,255,.22); border-radius:10px;
  }
  input{width:100%;background:transparent;border:0;color:#fff;font:inherit;min-width:0}
  input::placeholder{color:#cbd5e1;opacity:1;font-size:15px}
  .cta{
    display:inline-flex;align-items:center;justify-content:center;gap:8px;
    min-height:48px;width:100%;
    background:linear-gradient(135deg,var(--accent),var(--accent-2));
    color:#fff;font-weight:900;border:0;border-radius:10px;cursor:pointer;
    box-shadow:0 8px 22px rgba(245,158,11,.25);transition:transform .2s,box-shadow .2s;
  }
  .cta:hover{transform:translateY(-1px);box-shadow:0 12px 28px rgba(245,158,11,.32);}

  /* ================== SECTION 3 ÉTAPES ================== */
  .steps-2025{background:#fff;padding:clamp(40px,7vw,80px) 16px;color:var(--ink);}
  .steps-2025__inner{max-width:var(--maxw);margin:0 auto;text-align:center;}
  .steps-2025__title{font-weight:800;font-size:clamp(26px,3.8vw,44px);margin-bottom:6px;}
  .steps-2025__subtitle{color:var(--muted);margin-bottom:clamp(28px,5vw,48px);}
  .steps-2025__grid{display:grid;gap:clamp(14px,2vw,20px);grid-template-columns:1fr;}
  @media(min-width:860px){.steps-2025__grid{grid-template-columns:repeat(3,1fr);}}
  .steps-2025__item{
    background:#fff;border:1px solid var(--border);border-radius:16px;
    padding:clamp(18px,2.2vw,24px);
    box-shadow:0 4px 14px rgba(15,23,42,.05);
    display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;
  }
  .steps-2025__num{
    width:72px;height:72px;border-radius:50%;display:grid;place-items:center;
    font-weight:800;color:#fff;background:linear-gradient(135deg,var(--accent),#fdba74);
    box-shadow:0 8px 22px rgba(245,158,11,.25);font-size:22px;margin-bottom:12px;
  }
  .steps-2025__heading{margin:0;font-weight:800;font-size:clamp(18px,2.2vw,22px);}
  .steps-2025__text{margin:6px 0 0;color:var(--muted);font-size:clamp(14px,1.6vw,16px);}

  .steps-2025__note{margin:clamp(40px,6vw,60px) 0 0;display:flex;flex-direction:column;align-items:center;gap:18px;}
  .steps-2025__note p{font-weight:700;color:var(--ink);font-size:clamp(16px,2vw,20px);}

  /* ================== CHIFFRES CLÉS ================== */
  .stats-bg{
    width:100vw;margin-left:calc(50% - 50vw);margin-top:clamp(72px,9vw,140px);
    position:relative;padding:clamp(48px,9vw,96px) 16px;color:#fff;overflow:hidden;isolation:isolate;
  }
  .stats-bg::before{
    content:"";position:absolute;inset:0;
    background:url("https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/687b0f048a98e03f86e7852020887ff4f05eb913/bande%20panneaux%20full%20black.webp") center/cover no-repeat;
    filter:brightness(1.02) saturate(.95);z-index:-1;
  }
  .stats-bg__inner{max-width:var(--maxw);margin:0 auto;display:grid;grid-template-columns:1fr;gap:clamp(14px,3vw,20px);text-align:center;}
  @media (min-width:820px){.stats-bg__inner{grid-template-columns:repeat(4,1fr);}}
  .stat{padding:clamp(10px,2vw,14px);}
  .stat__value{font-weight:900;letter-spacing:-.02em;font-size:clamp(34px,5.5vw,56px);line-height:1.05;color:var(--accent);text-shadow:0 2px 10px rgba(0,0,0,.25);}
  .stat__label{margin-top:4px;font-size:clamp(14px,1.7vw,16px);color:rgba(255,255,255,.92);text-shadow:0 1px 4px rgba(0,0,0,.25);}

  .sr-only{position:absolute !important;width:1px;height:1px;margin:-1px;padding:0;border:0;overflow:hidden;clip:rect(0 0 0 0);clip-path:inset(50%);}

  /* ================== AVIS CLIENTS ================== */
  .testi{background:#fff;color:var(--ink);margin-top:clamp(40px,6vw,80px);padding:clamp(28px,6vw,60px) 16px;}
  .testi__inner{max-width:var(--maxw);margin:0 auto;}
  .testi__head{text-align:center;margin-bottom:clamp(18px,3vw,28px);}
  .testi__title{font-weight:900;line-height:1.15;font-size:clamp(26px,3.6vw,40px);margin:0 0 8px;}
  .testi__meta{color:var(--muted);font-size:clamp(14px,1.8vw,16px);}
  .testi__grid{display:grid;gap:clamp(16px,2.6vw,22px);grid-template-columns:1fr;}
  @media (min-width:1024px){.testi__grid{grid-template-columns:repeat(3,1fr);}}
  .tcard{
    background:#fff;border:1px solid var(--border);border-radius:16px;
    padding:clamp(16px,2.2vw,22px); box-shadow:0 4px 14px rgba(15,23,42,.05);
    display:flex;flex-direction:column;gap:12px;
  }
  .tcard__top{display:flex;align-items:center;gap:12px;}
  .avatar{
    width:44px;height:44px;border-radius:999px;display:grid;place-items:center;
    font-weight:700;color:#111827;background:linear-gradient(180deg,#fff6e5,#ffe4bf);
    border:1px solid #f1c987;
  }
  .tcard__name{font-weight:800;}
  .tcard__loc{color:var(--muted);font-size:14px;margin-top:2px;}
  .stars{display:flex;gap:2px;}
  .stars svg{width:18px;height:18px}
  .tcard__text{color:#334155;font-style:italic}

  /* ================== POURQUOI LE SOLAIRE ================== */
  .why{background:#f7f9fc;color:var(--ink);padding:clamp(40px,7vw,90px) 16px;margin-top:clamp(40px,6vw,80px);}
  .why__inner{max-width:var(--maxw);margin:0 auto;}
  .why__head{text-align:center;margin-bottom:clamp(22px,4vw,34px);}
  .why__title{font-weight:900;line-height:1.1;font-size:clamp(28px,4vw,48px);margin:0 0 10px;}
  .why__subtitle{color:var(--muted);font-size:clamp(14px,1.9vw,18px);}
  .why__grid{display:grid;gap:clamp(14px,2.4vw,20px);grid-template-columns:1fr;}
  @media (min-width:860px){ .why__grid{grid-template-columns:repeat(2,1fr);} }
  @media (min-width:1180px){ .why__grid{grid-template-columns:repeat(4,1fr);} }
  .why__card{
    background:#fff;border:1px solid var(--border);border-radius:16px;
    padding:clamp(18px,2.2vw,24px); box-shadow:0 4px 14px rgba(15,23,42,.05);
  }
  .why__top{display:flex;align-items:center;gap:12px;margin-bottom:10px;}
  .why__icon{
    width:42px;height:42px;border-radius:12px;display:grid;place-items:center;flex:0 0 auto;
    background:linear-gradient(180deg,#fff3db,#ffe1b3); border:1px solid #f4c981;color:#b45309;
  }
  .why__heading{font-weight:800;font-size:clamp(16px,2vw,20px);margin:0;}
  .why__text{color:var(--muted);margin:6px 0 0;font-size:clamp(14px,1.7vw,16px);line-height:1.45;}

  /* ================== FAQ ================== */
  .faq{background:#f7f9fc;color:var(--ink);margin-top:clamp(56px,8vw,96px);padding:clamp(32px,7vw,80px) 16px;}
  .faq__inner{max-width:var(--maxw);margin:0 auto;}
  .faq__head{text-align:center;margin-bottom:clamp(18px,3.6vw,28px);}
  .faq__title{font-weight:900;font-size:clamp(28px,4vw,48px);margin:0 0 8px;line-height:1.1;}
  .faq__subtitle{color:var(--muted);font-size:clamp(14px,1.9vw,18px);}
  .faq__list{display:grid;gap:12px;}
  .faq details{background:#fff;border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(15,23,42,.05);overflow:hidden;}
  .faq summary{list-style:none;cursor:pointer;display:flex;align-items:center;gap:10px;padding:18px 20px;font-weight:800;font-size:clamp(15px,1.9vw,17px);color:var(--ink);transition:color .2s ease;}
  .faq summary:hover, details[open] summary{color:var(--accent);}
  .faq summary::-webkit-details-marker{display:none;}
  .faq__chev{margin-left:auto;transition:transform .2s ease;flex:0 0 auto;opacity:.7;}
  details[open] .faq__chev{transform:rotate(180deg);opacity:1;}
  .faq__panel{padding:0 20px 18px 20px;color:var(--muted);font-size:clamp(14px,1.8vw,16px);line-height:1.55;border-top:1px solid var(--border);background:#fbfbfd;}
  .faq{padding-top:clamp(20px,4vw,40px);}
  .faq h2{margin-bottom:clamp(10px,2vw,16px);}
  .faq__list{margin-top:6px;}

  /* Logos certifications (héros) */
  .certifs{position:absolute;top:18px;left:18px;display:flex;align-items:center;gap:12px;z-index:5;}
  .certifs__img{height:36px;width:auto;display:block;filter:drop-shadow(0 1px 3px rgba(0,0,0,.25));}
  .certifs__img--main{height:76px;margin:0 3px;}
  .certifs__img[src*="qualipv"]{height:44px;}
  .certifs__img[src*="RGE.webp"]{height:32px;}
  @media (max-width:860px){
    .certifs{top:12px;left:12px;gap:8px;}
    .certifs__img{height:28px;}
    .certifs__img--main{height:52px;}
    .certifs__img[src*="qualipv"]{height:34px;}
    .certifs__img[src*="RGE.webp"]{height:26px;}
  }

  /* Mentions légales */
  .legal{background:#f7f9fc;color:var(--ink);padding:24px 16px;margin-top:clamp(40px,6vw,80px)}
  .legal__inner{max-width:var(--maxw);margin:0 auto;text-align:center}
  .legal__link{
  color:#6b7280 !important;        /* gris neutre */
  font-weight:400 !important;      /* non gras */
  text-decoration:none !important; /* pas de soulignement au repos */
  cursor:pointer;
}
.legal__link:hover{
  color:#374151 !important;        /* gris plus foncé au survol */
  text-decoration:underline !important;
}
.legal__link:visited{
  color:#6b7280 !important;        /* évite le violet visité */
}
  .legal .sep{border:0;border-top:1px solid var(--border);margin:16px auto 0;max-width:var(--maxw)}
  #mentions-popup{display:none;position:fixed;left:50%;bottom:64px;transform:translateX(-50%);width:360px;max-width:95vw;background:#fff;color:var(--ink);border:1px solid var(--border);border-radius:14px;padding:18px 20px 14px;box-shadow:0 10px 36px rgba(2,6,23,.15);z-index:9999;font-size:13px;line-height:1.7}
  #close-mentions{position:absolute;top:6px;right:12px;background:none;border:0;color:var(--ink);font-size:20px;font-weight:800;cursor:pointer}

  /* === Overlay calcul === */
  body.no-scroll{overflow:hidden;}
  #calc-overlay{position:fixed;inset:0;background:rgba(2,6,23,.35);backdrop-filter:blur(2px);display:none;z-index:9998;align-items:center;justify-content:center;padding:20px;}
  #calc-overlay .panel{width:100%;max-width:360px;background:#fff;color:#111827;border:1px solid var(--border);border-radius:14px;box-shadow:0 10px 36px rgba(2,6,23,.15);padding:18px;text-align:center;outline:none;}
 /* Spinner modernisé */
#calc-overlay .spinner{
  width:46px;
  height:46px;
  margin:6px auto 12px;
  border-radius:50%;
  background:
    conic-gradient(from 0turn at 50% 50%, var(--accent) 0 25%, rgba(245,158,11,0) 25% 100%);
  -webkit-mask: radial-gradient(farthest-side, #0000 62%, #000 63%);
          mask: radial-gradient(farthest-side, #0000 62%, #000 63%);
  animation: spin360 0.9s linear infinite;
  box-shadow: 0 0 0 1px rgba(0,0,0,.04) inset, 0 0 12px rgba(245,158,11,.18);
  will-change: transform;
}

#calc-overlay .spinner::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:50%;
  background:
    radial-gradient(circle 6px at 80% 50%, var(--accent), rgba(245,158,11,0) 60%);
  animation: spin360 0.9s linear infinite;
  mix-blend-mode: normal;
  pointer-events:none;
}

@keyframes spin360{
  to { transform: rotate(360deg); }
}

  #calc-overlay .desc{color:#374151;font-size:14px;margin:0;}

  /* ============== MODE RÉSULTAT ============== */
  body.results-mode header.hero{height:var(--hero-h-desktop);min-height:var(--hero-min);padding-bottom:0;}
  @media (max-width:860px){ body.results-mode header.hero{ height: var(--hero-h-mobile); } }
  body.results-mode header.hero::before{opacity:1 !important;}
  body.results-mode .panel{margin-bottom:0;}
  body.results-mode main > *{display:none !important;}
  body.results-mode main > #recap, body.results-mode main > .legal{display:block !important;}
  body.results-mode main > .legal{margin-top:24px;}
  body.results-mode #recap{display:block !important;margin-top:12px;}

  /* ===== Résultats – style 2025 ===== */
  .result-card{
    max-width: 860px; margin: 16px auto; padding: 18px;
    background:#fff; color:var(--ink); border:1px solid var(--border);
    border-radius:16px; box-shadow:0 6px 18px rgba(15,23,42,.06);
  }
  .result-card h2{ margin:0 0 20px; font-weight:900; font-size:clamp(20px,2.4vw,24px); }
  .result-grid{ display:grid; gap:12px; grid-template-columns:1fr; }
  @media(min-width:780px){ .result-grid{ grid-template-columns:repeat(2,1fr); } }

  .kpi{
    background:#fff; border:1px solid var(--border);
    border-radius:12px; padding:12px;
  }
  .kpi .label{ color:#64748b; font-size:13px; margin-bottom:4px; }
 .kpi .value{
  font-weight:800;
  font-size:18px;
  color:var(--ink);
}



  /* Mise en avant “dimensionnement” avec liseré gauche */
  .kpi--highlight{ position:relative; background:#fff; border-color:var(--border); }
  .kpi--highlight::before{
    content:""; position:absolute; left:-1px; top:-1px; bottom:-1px; width:4px;
    border-radius:12px 0 0 12px; background:var(--accent);
  }

  /* Bannière offre & pavé financier */
  .financial-banner{
    margin:24px 0 0; padding:18px; text-align:center;
    background:#fffaf2; border:1px solid #fde68a; border-radius:12px; box-shadow:none;
  }
  .financial-card{
    margin-top:12px; padding:16px; background:#fff; border:1px solid var(--border);
    border-radius:14px; box-shadow:0 6px 18px rgba(15,23,42,.06);
  }
  .financial-title{ font-size:18px; font-weight:900; margin:0 0 10px; color:var(--ink); }
  .tokens{ display:flex; flex-wrap:wrap; gap:8px; margin:8px 0 10px; }
  .token{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:#f8fafc; font-weight:700; }
  .note{ color:#64748b; font-size:13px; line-height:1.5; }
  .note-alert{
  margin-top:10px;
  padding:10px 12px;
  background:#fff;
  border:0;
  border-radius:10px;
}


  /* Petits correctifs formulaires */
  .rect input{ min-width:0; }
  
  #calc-overlay small {
  color:#94a3b8;
  font-size:0.9em;
}
/* Placeholder stylé uniquement dans le héros */
header.hero .panel input::placeholder {
  color:#ffffff;
  background: rgba(0,0,0,.25);
  padding:4px 6px;
  border-radius:6px;
  text-shadow:0 0 4px rgba(0,0,0,.5);
  font-size:15px;
}


/* Optionnel — rend la saisie plus confortable sur fond photo */
input {
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
}
/* === CTA inversé premium – Finition === */
.cta{
  background:#0f172a !important;      /* fond foncé */
  color:#fff !important;              /* texte blanc */
  border:2px solid var(--accent);     /* liseré orange */
  border-radius:14px;                 /* coins plus doux */
  min-height:58px;                    /* plus tactile */
  font-size:17px;                     /* lisibilité accrue */
  box-shadow:
    0 10px 26px rgba(245,158,11,.35), /* ombre chaude principale */
    0 0 12px rgba(245,158,11,.20);    /* halo discret */
  transition:transform .2s ease, box-shadow .2s ease, filter .2s ease;
}

.cta:hover{
  transform:translateY(-1px);
  box-shadow:
    0 14px 32px rgba(245,158,11,.45),
    0 0 14px rgba(245,158,11,.24);
}

.cta:active{
  transform:translateY(0);
  box-shadow:
    0 6px 16px rgba(245,158,11,.30),
    0 0 8px rgba(245,158,11,.18);
}

.cta:focus-visible{
  outline:2px solid var(--accent);
  outline-offset:2px;
}
/* === Harmonisation Premium 2025 pour le bandeau .pill === */
.pill{
  background: linear-gradient(180deg, #fbbf24, #f59e0b);  /* dégradé doux orange */
  color:#111827;                                         /* texte foncé lisible */
  border-radius:12px;                                    /* coins arrondis */
  font-weight:800;                                       /* un peu plus de présence */
  box-shadow:
    0 4px 12px rgba(245,158,11,.35),                     /* ombre chaude externe */
    inset 0 -2px 4px rgba(0,0,0,.15);                    /* légère ombre interne */
  padding:14px 16px;                                     /* aération homogène */
  border:0;
}

/* Harmonisation des coins */
.pill,
.rect,
.option { border-radius:12px; }   /* au lieu de 10px sur rect/option */

/* Focus clair et accessible sur les champs */
.rect:focus-within,
.option:focus-within {
  outline:2px solid var(--accent);
  outline-offset:2px;
}

/* Espacement doux entre le bandeau et la 1re rangée */
.pill { margin-bottom:10px; }

/* Ajustements mobiles : bandeau et CTA lisibles sans être massifs */
@media (max-width: 860px){
  .pill{
    padding:12px 14px;
    font-weight:800;        /* on garde le poids mais on évite d’augmenter la taille */
  }
  .cta{
    min-height:54px;
    font-size:16px;
    border-radius:12px;     /* un poil moins arrondi sur mobile */
  }
}

/* === Harmonisation largeur formulaire + CTA + bandeau === */
.pill,
.row,
.cta {
  max-width: 900px;   /* équilibre visuel idéal */
  margin-left: auto;
  margin-right: auto;
}

/* Réduction légère des champs pour garder de la cohérence */
.row {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.row > .rect,
.row > .option {
  width: 100%;
}

.row input {
  width: 100%;
  box-sizing: border-box;
}

/* ====== AJUSTEMENTS SUPPLÉMENTAIRES ====== */

/* 1️⃣ Version mobile : largeur fluide et espacement plus compact */
@media (max-width: 600px){
  .pill, .row, .cta { max-width: 92vw; } /* marges latérales sur petits écrans */
  .row { gap: 8px; }                     /* espace réduit entre les champs */
}

/* 2️⃣ Version grand écran : un peu plus d’air sur écrans larges */
@media (min-width: 1400px){
  .pill, .row, .cta { max-width: 920px; } /* légère expansion sur desktop XL */
}

/* ===== Overlay de déblocage (Lovable/CSS 2025) ===== */
.lock-zone{
  position: relative;
}
.lock-zone .lock-blur{
  filter: blur(4px);
  opacity:.85;
  pointer-events: none;
  user-select: none;
  transition: filter .2s ease, opacity .2s ease;
}

.gate-overlay{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
  z-index:10;
  background:rgba(255,255,255,.92); /* fond blanc légèrement translucide, net */
  backdrop-filter:blur(1px);        /* léger adoucissement */
}


.gate-card{
  width:min(780px, 92vw);
  background:#ffffff;
  border:1px solid var(--border);
  border-radius:16px;
  box-shadow:0 12px 32px rgba(0,0,0,.12);
  padding:clamp(18px,3vw,28px);
  text-align:center;
  backdrop-filter:none;
}


.gate-title{
  margin:0 0 6px;
  font-weight:900;
  font-size:clamp(20px,2.6vw,26px);
  color:var(--ink);
}
.gate-sub{
  color:#334155;
  margin:6px 0 10px;
}
.gate-sub strong{ color:var(--ink); }
.gate-deadline{ color:#b45309; font-weight:800; }

.gate-form{
  display:grid; gap:10px; grid-template-columns:1fr;
  max-width:680px; margin:14px auto 0;
}
@media(min-width:760px){ .gate-form{ grid-template-columns:1fr 1fr; } }

.gate-input{
  height:52px; border-radius:12px; border:1px solid var(--border); padding:0 14px;
  font:inherit; background:#fff; color:var(--ink);
  box-shadow:0 2px 0 rgba(15,23,42,.02) inset;
}
.gate-input::placeholder{ color:#94a3b8; }

.gate-cta{
  grid-column:1 / -1;
  height:56px; border:0; border-radius:14px; cursor:pointer;
  font-weight:900; font-size:16px; color:#fff; 
  background:linear-gradient(135deg, var(--accent), var(--accent-2));
  box-shadow:0 10px 26px rgba(245,158,11,.28);
  transition:transform .2s ease, box-shadow .2s ease;
}
.gate-cta:hover{ transform:translateY(-1px); box-shadow:0 14px 32px rgba(245,158,11,.36); }

.gate-note{
  margin-top:10px; font-size:12px; color:#64748b;
}

/* Neutralise le blur hérité sur les champs de l’overlay */
.gate-card .gate-input{
  -webkit-backdrop-filter: none !important;
  backdrop-filter: none !important;
  background: #fff !important;     /* fond plein, net */
  color: var(--ink);
}

.gate-card .gate-input::placeholder{
  color: #94a3b8;                   /* gris propre, non “blanchi” */
  text-shadow: none;                /* pas de halo */
  opacity: 1;
}

/* Optionnel : lisibilité un peu plus “solide” */
.gate-card .gate-input{
  box-shadow: 0 1px 0 rgba(15,23,42,.04) inset;
  border: 1px solid var(--border);
}

/* === Badges + consent (Lovable 2025) === */
.gate-badges{
  display:flex; flex-wrap:wrap; gap:10px; justify-content:center;
  margin:12px auto 16px; max-width:720px;
}
.badge{
  display:inline-flex; align-items:center; gap:8px;
  padding:10px 14px; border-radius:999px;
  background:#fff; border:1px solid var(--border);
  box-shadow:0 6px 16px rgba(15,23,42,.06);
  font-weight:700; color:#111827;
}
.badge span{opacity:.85; font-weight:700;}
.badge b{font-weight:800;}

.gate-consent{
  display:flex; align-items:flex-start; gap:8px;
  max-width:680px; margin:8px auto 0;
  font-size:14px; color:#334155;
}
.gate-consent input{ margin-top:3px; }

.gate-proof{
  max-width:680px; margin:10px auto 0;
  padding:10px 12px; border-radius:10px;
  background:#ecfdf5; border:1px solid #a7f3d0;
  color:#065f46; font-size:14px; font-weight:600;
}
.gate-hint{
  max-width:680px; margin:8px auto 0;
  font-size:12px; color:#64748b;
}

/* Forcer les pavés financiers à s'afficher en pleine largeur dans la grille des résultats */
.result-grid .financial-banner,
.result-grid .financial-card{
  grid-column: 1 / -1;
}

/* Ligne “pleine largeur” dans la grille du formulaire */
.gate-form .full{ grid-column:1 / -1; }

/* Nouvelle ligne consentement sous les inputs */
.gate-consentline{
  display:flex; align-items:flex-start; gap:10px;
  font-size:14px; color:#334155;
  margin-top:6px;
}
.gate-consentline input{ margin-top:3px; }

/* Spacings révisés pour l’ordre demandé */
.gate-hint{ margin-top:6px; }
.gate-proof{ margin-top:10px; }
.gate-cta{ margin-top:14px; }

/* === Alignement propre de la case SMS (Lovable 2025) === */
.gate-consentline{
  grid-column:1 / -1;
  display:flex;
  align-items:center;
  gap:8px;
  justify-content:center; /* tu peux mettre flex-start si tu préfères à gauche */
  font-size:14px;
  color:#334155;
  margin-top:8px;
}
.gate-consentline input{
  margin:0;
}



</style>

</head>

<body>
<header class="hero">

     <!-- Logos certifications (haut-gauche) -->
    <div class="certifs" aria-label="Labels et certifications">
      <img class="certifs__img" src="https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/687b0f048a98e03f86e7852020887ff4f05eb913/icone%20RGE.webp" alt="Label RGE – Reconnu Garant de l’Environnement">
      <img class="certifs__img certifs__img--main" src="https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/687b0f048a98e03f86e7852020887ff4f05eb913/logo%20SSP.webp" alt="Solution Solaire Pro">
      <img class="certifs__img" src="https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/687b0f048a98e03f86e7852020887ff4f05eb913/icone%20qualipv.webp" alt="Certification QualiPV 2025">
    </div>
  <div class="hero__inner">
    <div>
      <h1 class="title">
        Coût installation<br>panneaux solaires dans<br><em>l’Eure-et-Loir (28)</em>
      </h1>
      <p class="lead">Estimez gratuitement le coût d’installation, la production et vos économies en moins d’une minute.</p>
    </div>

   <div class="panel">
  <form onsubmit="return __handleSubmitEtape1(event)" novalidate>
    <div class="pill">Coût de votre installation & économies en direct</div>

    <div class="row">
      <label class="rect">
        <input
          id="codePostal"
          type="text"
          placeholder="Votre code postal (ex : 28000)"
          inputmode="numeric"
          maxlength="5"
          pattern="[0-9]{5}"
          autocomplete="postal-code"
          required
        >
      </label>

      <label class="rect">
        <input
          id="facture"
          type="text"
          placeholder="Votre facture élec / an (ex : 1 800 €)"
          inputmode="decimal"
          autocomplete="off"
          required
        >
      </label>
    </div>

    <label class="option">
      <input
        id="conso"
        type="text"
        placeholder="kWh/an – pour affiner le calcul (facultatif)"
        inputmode="decimal"
        autocomplete="off"
      >
    </label>

    <button id="simuler" class="cta" type="submit">⚡ Calculer mon coût maintenant</button>
  </form>
</div>
</header>


<main>
    <!-- RÉSULTATS DE SIMULATION -->
  <div id="recap" style="display:none"></div>
  <div id="lockedSection" style="display:none"></div>

  <section class="steps-2025">
    <div class="steps-2025__inner">
      <h2 class="steps-2025__title">Un simulateur qui va à l’essentiel</h2>
      <p class="steps-2025__subtitle">Un processus simple et transparent en 3 étapes</p>

      <div class="steps-2025__grid">
        <article class="steps-2025__item">
          <span class="steps-2025__num">01</span>
          <h3 class="steps-2025__heading">Étude personnalisée</h3>
          <p class="steps-2025__text">Votre étude personnalisée selon votre consommation.</p>
        </article>
        <article class="steps-2025__item">
          <span class="steps-2025__num">02</span>
          <h3 class="steps-2025__heading">Économies estimées</h3>
          <p class="steps-2025__text">Vos économies estimées dès la 1<sup>re</sup> année.</p>
        </article>
        <article class="steps-2025__item">
          <span class="steps-2025__num">03</span>
          <h3 class="steps-2025__heading">Coût précis & financement</h3>
          <p class="steps-2025__text">Le coût précis de l’installation et son financement.</p>
        </article>
      </div>

      <div class="steps-2025__note">
        <p>Rien de superflu. Juste les chiffres qui comptent.</p>
        <div class="steps-2025__check">
          <svg viewBox="0 0 24 24" width="60" height="60" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <circle cx="12" cy="12" r="11" fill="#22c55e"/>
            <path d="M7 12.5l3.2 3.2L17 9" fill="none" stroke="#ffffff" stroke-width="2.6" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>
    </div>

    <section class="why" aria-labelledby="why-title">
  <div class="why__inner">
    <header class="why__head">
      <h2 id="why-title" class="why__title">Pourquoi passer à l’énergie solaire&nbsp;?</h2>
      <p class="why__subtitle">Les bénéfices concrets d’une installation photovoltaïque chez vous</p>
    </header>

    <div class="why__grid">
      <!-- Carte 1 -->
      <article class="why__card">
        <div class="why__top">
          <div class="why__icon" aria-hidden="true">
            <!-- icône tendance ↘ -->
            <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M4 7h2.9l5.2 6.2 3.2-3.4H20v2h-3.7l-3.2 3.4L6.9 9H4z"/></svg>
          </div>
          <h3 class="why__heading">Économies importantes</h3>
        </div>
        <p class="why__text">Baissez durablement votre facture d’électricité grâce à l’autoconsommation.</p>
      </article>

      <!-- Carte 2 -->
      <article class="why__card">
        <div class="why__top">
          <div class="why__icon" aria-hidden="true">
            <!-- icône feuille -->
            <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M12 3C6 3 3 9 3 13c0 4 3 8 9 8 6 0 9-4 9-8 0-6-3-10-9-10zm1.6 6.2c2.4 0 4.4 1.8 4.4 4.1 0 2.9-2.2 5.6-6 6.2-2.6.4-5.2-.9-5.2-3.3 0-3.6 3.8-7 6.8-7z"/></svg>
          </div>
          <h3 class="why__heading">Énergie propre</h3>
        </div>
        <p class="why__text">Produisez localement une énergie renouvelable et réduisez votre empreinte carbone.</p>
      </article>

      <!-- Carte 3 -->
      <article class="why__card">
        <div class="why__top">
          <div class="why__icon" aria-hidden="true">
            <!-- icône éclair -->
            <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M13 3L4 14h6l-1 7 9-11h-6l1-7z"/></svg>
          </div>
          <h3 class="why__heading">Performance actuelle</h3>
        </div>
        <p class="why__text">Panneaux de dernière génération, rendement élevé et suivi transparent de la production.</p>
      </article>

      <!-- Carte 4 -->
      <article class="why__card">
        <div class="why__top">
          <div class="why__icon" aria-hidden="true">
            <!-- icône bouclier -->
            <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M12 2l8 3v6c0 5-3.5 9.7-8 11-4.5-1.3-8-6-8-11V5l8-3z"/></svg>
          </div>
          <h3 class="why__heading">Garantie et pérennité</h3>
        </div>
        <p class="why__text">Matériel garanti, installation durable et service après-vente local.</p>
      </article>
    </div>
  </div>
</section>

    <!-- CHIFFRES CLÉS – fond panneaux full black, style épuré -->
    <section class="stats-bg" aria-labelledby="stats-title">
      <h2 id="stats-title" class="sr-only">Chiffres clés</h2>
      <div class="stats-bg__inner">
        <div class="stat">
          <div class="stat__value">+300</div>
          <div class="stat__label">Installations en Centre-Val de Loire</div>
        </div>
        <div class="stat">
          <div class="stat__value">30 ans</div>
          <div class="stat__label">Garantie matériel</div>
        </div>
        <div class="stat">
          <div class="stat__value">70%</div>
          <div class="stat__label">d’économies moyennes</div>
        </div>
        <div class="stat">
          <div class="stat__value">98%</div>
          <div class="stat__label">Clients satisfaits</div>
        </div>
      </div>
    </section>
  </section>

 <!-- ================== AVIS CLIENTS ================== -->
<section class="testi" aria-labelledby="testi-title">
  <div class="testi__inner">
    <header class="testi__head">
      <h2 id="testi-title" class="testi__title">Ils ont utilisé notre simulateur</h2>
      <p class="testi__meta" aria-label="Note moyenne">
        ★★★★☆ &nbsp; <strong>4,7 / 5</strong> — extraits d’avis clients récents (12 derniers mois)
      </p>
    </header>

    <div class="testi__grid" style="grid-template-columns:repeat(auto-fit,minmax(280px,1fr));max-width:950px;margin:0 auto;">
      <!-- Avis 1 -->
      <article class="tcard" aria-label="Avis client">
        <div class="tcard__top">
          <div class="avatar" aria-hidden="true">HB</div>
          <div>
            <div class="tcard__name">Hervé B.</div>
            <div class="tcard__loc">Chartres (28) · 05/2025</div>
          </div>
        </div>
        <div class="stars" aria-label="Note 5 sur 5">
          <svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)">
            <path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/>
          </svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)">
            <path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/>
          </svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)">
            <path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/>
          </svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)">
            <path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/>
          </svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)">
            <path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/>
          </svg>
        </div>
        <p class="tcard__text">“Estimation rapide et claire. Les chiffres annoncés sont cohérents avec ma conso.”</p>
      </article>

      <!-- Avis 2 -->
      <article class="tcard" aria-label="Avis client">
        <div class="tcard__top">
          <div class="avatar" aria-hidden="true">CR</div>
          <div>
            <div class="tcard__name">Camille R.</div>
            <div class="tcard__loc">Dreux (28) · 06/2025</div>
          </div>
        </div>
        <div class="stars" aria-label="Note 4 sur 5">
          <svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)">
            <path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/>
          </svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)">
            <path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/>
          </svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)">
            <path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/>
          </svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)">
            <path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/>
          </svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:#d1d5db)">
            <path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/>
          </svg>
        </div>
        <p class="tcard__text">“Présentation simple et résultats fiables. Permet de juger si le projet est cohérent.”</p>
      </article>

      <!-- Avis 3 -->
      <article class="tcard" aria-label="Avis client">
        <div class="tcard__top">
          <div class="avatar" aria-hidden="true">JM</div>
          <div>
            <div class="tcard__name">Julie M.</div>
            <div class="tcard__loc">Lucé (28) · 04/2025</div>
          </div>
        </div>
        <div class="stars" aria-label="Note 5 sur 5">
          <svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)">
            <path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/>
          </svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)">
            <path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/>
          </svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)">
            <path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/>
          </svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)">
            <path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/>
          </svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)">
            <path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/>
          </svg>
        </div>
        <p class="tcard__text">“Le coût est affiché noir sur blanc, avec une projection claire sur 15 ans.”</p>
      </article>
    </div>
  </div>
</section>
<section class="faq" aria-labelledby="faq-title">
  <div class="faq__inner">
    <header class="faq__head">
      <h2 id="faq-title" class="faq__title">Questions fréquentes</h2>
      <p class="faq__subtitle">Tout ce qu’il faut savoir avant de passer à l’énergie solaire</p>
    </header>

    <div class="faq__list faq">
      <!-- Q1 -->
      <details>
        <summary>
          Comment est calculée mon estimation ?
          <svg class="faq__chev" width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </summary>
        <div class="faq__panel">
          Elle s’appuie sur votre consommation annuelle (ou facture), un prix du kWh indicatif, l’ensoleillement local et
          un scénario technique standard. Les résultats restent des ordres de grandeur.
        </div>
      </details>

      <!-- Q2 -->
      <details>
        <summary>
          Combien de panneaux pour mon cas ?
          <svg class="faq__chev" width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </summary>
        <div class="faq__panel">
          Cela dépend de votre conso, de l’espace disponible, de l’orientation/inclinaison et des ombres. Le simulateur propose une fourchette dimensionnée.
        </div>
      </details>

      <!-- Q3 -->
      <details>
        <summary>
          Quelles économies puis-je espérer ?
          <svg class="faq__chev" width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </summary>
        <div class="faq__panel">
          Elles varient selon votre profil et votre taux d’autoconsommation. Nous affichons un ordre de grandeur la 1<sup>re</sup> année et une projection à 15 ans, sans promesse fixe.
        </div>
      </details>

      <!-- Q4 -->
      <details>
        <summary>
          Revente d’électricité&nbsp;: est-ce intéressant ?
          <svg class="faq__chev" width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </summary>
        <div class="faq__panel">
          Aujourd’hui, l’autoconsommation reste le levier principal. La revente à prix de marché est faible&nbsp;(~centimes/kWh). Nous dimensionnons d’abord pour consommer sur place.
        </div>
      </details>

      <!-- Q5 -->
      <details>
        <summary>
          Quelles contraintes pour ma toiture ?
          <svg class="faq__chev" width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </summary>
        <div class="faq__panel">
          Toiture saine et étanche, absence d’amiante, charge admissible OK. Orientation sud idéale, est/ouest acceptable. Les ombres proches sont à éviter.
        </div>
      </details>

      <!-- Q6 -->
      <details>
        <summary>
          Combien de temps dure l’installation ?
          <svg class="faq__chev" width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </summary>
        <div class="faq__panel">
          La pose standard prend 1 à 2 jours. Les démarches (Enedis, Consuel, administratif) suivent un calendrier séparé.
        </div>
      </details>

      <!-- Q7 -->
      <details>
        <summary>
          Garanties et entretien ?
          <svg class="faq__chev" width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </summary>
        <div class="faq__panel">
          Garanties fabricant 25–30 ans selon les modèles (puissance dégressive). Peu d’entretien&nbsp;: contrôle visuel et rinçage ponctuel si dépôts.
        </div>
      </details>

      <!-- Q8 -->
      <details>
        <summary>
          Aides financières et financement ?
          <svg class="faq__chev" width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </summary>
        <div class="faq__panel">
          Nous privilégions la transparence&nbsp;: coût posé noir sur blanc, sans artifices. Des mensualités sont possibles. Les aides évoluent&nbsp;: nous précisons ce qui est éligible lors de l’étude.
        </div>
      </details>
    </div>
  </div>

  <!-- Mentions légales -->
<div class="legal">
  <div class="legal__inner">
    <span id="mentions-legales-link" class="legal__link">Mentions légales</span>
    <hr class="sep">
  </div>
</div>

<!-- Popup Mentions -->
<div id="mentions-popup" role="dialog" aria-modal="true" aria-labelledby="mentions-title">
  <button id="close-mentions" type="button" aria-label="Fermer">&times;</button>
  <strong id="mentions-title">Mentions légales :</strong><br>
  Solution Solaire Pro, marque de Biofrance Énergies<br>
  SIRET : 422 231 928 00025<br>
  Adresse : 4 rue du Pont Saint Jean, 27530 Ézy-sur-Eure<br>
  Contact : solutionsolairepro@gmail.com<br>
  Hébergeur : GitHub Pages, 88 Colin P. Kelly Jr. Street, San Francisco CA 94107 USA<br>
  Données personnelles : Les informations saisies sont utilisées uniquement pour traiter votre demande. Aucun démarchage ni revente.<br>
  RGPD : Suppression possible sur simple demande par e-mail.
</div>

</section>

<script>
document.addEventListener('click', (e)=>{
  if(e.target.closest('summary')){
    const d = e.target.closest('details');
    if(!d) return;
    const group = d.parentElement;
    // Ferme les autres items du même groupe
    group.querySelectorAll('details[open]').forEach(x => { if(x!==d) x.removeAttribute('open'); });
  }
});

  // Mentions légales – ouverture/fermeture
document.addEventListener("DOMContentLoaded", ()=>{
  const link=document.getElementById("mentions-legales-link");
  const popup=document.getElementById("mentions-popup");
  const close=document.getElementById("close-mentions");
  if(link && popup && close){
    link.addEventListener("click", e=>{e.preventDefault();popup.style.display="block";});
    close.addEventListener("click", e=>{e.preventDefault();popup.style.display="none";});
  }
});

</script>

<!-- === Overlay "Calcul en cours…" — Étape 1 === -->
<div id="calc-overlay" role="alertdialog" aria-modal="true" aria-labelledby="calc-title" aria-describedby="calc-desc">
  <div class="panel" tabindex="-1">
    <div class="spinner" aria-hidden="true"></div>
    <h3 id="calc-title" class="title">Calcul en cours…</h3>
    <p id="calc-desc" class="desc">
  ⚡ Nous préparons votre estimation…<br>
  <small>(calcul en cours)</small>
</p>

  </div>
</div>

<script>
  (function(){
    const overlay   = document.getElementById('calc-overlay');
    const btn       = document.getElementById('simuler');
    const inputCP   = document.getElementById('codePostal');
    const inputFact = document.getElementById('facture');

    function showCalcOverlay(msg){
      if (!overlay) return;
      if (msg) { const t = overlay.querySelector('#calc-title'); if (t) t.textContent = msg; }
      overlay.style.display = 'flex';
      document.body.classList.add('no-scroll');
      overlay.querySelector('.panel')?.focus();
      if (btn) { btn.disabled = true; btn.style.opacity = '0.7'; }
    }
    function hideCalcOverlay(){
      if (!overlay) return;
      overlay.style.display = 'none';
      document.body.classList.remove('no-scroll');
      if (btn) { btn.disabled = false; btn.style.opacity = '1'; }
    }
    function validateStep1(){
      const cp = (inputCP?.value || '').trim();
      const factureRaw = (inputFact?.value || '');
      const num = parseFloat(factureRaw.replace(/\s/g,'').replace(',', '.').replace(/[^0-9.]/g,''));
      const okCP = /^[0-9]{5}$/.test(cp);
      const okFact = Number.isFinite(num) && num > 0;
      if (!okCP)  { alert('Veuillez entrer un code postal valide (5 chiffres).'); return false; }
      if (!okFact){ alert("Veuillez indiquer une facture annuelle valide."); return false; }
      return true;
    }

    async function fetchScenarios(departement){
      try{
        const r = await fetch('https://script.google.com/macros/s/AKfycbwhlyD_FMMm2g9JIQAm2Se2xehUqIM2MzWMl1YGl_gP1DJKM_-jZFj_YStDMhWi-0F8XA/exec');
        const data = await r.json();
        return (data || [])
          .filter(row => String(row.Departement||'') === String(departement))
          .map(row => ({
            prixKwh: parseFloat(String(row.PrixKwh||'').replace(',', '.').replace(/[^0-9.]/g,'')),
            puissance: row.Puissance,
            prod: parseFloat(row.Prod),
            seuil: parseFloat(row.Seuil),
            panels: parseInt(row.Panels),
            prix: parseFloat(row.Prix),
            remiseChantier: parseFloat(String(row.RemiseChantier||'').replace(',', '.').replace(/[^0-9.]/g,'')),
            mensualite: parseFloat(row.Mensualite),
            taeg: parseFloat(row.Taeg),
            total: parseFloat(row.Total),
            dureeMois: parseInt(row.Mois)
          }));
      }catch(e){
        console.error('fetchScenarios error', e);
        alert("Impossible de charger les données, réessayez plus tard.");
        return [];
      }
    }

    window.__handleSubmitEtape1 = async function(ev){
      ev.preventDefault();
      showCalcOverlay('Calcul en cours…');

      if (!validateStep1()){
        hideCalcOverlay();
        return false;
      }

      const departement = (inputCP.value.trim()).substring(0,2);
      const scenarios = await fetchScenarios(departement);

      if (!scenarios.length){
        hideCalcOverlay();
        alert('Aucune donnée disponible pour ce département.');
        return false;
      }

      console.log('Scénarios chargés :', scenarios.length, scenarios);

      // --- Calculs ---
      const cp = inputCP.value.trim();
      const facture = parseFloat((inputFact.value || '')
        .replace(/\s/g,'').replace(',', '.').replace(/[^0-9.]/g,'')
      );

      const inputConso = document.getElementById('conso');
      let conso, prixKwh;
      if (inputConso && inputConso.value) {
        conso   = parseFloat((inputConso.value || '').replace(/\s/g,'').replace(',', '.').replace(/[^0-9.]/g,''));
        prixKwh = facture / conso;
      } else {
        prixKwh = scenarios[0].prixKwh;
        conso   = facture / prixKwh;
      }

      const minProd = Math.min(...scenarios.map(s => Number(s.prod) || 0));
      if (conso < minProd) {
        alert("Consommation trop faible : installation non conseillée.");
        hideCalcOverlay();
        return false;
      }
      let sc = scenarios.filter(s => (s.prod||0) <= conso).sort((a,b)=> (b.prod||0) - (a.prod||0))[0];
      if (!sc) sc = scenarios.sort((a,b)=> (b.prod||0) - (a.prod||0))[0];

      // --- Rendu ---
      const recap = document.getElementById('recap');
      if (!recap){
        console.warn('#recap manquant dans le HTML');
        hideCalcOverlay();
        return false;
      }
     // --- Calculs affichés (ajoutés juste avant le rendu) ---
const autocons = Math.min(Number(sc.prod||0), Number(conso||0));
const gainAn   = autocons * (Number.isFinite(prixKwh) ? prixKwh : 0);
const gainMois = gainAn / 12;

// ➕ Nouveau calcul — économie cumulée sur 15 ans avec +3 %/an
const taux = 0.03;
const duree = 15;
const facteurCumul = (Math.pow(1 + taux, duree) - 1) / taux;
const gain15 = gainAn * facteurCumul;

const prixBrut = Number.isFinite(sc.prix) ? sc.prix : null;
const remise   = Number.isFinite(sc.remiseChantier) ? sc.remiseChantier : 0;
const prixNet  = prixBrut !== null ? Math.max(0, prixBrut - remise) : null;


// --- Rendu (overlay à partir de l'autoconsommation) ---
const visiblePart = `
  <div class="kpi">
    <div class="label">Code postal</div>
    <div class="value">${cp}</div>
  </div>

  <div class="kpi">
    <div class="label">Conso annuelle estimée</div>
    <div class="value" style="color:#0f172a">${Math.round(conso).toLocaleString('fr-FR')} kWh</div>
  </div>

  <div class="kpi">
    <div class="label">Prix du kWh utilisé</div>
    <div class="value">${(Number.isFinite(prixKwh)?prixKwh:0).toFixed(3)} €</div>
  </div>

  <div class="kpi">
    <div class="label">Facture annuelle</div>
    <div class="value">${(Number.isFinite(facture)?facture:0).toLocaleString('fr-FR')} €</div>
  </div>

  <div class="kpi kpi--highlight" style="grid-column:1/-1">
    <div class="label">Dimensionnement proposé</div>
    <div class="value">
      ${sc.puissance} — ${sc.panels} panneaux (500 W) • Production estimée 
      <span style="color:#16a34a;font-weight:800">${(sc.prod||0).toLocaleString('fr-FR')} kWh/an</span>
    </div>
  </div>
`;

const lockedPart = `
  <div class="kpi" style="grid-column:1/-1">
    <div class="value" style="font-size:18px;font-weight:700;color:#16a34a;margin-bottom:6px">
      ${((autocons / conso) * 100).toFixed(1)} % <span style="color:#0f172a;font-weight:600">de votre consommation est couverte par votre production</span>
    </div>
    <div style="color:#334155;font-size:13px;line-height:1.5;margin-top:2px">
      Votre production est valorisée à 100&nbsp;% grâce à la batterie virtuelle, même si elle ne couvre pas 100&nbsp;% de votre consommation. 
      <em>Hypothèse standard&nbsp;: exposition Sud/Sud-Est, pente de toit 35°.</em>
    </div>
  </div>

  <div class="kpi">
    <div class="label">Gain 1ʳᵉ année (ordre de grandeur)</div>
    <div class="value" style="color:#16a34a">
      ${Math.round(gainAn).toLocaleString('fr-FR')} € / an
    </div>
  </div>

  <div class="kpi">
    <div class="label">Économie moyenne mensuelle</div>
    <div class="value" style="color:#16a34a">
      ${Math.round(gainMois).toLocaleString('fr-FR')} € / mois
    </div>
  </div>

  <div class="kpi" style="grid-column:1/-1">
    <div class="label">Économie cumulée sur 15 ans</div>
    <div class="value" style="color:#16a34a">
      ${Math.round(gain15).toLocaleString('fr-FR')} €
    </div>
    <div class="note" style="margin-top:4px">
      Hypothèses&nbsp;: prix du kWh +3&nbsp;%/an, production constante, ordre de grandeur indicatif.
    </div>
  </div>

  ${ (Number.isFinite(sc.remiseChantier) && sc.remiseChantier > 0) ? `
    <div class="financial-banner" style="text-align:center; background:#fff7ed; border:1px solid #fcd34d; border-radius:12px; padding:18px; margin:24px 0">
      <div style="font-weight:700; color:#7c2d12; margin-bottom:4px">Offre spéciale « Groupage chantiers »</div>
      <div style="font-size:22px; font-weight:900; color:#7c2d12;">
        ${Math.round(sc.remiseChantier).toLocaleString('fr-FR')} € de remise immédiate
      </div>
      <div class="note" style="margin-top:6px; color:#334155">(à déduire du prix TTC indiqué ci-dessous)</div>
      <div class="note" style="margin-top:4px; color:#334155"><strong>Valable jusqu’au 31 octobre 2025</strong></div>
    </div>
  ` : `` }

  <div class="financial-card">
    <h3 class="financial-title">Coût et financement</h3>
    ${ Number.isFinite(sc.prix) ? `
      <p style="margin:0 0 8px"><strong>Installation ${sc.puissance}</strong> :
        <span class="token">${Math.round(sc.prix).toLocaleString('fr-FR')} € TTC</span>
        <span class="note">(prix indicatif hors options)</span>
      </p>` : `` }

    ${ Number.isFinite(sc.mensualite) ? `
      <p style="margin:10px 0 4px; font-weight:700">Option financement <span class="note">(facultatif)</span></p>
      <div class="tokens">
        <span class="token">${sc.mensualite.toLocaleString('fr-FR')} € / mois</span>
        ${ Number.isFinite(sc.dureeMois) ? `<span class="token">Durée : ${sc.dureeMois} mois</span>` : `` }
        ${ Number.isFinite(sc.taeg) ? `<span class="token">TAEG fixe : ${sc.taeg}%</span>` : `` }
      </div>
      ${ Number.isFinite(sc.total) ? `
        <p style="margin:6px 0 0"><strong>Prix total</strong> :
          <span class="token">${Number(sc.total).toLocaleString('fr-FR', {minimumFractionDigits:2, maximumFractionDigits:2})} €</span>
        </p>` : `` }
      <p class="note" style="margin:10px 0 0">Financement proposé par notre partenaire, sous réserve d’acceptation.</p>
      <div class="note note-alert">⚠️ Un crédit vous engage et doit être remboursé. Vérifiez vos capacités de remboursement avant de vous engager.</div>
      <p class="note" style="margin:8px 0 0">Estimation indicative. Une visite technique est nécessaire pour un devis ferme.</p>
    ` : `` }
  </div>
`;

const gate = `
  <div class="gate-overlay" id="gate-overlay" role="dialog" aria-modal="true" aria-labelledby="gate-title">
    <div class="gate-card">
      <h3 id="gate-title" class="gate-title">Vous avez vu vos panneaux et votre production…</h3>
      <p class="gate-sub"><strong>Et si on allait plus loin&nbsp;?</strong></p>
      <p class="gate-sub">Découvrez le coût précis, vos économies et votre mensualité fixe.<br>
        Profitez de <strong>la remise immédiate</strong> <span class="gate-deadline">(jusqu’au 31/10/2025)</span>.
      </p>

      <!-- Badges confiance -->
      <div class="gate-badges" aria-hidden="true">
        <div class="badge"><span>🔒</span><b>Données protégées</b></div>
        <div class="badge"><span>⚡</span><b>Étude affichée immédiatement à l’écran</b></div>
      </div>

      <!-- Form -->
      <form id="gate-form" class="gate-form" novalidate>
  <!-- 1) Ligne champs -->
  <input id="gate-email" class="gate-input" type="email"
         placeholder="Votre email (facultatif)" autocomplete="email" />
  <input id="gate-phone" class="gate-input" type="tel"
         placeholder="Téléphone (obligatoire)" autocomplete="tel" required />

  <!-- 2) Consentement — pleine largeur -->
  <div class="gate-consentline full">
    <input id="gate-consent" type="checkbox" />
    <label for="gate-consent">Je consens à être contacté <strong>par SMS uniquement</strong>.</label>
  </div>

  <!-- 3) Hint — pleine largeur -->
  <div class="gate-hint full">
    Un SMS de confirmation vous sera envoyé. Libre à vous d’échanger ensuite.
  </div>

  <!-- 4) Preuve — pleine largeur -->
  <div class="gate-proof full">
    ✅ Votre projet s’autofinance grâce à vos économies. Vérifiez-le par vous-même&nbsp;!
  </div>

  <!-- CTA — pleine largeur -->
  <button class="gate-cta full" type="submit">Voir mon étude complète et mes économies</button>
</form>


      <div class="gate-note">Vos données ne seront jamais revendues ni utilisées à d’autres fins.</div>
    </div>
  </div>
`;


recap.innerHTML = `
  <div class="result-card" role="region" aria-label="Votre estimation personnalisée">
    <h2>Votre estimation personnalisée</h2>

    <div class="result-grid" style="margin-top:12px">
      ${visiblePart}
    </div>

    <!-- Zone verrouillée -->
    <div class="lock-zone" id="lock-zone">
      <div class="result-grid lock-blur" id="lock-blur" style="margin-top:12px">
        ${lockedPart}
      </div>
      ${gate}
    </div>
  </div>
`;




   

recap.style.display = 'block';
document.body.classList.add('results-mode');
recap.scrollIntoView({ behavior: 'smooth', block: 'start' });
// Gestion du déverrouillage à la saisie
(function initGate(){
  const form  = document.getElementById('gate-form');
  const blur  = document.getElementById('lock-blur');
  const gate  = document.getElementById('gate-overlay');

  if(!form || !blur || !gate) return;

  form.addEventListener('submit', (e)=>{
    e.preventDefault();
    const phone = String(document.getElementById('gate-phone')?.value || '').trim();
    const email = String(document.getElementById('gate-email')?.value || '').trim();

    // Validation simple téléphone FR (10 chiffres)
    const digits = phone.replace(/\D/g,'');
    if(digits.length < 10){
      alert('Merci d’indiquer un numéro de téléphone valide (10 chiffres).');
      return;
    }

    // Déverrouillage
    blur.classList.remove('lock-blur');
    gate.remove();

    // (optionnel) stocker les données pour futur envoi
    // window.__leadOverlay = { phone: digits, email };
  });
})();


      hideCalcOverlay();
      return false;
    };
  })();
</script>


</body>
</html>


  
