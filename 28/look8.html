<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Coût installation panneaux solaires | Eure-et-Loir (28)</title>
<meta name="robots" content="noindex,nofollow,noarchive">

<!-- Canonical (adapter si besoin) -->
<link rel="canonical" href="https://www.solution-solaire.pro/28/cout-installation-panneaux-solaires.html">

<!-- Préconnexions -->
<link rel="preconnect" href="https://raw.githubusercontent.com" crossorigin>
<link rel="dns-prefetch" href="//raw.githubusercontent.com">
<link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
<link rel="dns-prefetch" href="//www.googletagmanager.com">

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=AW-11242044118"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  /* Consent par défaut : refus */
  gtag('consent', 'default', {
    ad_storage: 'denied',
    analytics_storage: 'denied',
    ad_user_data: 'denied',
    ad_personalization: 'denied',
    wait_for_update: 500
  });
  /* Recos Google */
  gtag('set', 'ads_data_redaction', true);
  gtag('set', 'url_passthrough', true);
  /* Init */
  gtag('js', new Date());
  gtag('config', 'AW-11242044118');
  /* Mise à jour au consentement */
  window.__grantAdsConsent = function(){
    gtag('consent','update', {
      ad_storage:'granted',
      analytics_storage:'granted',
      ad_user_data:'granted',
      ad_personalization:'granted'
    });
  };
</script>
<!-- Conversions Google Ads -->
<script>
  function gtag_report_conversion() {
    try { gtag('event','conversion',{ send_to:'AW-11242044118/MslOCKGZzo0bENb1z_Ap' }); } catch(e){}
    return true;
  }
  window.__simConvSent = false;
  function gtag_report_simulation() {
    try {
      gtag('event','conversion',{
        send_to:'AW-11242044118/TM3qCM3e1Z8bENbiz_Ap',
        value:1.0,currency:'EUR'
      });
    } catch(e){}
  }
</script>

<style>
  :root{
    /* Layout */
    --hero-h-desktop: 95vh;
    --hero-h-mobile: 100svh;
    --hero-min: 700px;
    --maxw: 1100px;

    /* Palette */
    --accent:#f59e0b;
    --accent-2:#f7b733;
    --ink:#0f172a;
    --muted:#64748b;
    --border:#e5e7eb;
    --ok:#22c55e;
    --card:#ffffff;
  }

  *{box-sizing:border-box;margin:0;padding:0}
  body{font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial;color:#fff;background:#fff}

  /* ================== HERO ================== */
  header.hero{
    position:relative;
    height:var(--hero-h-desktop);
    min-height:var(--hero-min);
    overflow:hidden;
    isolation:isolate;
  }
  header.hero::before{
    content:"";
    position:absolute; inset:0;
    background:
      linear-gradient(90deg,
        rgba(5,12,24,.82) 0%,
        rgba(7,16,30,.66) 34%,
        rgba(10,18,28,.42) 62%,
        rgba(12,20,28,.22) 100%),
      url("https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/1ea92369de57361354807811188559129b45985c/foto%20fond.webp")
      center 35%/cover no-repeat;
    z-index:-1;
  }

  .hero__inner{
    max-width:var(--maxw);
    margin:0 auto;
    padding:60px clamp(16px,4vw,40px);
    display:grid;
    grid-template-columns:1.1fr 0.9fr;
    gap:clamp(20px,4vw,42px);
    height:100%;
    align-items:center;
  }
  @media (max-width:860px){
    .hero__inner{grid-template-columns:1fr;text-align:center;align-items:flex-end;padding-bottom:80px;}
  }

  .title{
    margin:0 0 14px;
    font-weight:900;
    line-height:1.1;
    font-size:clamp(28px,4.4vw,52px);
  }
  .title em{color:var(--accent);font-style:normal;text-shadow:0 2px 10px rgba(245,158,11,.3);}
  .lead{margin:8px 0 0;color:rgba(255,255,255,.9);max-width:54ch;}

  /* Logos certifications dans le héros */
  .certifs {
    position: absolute;
    top: 18px;
    left: 18px;
    display: flex;
    align-items: center;
    gap: 12px;
    z-index: 5;
  }
  .certifs__img { height: 36px; width: auto; display: block; filter: drop-shadow(0 1px 3px rgba(0,0,0,.25)); }
  .certifs__img--main { height: 76px; margin: 0 3px; }
  .certifs__img[src*="qualipv"] { height: 44px; }
  .certifs__img[src*="RGE.webp"] { height: 32px; }
  @media (max-width: 860px) {
    .certifs { top: 12px; left: 12px; gap: 8px; }
    .certifs__img { height: 28px; }
    .certifs__img--main { height: 52px; }
    .certifs__img[src*="qualipv"] { height: 34px; }
    .certifs__img[src*="RGE.webp"] { height: 26px; }
  }

  /* Form hero */
  .panel{display:flex;flex-direction:column;gap:12px;width:100%;}
  .pill{display:flex;align-items:center;justify-content:center;min-height:46px;background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#1b1202;font-weight:800;border-radius:6px;box-shadow:0 10px 26px rgba(245,158,11,.25);}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
  .rect,.option{display:flex;align-items:center;padding:12px 14px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.22);border-radius:6px;}
  input{width:100%;background:transparent;border:0;color:#fff;font:inherit;}
  input::placeholder{color:rgba(255,255,255,.85);}
  .cta{display:inline-flex;align-items:center;justify-content:center;min-height:48px;width:100%;background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#1b1202;font-weight:900;border:0;border-radius:6px;box-shadow:0 10px 26px rgba(245,158,11,.25);cursor:pointer;}
  .inputs input { font-size: 15px; padding: 10px 12px; }

  /* ================== SECTION 3 ÉTAPES ================== */
  .steps-2025{background:#fff;padding:clamp(40px,7vw,80px) 16px;color:var(--ink);}
  .steps-2025__inner{max-width:var(--maxw);margin:0 auto;text-align:center;}
  .steps-2025__title{font-weight:800;font-size:clamp(26px,3.8vw,44px);margin-bottom:6px;}
  .steps-2025__subtitle{color:var(--muted);margin-bottom:clamp(28px,5vw,48px);}
  .steps-2025__grid{display:grid;gap:clamp(18px,3vw,28px);grid-template-columns:1fr;}
  @media(min-width:860px){.steps-2025__grid{grid-template-columns:repeat(3,1fr);}}
  .steps-2025__item{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:clamp(18px,3vw,26px);box-shadow:0 10px 28px rgba(2,6,23,.06);display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;}
  .steps-2025__num{width:72px;height:72px;border-radius:50%;display:grid;place-items:center;font-weight:800;color:#fff;background:linear-gradient(180deg,var(--accent),#fdba74);box-shadow:0 10px 24px rgba(245,158,11,.25);font-size:22px;margin-bottom:12px;}
  .steps-2025__heading{margin:0;font-weight:800;font-size:clamp(18px,2.2vw,22px);}
  .steps-2025__text{margin:6px 0 0;color:var(--muted);font-size:clamp(14px,1.6vw,16px);}
  .steps-2025__note{margin:clamp(40px,6vw,60px) 0 0;display:flex;flex-direction:column;align-items:center;gap:18px;}
  .steps-2025__note p{font-weight:700;color:var(--ink);font-size:clamp(16px,2vw,20px);}

  /* ================== CHIFFRES CLÉS ================== */
  .stats-bg{
    width:100vw;
    margin-left:calc(50% - 50vw);
    margin-top:clamp(72px,9vw,140px);
    position:relative;
    padding:clamp(48px,9vw,96px) 16px;
    color:#fff;
    overflow:hidden;
    isolation:isolate;
  }
  .stats-bg::before{
    content:"";
    position:absolute; inset:0;
    background:url("https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/687b0f048a98e03f86e7852020887ff4f05eb913/bande%20panneaux%20full%20black.webp")
    center/cover no-repeat;
    filter:brightness(1.02) saturate(.95);
    z-index:-1;
  }
  .stats-bg__inner{max-width:var(--maxw);margin:0 auto;display:grid;grid-template-columns:1fr;gap:clamp(14px,3vw,20px);text-align:center;}
  @media (min-width:820px){.stats-bg__inner{grid-template-columns:repeat(4,1fr);}}
  .stat{padding:clamp(10px,2vw,14px);}
  .stat__value{font-weight:900;letter-spacing:-.02em;font-size:clamp(34px,5.5vw,56px);line-height:1.05;color:var(--accent);text-shadow:0 2px 10px rgba(0,0,0,.25);}
  .stat__label{margin-top:4px;font-size:clamp(14px,1.7vw,16px);color:rgba(255,255,255,.92);text-shadow:0 1px 4px rgba(0,0,0,.25);}

  /* ================== AVIS ================== */
  .testi{background:#fff;color:var(--ink);margin-top:clamp(40px,6vw,80px);padding:clamp(28px,6vw,60px) 16px;}
  .testi__inner{max-width:var(--maxw);margin:0 auto;}
  .testi__head{text-align:center;margin-bottom:clamp(18px,3vw,28px);}
  .testi__title{font-weight:900;line-height:1.15;font-size:clamp(26px,3.6vw,40px);margin:0 0 8px;}
  .testi__meta{color:var(--muted);font-size:clamp(14px,1.8vw,16px);}
  .testi__grid{display:grid;gap:clamp(16px,2.6vw,22px);grid-template-columns:1fr;}
  @media (min-width:1024px){.testi__grid{grid-template-columns:repeat(3,1fr);}}
  .tcard{background:#fff;border:1px solid var(--border);border-radius:16px;padding:clamp(16px,2.6vw,22px);box-shadow:0 10px 24px rgba(2,6,23,.06);display:flex;flex-direction:column;gap:12px;}
  .tcard__top{display:flex;align-items:center;gap:12px;}
  .avatar{width:44px;height:44px;border-radius:999px;display:grid;place-items:center;font-weight:700;color:#111827;background:linear-gradient(180deg,#fff6e5,#ffe4bf);border:1px solid #f1c987;}
  .tcard__name{font-weight:800;}
  .tcard__loc{color:var(--muted);font-size:14px;margin-top:2px;}
  .tcard__text{color:#334155;font-style:italic}

  /* ================== POURQUOI ================== */
  .why{background:#f7f9fc;color:var(--ink);padding:clamp(40px,7vw,90px) 16px;margin-top:clamp(40px,6vw,80px);}
  .why__inner{max-width:var(--maxw);margin:0 auto;}
  .why__head{text-align:center;margin-bottom:clamp(22px,4vw,34px);}
  .why__title{font-weight:900;line-height:1.1;font-size:clamp(28px,4vw,48px);margin:0 0 10px;}
  .why__subtitle{color:var(--muted);font-size:clamp(14px,1.9vw,18px);}
  .why__grid{display:grid;gap:clamp(14px,2.4vw,20px);grid-template-columns:1fr;}
  @media (min-width:860px){ .why__grid{grid-template-columns:repeat(2,1fr);} }
  @media (min-width:1180px){ .why__grid{grid-template-columns:repeat(4,1fr);} }
  .why__card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:clamp(18px,2.6vw,24px);box-shadow:0 10px 24px rgba(2,6,23,.06);}

  /* ================== FAQ ================== */
  .faq{background:#f7f9fc;color:var(--ink);margin-top:clamp(56px,8vw,96px);padding:clamp(32px,7vw,80px) 16px;}
  .faq__inner{max-width:var(--maxw);margin:0 auto;}
  .faq__head{text-align:center;margin-bottom:clamp(18px,3.6vw,28px);}
  .faq__title{font-weight:900;font-size:clamp(28px,4vw,48px);margin:0 0 8px;line-height:1.1;}
  .faq__subtitle{color:var(--muted);font-size:clamp(14px,1.9vw,18px);}
  .faq__list{display:grid;gap:12px;}
  .faq details{background:#fff;border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 24px rgba(2,6,23,.06);overflow:hidden;}
  .faq summary {list-style:none;cursor:pointer;display:flex;align-items:center;gap:10px;padding:18px 20px;font-weight:800;font-size:clamp(15px, 1.9vw, 17px);color:var(--ink);transition: color .25s ease;}
  .faq summary:hover, details[open] summary {color: var(--accent);}
  .faq summary::-webkit-details-marker{display:none;}
  .faq__chev{margin-left:auto;transition:transform .2s ease;flex:0 0 auto;opacity:.7;}
  details[open] .faq__chev{transform:rotate(180deg);opacity:1;}
  .faq__panel{padding:0 20px 18px 20px;color:var(--muted);font-size:clamp(14px,1.8vw,16px);line-height:1.55;border-top:1px solid var(--border);background:#fbfbfd;}

  /* Mentions légales (mini-popup) */
  .legal{background:#f7f9fc;color:var(--ink);padding:24px 16px;margin-top:clamp(40px,6vw,80px)}
  .legal__inner{max-width:var(--maxw);margin:0 auto;text-align:center}
  .legal__link{color:#0b61d8;text-decoration:underline;font-weight:800;cursor:pointer}
  .legal .sep{border:0;border-top:1px solid var(--border);margin:16px auto 0;max-width:var(--maxw)}
  #mentions-popup{
    display:none;position:fixed;left:50%;bottom:64px;transform:translateX(-50%);
    width:360px;max-width:95vw;background:#fff;color:var(--ink);
    border:1px solid var(--border);border-radius:14px;padding:18px 20px 14px;
    box-shadow:0 10px 36px rgba(2,6,23,.15);z-index:9999;font-size:13px;line-height:1.7
  }
  #close-mentions{
    position:absolute;top:6px;right:12px;background:none;border:0;color:var(--ink);
    font-size:20px;font-weight:800;cursor:pointer
  }

  /* ====== Cartes résultats / verrou ====== */
  .card{background:#fff;border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 24px rgba(2,6,23,.06);}
  .content-card{max-width: 720px;margin: 0 auto;padding: 18px;color: var(--ink);}
  .recap-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media(max-width:560px){.recap-grid{grid-template-columns:1fr}}
  .recap-item{background:#fff;border:1px solid var(--border);border-radius:12px;padding:12px 14px}
  .recap-item .label{color:#374151;font-size:13px}
  .value-ok{color:var(--ok);font-weight:700}
  .lockedContent{filter:blur(7px);user-select:none;pointer-events:none}
  .veil{position:relative;border-radius:16px;background:linear-gradient(180deg,rgba(255,255,255,.75),rgba(255,255,255,.98));backdrop-filter:blur(2px);display:flex;flex-direction:column;align-items:center;gap:12px;text-align:center;padding:20px;border:1px solid var(--border);margin-top:12px}

  /* Overlay calcul */
  body.no-scroll{overflow:hidden}
  #calc-overlay{position:fixed;inset:0;background:rgba(2,6,23,.35);backdrop-filter:blur(2px);display:none;z-index:9998;align-items:center;justify-content:center;padding:20px}
  #calc-overlay .panel{width:100%;max-width:360px;background:#fff;border:1px solid var(--border);border-radius:14px;box-shadow:0 14px 36px rgba(2,6,23,.12);padding:18px;text-align:center;outline:none}
  #calc-overlay .spinner{width:42px;height:42px;margin:6px auto 12px;border:4px solid #e5e7eb;border-top:4px solid var(--accent);border-radius:50%;animation:spin 1s linear infinite}
  @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
</style>
</head>

<body>
  <!-- Consent Mode V2 – bandeau -->
  <div id="consent-banner" class="consent-banner" role="dialog" aria-live="polite" aria-label="Préférences de confidentialité" style="position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid var(--border);color:#111827;padding:12px;z-index:9999;display:none;box-shadow:0 -6px 26px rgba(0,0,0,.12);font:14px/1.5 system-ui,Segoe UI,Roboto;min-height:56px">
    <div class="consent-inner" style="max-width:900px;margin:0 auto;display:flex;gap:14px;align-items:center;justify-content:space-between;flex-wrap:wrap">
      <div class="consent-text" style="flex:1 1 520px;font-size:14px;color:#374151">Nous utilisons des technologies pour la mesure et la publicité. Vous pouvez refuser.</div>
      <div class="consent-buttons" style="display:flex;gap:10px">
        <button id="consent-reject" type="button" style="padding:8px 16px;border-radius:999px;font-weight:700;cursor:pointer;border:none;font-size:14px;background:#111827;color:#fff">Tout refuser</button>
        <button id="consent-accept" type="button" style="padding:8px 16px;border-radius:999px;font-weight:700;cursor:pointer;border:none;font-size:14px;background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#1b1202">Tout accepter</button>
      </div>
    </div>
  </div>

<header class="hero">
  <!-- Logos certifications (haut-gauche) -->
  <div class="certifs" aria-label="Labels et certifications">
    <img class="certifs__img" src="https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/687b0f048a98e03f86e7852020887ff4f05eb913/icone%20RGE.webp" alt="Label RGE – Reconnu Garant de l’Environnement">
    <img class="certifs__img certifs__img--main" src="https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/687b0f048a98e03f86e7852020887ff4f05eb913/logo%20SSP.webp" alt="Solution Solaire Pro">
    <img class="certifs__img" src="https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/687b0f048a98e03f86e7852020887ff4f05eb913/icone%20qualipv.webp" alt="Certification QualiPV 2025">
  </div>

  <div class="hero__inner">
    <div>
      <h1 class="title">Coût installation<br>panneaux solaires dans<br><em>l’Eure-et-Loir (28)</em></h1>
      <p class="lead">Estimez gratuitement le coût d’installation, la production et vos économies en moins d’une minute.</p>
    </div>

    <!-- Formulaire (logique identique; IDs conservés) -->
    <div class="panel card" style="padding:16px">
      <div class="pill">Coût de votre installation & économies en direct</div>
      <form onsubmit="calculerSimulation(); return false;" novalidate>
        <div class="row inputs" style="margin-top:8px">
          <label class="rect"><input type="text" id="codePostal" placeholder="Votre code postal (ex : 28000)" inputmode="numeric" maxlength="5" pattern="[0-9]{5}" autocomplete="postal-code" required></label>
          <label class="rect"><input type="text" id="facture" placeholder="Votre facture élec / an (ex : 1 800 €)" inputmode="decimal" autocomplete="off" required></label>
        </div>
        <label id="modeAvance" class="option" style="display:none"><input type="text" id="conso" placeholder="Conso annuelle (kWh, optionnel)" inputmode="decimal" autocomplete="off"></label>
        <a href="#" id="lienAvance" class="legal__link" style="align-self:center">➕ Vous connaissez votre consommation annuelle ? Cliquez ici</a>
        <button id="simuler" class="cta" type="submit">⚡ Calculer mon coût maintenant</button>
      </form>
    </div>
  </div>
</header>

<main>
  <!-- Étapes (masquées après calcul) -->
  <section class="steps-2025" data-hide-after-sim="1">
    <div class="steps-2025__inner">
      <h2 class="steps-2025__title">Un simulateur qui va à l’essentiel</h2>
      <p class="steps-2025__subtitle">Un processus simple et transparent en 3 étapes</p>

      <div class="steps-2025__grid">
        <article class="steps-2025__item"><span class="steps-2025__num">01</span><h3 class="steps-2025__heading">Étude personnalisée</h3><p class="steps-2025__text">Votre étude selon votre consommation.</p></article>
        <article class="steps-2025__item"><span class="steps-2025__num">02</span><h3 class="steps-2025__heading">Économies estimées</h3><p class="steps-2025__text">Chiffrées dès la première année.</p></article>
        <article class="steps-2025__item"><span class="steps-2025__num">03</span><h3 class="steps-2025__heading">Coût & financement</h3><p class="steps-2025__text">Prix posé + mensualité possible.</p></article>
      </div>

      <div class="steps-2025__note"><p>Rien de superflu. Juste les chiffres qui comptent.</p></div>
    </div>
  </section>

  <!-- Pourquoi (masquée après calcul) -->
  <section class="why" aria-labelledby="why-title" data-hide-after-sim="1">
    <div class="why__inner">
      <header class="why__head">
        <h2 id="why-title" class="why__title">Pourquoi passer à l’énergie solaire&nbsp;?</h2>
        <p class="why__subtitle">Les bénéfices concrets d’une installation photovoltaïque chez vous</p>
      </header>
      <div class="why__grid">
        <article class="why__card"><h3 style="font-weight:800;margin:0 0 6px">Économies importantes</h3><p>Baissez durablement votre facture grâce à l’autoconsommation.</p></article>
        <article class="why__card"><h3 style="font-weight:800;margin:0 0 6px">Énergie propre</h3><p>Produisez une énergie renouvelable et réduisez votre empreinte carbone.</p></article>
        <article class="why__card"><h3 style="font-weight:800;margin:0 0 6px">Performance actuelle</h3><p>Panneaux de dernière génération, rendement élevé.</p></article>
        <article class="why__card"><h3 style="font-weight:800;margin:0 0 6px">Garantie & pérennité</h3><p>Matériel garanti, installation durable et SAV local.</p></article>
      </div>
    </div>
  </section>

  <!-- Chiffres clés (masqués après calcul) -->
  <section class="stats-bg" aria-labelledby="stats-title" data-hide-after-sim="1">
    <h2 id="stats-title" class="sr-only">Chiffres clés</h2>
    <div class="stats-bg__inner">
      <div class="stat"><div class="stat__value">+300</div><div class="stat__label">Installations en Centre-Val de Loire</div></div>
      <div class="stat"><div class="stat__value">30 ans</div><div class="stat__label">Garantie matériel</div></div>
      <div class="stat"><div class="stat__value">70%</div><div class="stat__label">d’économies moyennes</div></div>
      <div class="stat"><div class="stat__value">98%</div><div class="stat__label">Clients satisfaits</div></div>
    </div>
  </section>

  <!-- Avis (masqués après calcul) -->
  <section class="testi" aria-labelledby="testi-title" data-hide-after-sim="1">
    <div class="testi__inner">
      <header class="testi__head">
        <h2 id="testi-title" class="testi__title">Ils ont utilisé notre simulateur</h2>
        <p class="testi__meta">★★★★☆ &nbsp; <strong>4,7 / 5</strong> — extraits d’avis clients récents</p>
      </header>
      <div class="testi__grid" style="grid-template-columns:repeat(auto-fit,minmax(280px,1fr));max-width:950px;margin:0 auto;">
        <article class="tcard"><div class="tcard__top"><div class="avatar">HB</div><div><div class="tcard__name">Hervé B.</div><div class="tcard__loc">Chartres (28) · 05/2025</div></div></div><p class="tcard__text">“Estimation rapide et claire. Les chiffres sont cohérents.”</p></article>
        <article class="tcard"><div class="tcard__top"><div class="avatar">CR</div><div><div class="tcard__name">Camille R.</div><div class="tcard__loc">Dreux (28) · 06/2025</div></div></div><p class="tcard__text">“Présentation simple pour juger la cohérence du projet.”</p></article>
        <article class="tcard"><div class="tcard__top"><div class="avatar">JM</div><div><div class="tcard__name">Julie M.</div><div class="tcard__loc">Lucé (28) · 04/2025</div></div></div><p class="tcard__text">“Le coût est affiché noir sur blanc, projection 15 ans.”</p></article>
      </div>
    </div>
  </section>

  <!-- Récap (VISIBLE après calcul) -->
  <div id="recap" class="card content-card" style="display:none;visibility:hidden;height:0;overflow:hidden;"></div>

  <!-- SECTION VERROUILLÉE (floue) -->
  <div id="lockedSection" class="card content-card" style="display:none;visibility:hidden;height:0;overflow:hidden; border:5px solid var(--accent); border-radius:16px; padding:20px;">
    <div id="lockedContent" class="lockedContent"></div>
    <div class="veil" id="veil">
      <h2 style="margin:0 0 15px">Vous avez vu vos panneaux et votre production…<br><span style="color:#f97316">💡 Et si on allait plus loin ?</span></h2>
      <ul style="margin:12px auto;color:#374151;list-style:none;padding:0;max-width:600px;font-size:1rem;line-height:1.55">
        <li style="margin:6px 0"><strong style="color:#111827">Découvrez</strong> le coût précis de votre installation</li>
        <li style="margin:6px 0"><strong style="color:#111827">Voyez immédiatement</strong> vos économies et votre mensualité fixe</li>
        <li style="margin:6px 0"><strong style="color:#d97706">Profitez</strong> de 800 € de remise immédiate <span style="color:#d97706">(jusqu’au 31/10/2025)</span></li>
      </ul>
      <div style="display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin:10px 0 0 0">
        <span style="display:flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:#fff;box-shadow:0 6px 16px rgba(2,6,23,.08);min-height:42px;font-weight:700"><span>🔒</span><span>Données protégées</span></span>
        <span style="display:flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:#fff;box-shadow:0 6px 16px rgba(2,6,23,.08);min-height:42px;font-weight:700"><span>⚡</span><span>Étude affichée immédiatement</span></span>
      </div>
      <div class="unlock" style="margin-top:10px;display:grid;grid-template-columns:1fr 1fr;gap:10px;max-width:560px;width:100%">
        <div class="field"><label for="emailUnlock" class="label">Email <span style="color:#6b7280;font-weight:600">(facultatif)</span></label><input type="email" id="emailUnlock" placeholder="Votre email (facultatif)" autocomplete="email" style="width:100%;padding:12px 14px;border-radius:12px;border:1.5px solid var(--border);background:#fff"></div>
        <div class="field"><label for="telUnlock" class="label">Téléphone <span>(obligatoire)</span></label><input type="tel" id="telUnlock" placeholder="06 12 34 56 78" autocomplete="tel" required style="width:100%;padding:12px 14px;border-radius:12px;border:1.5px solid var(--border);background:#fff"><div class="help" style="font-size:13px;color:#6b7280;margin-top:4px">Un SMS de confirmation vous sera envoyé.</div></div>
        <label class="consent" style="grid-column:1/-1;display:flex;gap:8px;align-items:flex-start;color:#374151;font-size:13px;text-align:left"><input type="checkbox" id="rgpdUnlock" required aria-required="true" style="width:auto;margin-top:3px"><span>Je consens à être contacté <strong>par SMS uniquement</strong>.</span></label>
        <div style="grid-column:1/-1;text-align:center;margin:6px 0;color:#111827;font-size:14px;font-style:italic">✅ Votre projet s’autofinance grâce à vos économies.</div>
        <button type="button" class="cta" style="grid-column:1/-1" onclick="submitUnlock(event)"><span aria-hidden="true">📊</span>&nbsp;Voir mon étude complète et mes économies</button>
        <div class="foot" style="grid-column:1/-1;text-align:center;color:#6b7280;font-size:12px;margin-top:6px">Vos données ne seront jamais revendues.</div>
      </div>
    </div>
  </div>

  <!-- FAQ -->
  <section class="faq" aria-labelledby="faq-title" data-hide-after-sim="1">
    <div class="faq__inner">
      <header class="faq__head"><h2 id="faq-title" class="faq__title">Questions fréquentes</h2><p class="faq__subtitle">Tout ce qu’il faut savoir avant de passer à l’énergie solaire</p></header>
      <div class="faq__list">
        <details><summary>Comment est calculée mon estimation ?<svg class="faq__chev" width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></summary><div class="faq__panel">Conso annuelle (ou facture), prix du kWh, ensoleillement local, scénario technique standard. Résultats = ordres de grandeur.</div></details>
        <details><summary>Quelles économies puis-je espérer ?<svg class="faq__chev" width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></summary><div class="faq__panel">Varie selon votre profil et taux d’autoconsommation. On affiche l’année 1 et une projection à 15 ans.</div></details>
        <details><summary>La revente est-elle intéressante ?<svg class="faq__chev" width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></summary><div class="faq__panel">Aujourd’hui l’autoconsommation prime; la revente est faible (~centimes/kWh). On dimensionne pour consommer sur place.</div></details>
      </div>
    </div>
  </section>

  <!-- Mentions légales -->
  <div class="legal">
    <div class="legal__inner">
      <span id="mentions-legales-link" class="legal__link">Mentions légales</span>
      <hr class="sep">
    </div>
  </div>
  <div id="mentions-popup" role="dialog" aria-modal="true" aria-labelledby="mentions-title">
    <button id="close-mentions" type="button" aria-label="Fermer">&times;</button>
    <strong id="mentions-title">Mentions légales :</strong><br>
    Solution Solaire Pro, marque de Biofrance Énergies<br>
    SIRET : 422 231 928 00025<br>
    Adresse : 4 rue du Pont Saint Jean, 27530 Ézy-sur-Eure<br>
    Contact : solutionsolairepro@gmail.com<br>
    Hébergeur : GitHub Pages, 88 Colin P. Kelly Jr. Street, San Francisco CA 94107 USA<br>
    Données personnelles : Les informations saisies sont utilisées uniquement pour traiter votre demande. Aucun démarchage ni revente.<br>
    RGPD : Suppression possible sur simple demande par e-mail.
  </div>
</main>

<!-- Overlay calcul -->
<div id="calc-overlay" role="alertdialog" aria-modal="true" aria-labelledby="calc-title" aria-describedby="calc-desc">
  <div class="panel" tabindex="-1">
    <div class="spinner" aria-hidden="true"></div>
    <h3 id="calc-title" class="title" style="color:#111827">Calcul en cours…</h3>
    <p id="calc-desc" class="desc" style="color:#374151">Nous générons votre estimation (quelques secondes).</p>
  </div>
</div>

<script>
  /* Animation Mentions + conso avancée + format tel + FAQ (open exclusif) */
  document.addEventListener("DOMContentLoaded", function(){
    const link = document.getElementById('mentions-legales-link');
    const popup = document.getElementById('mentions-popup');
    const closeBtn = document.getElementById('close-mentions');
    if (link && popup && closeBtn) { link.onclick = (e)=>{ e.preventDefault(); popup.style.display='block'; }; closeBtn.onclick = (e)=>{ e.preventDefault(); popup.style.display='none'; }; }

    const lienAvance = document.getElementById('lienAvance');
    if (lienAvance) { lienAvance.onclick = function(e){ e.preventDefault(); document.getElementById('modeAvance').style.display='block'; this.style.display='none'; }; }

    const telUnlock = document.getElementById('telUnlock');
    if(telUnlock){
      telUnlock.addEventListener('input', function(e){
        let val = e.target.value.replace(/\D/g,'').slice(0,10);
        e.target.value = val.replace(/(\d{2})(?=\d)/g,'$1 ').trim();
      });
    }

    document.addEventListener('click', (e)=>{
      if(e.target.closest('summary')){
        const d = e.target.closest('details');
        if(!d) return;
        const group = d.parentElement;
        group.querySelectorAll('details[open]').forEach(x => { if(x!==d) x.removeAttribute('open'); });
      }
    });
  });

  /* Consent Mode – logique bandeau */
  (function(){
    const KEY='consent_v2';
    const banner=document.getElementById('consent-banner');
    const btnAccept=document.getElementById('consent-accept');
    const btnReject=document.getElementById('consent-reject');
    function updateConsent(state){
      gtag('consent','update',{
        analytics_storage:   state.analytics ? 'granted' : 'denied',
        ad_storage:          state.ads ? 'granted' : 'denied',
        ad_user_data:        state.adUserData ? 'granted' : 'denied',
        ad_personalization:  state.adPersonal ? 'granted' : 'denied'
      });
    }
    function save(s){ try{ localStorage.setItem(KEY, JSON.stringify(s)); }catch(e){} }
    function load(){ try{ return JSON.parse(localStorage.getItem(KEY)||'null'); }catch(e){ return null; } }

    const saved=load();
    if(saved){ updateConsent(saved); banner.style.display='none'; }
    else{
      banner.style.display='block'; banner.style.opacity='0'; banner.style.transform='translateY(10px)';
      requestAnimationFrame(()=>{ banner.style.transition='opacity .18s ease, transform .18s ease'; banner.style.opacity='1'; banner.style.transform='translateY(0)'; });
    }

    btnAccept.addEventListener('click', ()=>{ const s={analytics:true,ads:true,adUserData:true,adPersonal:true}; updateConsent(s); save(s); banner.style.display='none'; });
    btnReject.addEventListener('click', ()=>{ const s={analytics:false,ads:false,adUserData:false,adPersonal:false}; updateConsent(s); save(s); banner.style.display='none'; });
  })();

  /* Trace UTM/GCLID */
  (function(){
    const p = new URLSearchParams(location.search);
    const track = {
      utm_source:(p.get('utm_source')||''), utm_medium:(p.get('utm_medium')||''), utm_campaign:(p.get('utm_campaign')||''),
      utm_adgroup:(p.get('utm_adgroup')||''), utm_term:(p.get('utm_term')||''), utm_matchtype:(p.get('utm_matchtype')||''),
      utm_device:(p.get('utm_device')||''), gclid:(p.get('gclid')||''), gbraid:(p.get('gbraid')||''), wbraid:(p.get('wbraid')||'')
    };
    const isAds = track.gclid || track.gbraid || track.wbraid ||
                  (track.utm_source.toLowerCase()==='google' && track.utm_medium.toLowerCase()==='cpc');
    if(isAds){ try{ localStorage.setItem('ads_tracking_v1', JSON.stringify({ t: Date.now(), ...track })); }catch(e){} }
    window.__getAdsTrack = function(){
      try{
        const raw = localStorage.getItem('ads_tracking_v1'); if(!raw) return track;
        const obj = JSON.parse(raw); if(Date.now()-(obj.t||0) > 7*24*60*60*1000) return track; return obj;
      }catch(e){ return track; }
    };
  })();

  /* ======== LOGIQUE SIMULATEUR (identique à l'ancienne) ======== */
  const qs = new URLSearchParams(location.search);
  const UNLOCK_KEY = 'pv_unlock_until_v3';
  const FORCE_LOCK = qs.get('lock') === '1';
  let scenarios = [];
  let selectedScenario = null;

  function esc(s){ return String(s).replace(/[&<>\"']/g, m => ({'&':'&','<':'&lt;','>':'&gt;','\"':'&quot;','\'':'&#39;'}[m])); }
  function isUnlocked(){ if (FORCE_LOCK) return false; try{ return Date.now() < parseInt(localStorage.getItem(UNLOCK_KEY)||'0',10);}catch(e){return false;} }
  function setUnlocked(hours){ if (FORCE_LOCK) return; try{ localStorage.setItem(UNLOCK_KEY, String(Date.now()+(hours||24)*3600*1000)); }catch(e){} }
  function unlockUI(){
    const lc = document.getElementById('lockedContent'); if(lc){ lc.style.filter='none'; lc.style.userSelect='auto'; lc.style.pointerEvents='auto'; }
    const veil = document.getElementById('veil'); if(veil){ veil.style.display='none'; }
  }
  function hideAfterSimulationBlocks(){ document.querySelectorAll('[data-hide-after-sim]').forEach(el => el.style.display='none'); }
  function showCalcOverlay(msg){
    const ov = document.getElementById('calc-overlay'); if(!ov) return;
    if (msg) { const t = ov.querySelector('#calc-title'); if (t) t.textContent = msg; }
    ov.style.display='flex'; document.body.classList.add('no-scroll'); ov.querySelector('.panel')?.focus();
  }
  function hideCalcOverlay(){ const ov = document.getElementById('calc-overlay'); if(!ov) return; ov.style.display='none'; document.body.classList.remove('no-scroll'); }

  function fetchScenarios(departement){
    return fetch('https://script.google.com/macros/s/AKfycbwhlyD_FMMm2g9JIQAm2Se2xehUqIM2MzWMl1YGl_gP1DJKM_-jZFj_YStDMhWi-0F8XA/exec')
      .then(r=>r.json())
      .then(data=>data.filter(row=>String(row.Departement||'')==String(departement)).map(row=>({
        prixKwh: parseFloat((row.PrixKwh||'').toString().replace(',', '.').replace(/[^0-9.]/g,'')),
        puissance: row.Puissance,
        prod: parseFloat(row.Prod),
        seuil: parseFloat(row.Seuil),
        panels: parseInt(row.Panels),
        prix: parseFloat(row.Prix),
        remiseChantier: parseFloat((row.RemiseChantier||'').toString().replace(',', '.').replace(/[^0-9.]/g,'')),
        mensualite: parseFloat(row.Mensualite),
        taeg: parseFloat(row.Taeg),
        total: parseFloat(row.Total),
        dureeMois: parseInt(row.Mois)
      })))
      .catch(_=>{ alert("Impossible de charger les données, réessayez plus tard."); return []; });
  }

  async function calculerSimulation(){
    const btn = document.getElementById('simuler'); if(btn){ btn.disabled=true; btn.style.opacity='0.7'; }
    showCalcOverlay('Calcul en cours…');
    try{
      ['recap','lockedSection'].forEach(id=>{
        const el=document.getElementById(id);
        el.style.display='none'; el.style.visibility='hidden'; el.style.height='0';
        if(id==='lockedSection'){ const lc=document.getElementById('lockedContent'); if(lc) lc.innerHTML=''; const v=document.getElementById('veil'); if(v) v.style.display=''; }
      });

      const codePostal = document.getElementById('codePostal').value.trim();
      const facture = parseFloat((document.getElementById('facture').value + '').replace(',', '.').replace(/\s/g,''));
      const consoInput = document.getElementById('conso');

      if(!/^[0-9]{5}$/.test(codePostal)){ alert("Veuillez entrer un code postal valide."); return; }
      if(isNaN(facture) || facture<=0){ alert("Merci de remplir correctement tous les champs."); return; }

      const departement = codePostal.substring(0,2);
      const data = await fetchScenarios(departement);
      if(data.length===0){ alert("Aucune donnée disponible pour ce département."); return; }
      scenarios = data;

      let conso, prixKwh, consommationEstimee, consoReelleVal="", sourceConso="estimee";
      if(consoInput && consoInput.value){
        const v = parseFloat((consoInput.value + '').replace(',', '.').replace(/\s/g,''));
        if(isNaN(v) || v<=0){ alert("Merci d’indiquer une consommation kWh correcte."); return; }
        conso = v; prixKwh = facture / conso; consommationEstimee = conso; consoReelleVal = Math.round(v); sourceConso = "reelle";
      }else{
        prixKwh = scenarios[0].prixKwh; consommationEstimee = facture / prixKwh; conso = consommationEstimee;
      }

      const minProd = Math.min(...scenarios.map(s=>s.prod));
      if(consommationEstimee < minProd){ alert("Consommation trop faible : installation non conseillée."); return; }
      let scenario = scenarios.filter(s=>s.prod <= consommationEstimee).sort((a,b)=>b.prod - a.prod)[0];
      if(!scenario) scenario = scenarios.sort((a,b)=>b.prod - a.prod)[0];
      selectedScenario = scenario;

      const autoKwh = scenario.prod * 0.6;
      const stockKwh = scenario.prod * 0.4;
      const acheminement = 0.05;

      const factureAvant = conso * prixKwh;
      const autoValue = autoKwh * prixKwh;
      const stockValue = stockKwh * prixKwh;
      const coutAcheminement = stockKwh * acheminement;

      const factureApres = factureAvant - autoValue - stockValue + coutAcheminement;
      const economieAnnuelle = factureAvant - factureApres;
      const economieMensuelle = economieAnnuelle / 12;

      let gain15ans = 0, prixActuel = prixKwh;
      for(let i=0;i<15;i++){
        const autoVal = autoKwh * prixActuel, stockVal = stockKwh * prixActuel, coutAch = stockKwh * acheminement;
        const factureAv = conso * prixActuel, factureAp = factureAv - autoVal - stockVal + coutAch;
        gain15ans += (factureAv - factureAp); prixActuel *= 1.05;
      }

      const taegTxt = Number.isFinite(scenario.taeg) ? scenario.taeg.toFixed(2) + " %" : "—";
      const mensualiteTxt = Number.isFinite(scenario.mensualite) ? scenario.mensualite.toLocaleString('fr-FR',{minimumFractionDigits:2,maximumFractionDigits:2}) + " €" : "—";
      const totalTxt = Number.isFinite(scenario.total) ? scenario.total.toLocaleString('fr-FR',{minimumFractionDigits:2,maximumFractionDigits:2}) + " €" : "—";
      const dureeTxt = Number.isFinite(scenario.dureeMois) ? scenario.dureeMois + " mois" : "—";

      /* Récap (extrait) */
      const recapEl = document.getElementById('recap');
      const libConso = (sourceConso === "reelle") ? "Conso annuelle (réelle)" : "Conso annuelle estimée";
      recapEl.innerHTML = `
        <h2>Votre estimation personnalisée</h2>
        <div class="recap-grid">
          <div class="recap-item"><div class="label">Code postal</div><div class="value">${esc(codePostal)}</div></div>
          <div class="recap-item"><div class="label">${libConso}</div><div class="value value-ok">${Math.round(conso).toLocaleString('fr-FR')} kWh</div></div>
          <div class="recap-item"><div class="label">Prix kWh TTC utilisé</div><div class="value">${prixKwh.toFixed(3)} €</div></div>
          <div class="recap-item"><div class="label">Facture annuelle</div><div class="value">${facture.toLocaleString('fr-FR')} €</div></div>
          <div class="recap-item" style="grid-column:1/-1">
            <div class="label">Puissance & production</div>
            <div class="value value-ok" style="font-size:18px">${esc(scenario.puissance)} — ${scenario.panels} panneaux (500 W) • ${scenario.prod.toLocaleString('fr-FR')} kWh/an</div>
          </div>
        </div>`;
      recapEl.style.display='block'; recapEl.style.visibility='visible'; recapEl.style.height='auto';

      /* Contenu verrouillé (flouté) */
      const locked = document.getElementById('lockedContent');
      const pctCouverture = ((scenario.prod / conso) * 100).toFixed(2);
      locked.innerHTML = `
        <div style="max-width:720px;margin:0 auto 12px">
          <div class="recap-item" style="border:1px solid var(--border);border-radius:12px;padding:12px 14px;background:#fff;margin-bottom:10px"><div class="label">% de votre conso couverte</div><div class="value value-ok">${pctCouverture} %</div></div>
          <span class="note" style="display:block;text-align:center;margin:14px 0;color:#065f46;background:#d1fae5;border:1px solid #a7f3d0;padding:10px 12px;border-radius:12px;font-weight:700;font-size:clamp(14px,1.2vw,16px)">Votre production est valorisée à 100 % grâce à la batterie virtuelle.</span>
          <div style="text-align:center;color:#9ca3af;font-size:11px;margin-top:6px;font-style:italic">Hypothèse standard : exposition Sud/Sud, pente de toit 35°</div>
        </div>
        <div class="kpi">
          <div class="recap-item" style="background:#ecfdf5;border:1px solid #a7f3d0"><strong>Gain estimé la 1ʳᵉ année :</strong> <b style="color:var(--ok)">${Math.round(economieAnnuelle).toLocaleString('fr-FR')} €</b></div>
        </div>
        <div class="recap-item" style="background:#ecfdf5;border:1px solid #a7f3d0"><strong>Soit par mois :</strong> <b style="color:var(--ok)">${Math.round(economieMensuelle).toLocaleString('fr-FR')} €</b></div>
        <div class="recap-item" style="background:#ecfdf5;border:1px solid #a7f3d0"><strong>Économie cumulée sur 15 ans :</strong> <b style="color:var(--ok)">${Math.round(gain15ans).toLocaleString('fr-FR')} €</b></div>
        <div style="border-top:1px solid var(--border);margin:10px 0 12px"></div>
        <div>
          <div style="font-weight:800;color:#111827;margin-bottom:10px">Ce que nous vous proposons</div>
          <ul style="list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:10px">
            <li><b>Remplacer votre facture par un investissement</b> — Une partie de votre budget électricité finance votre installation solaire.</li>
            <li><b>Autofinancement simple</b> — Les économies générées couvrent votre mensualité.</li>
            <li><b>Mensualité fixe</b> — <span style="display:inline-block;padding:2px 10px;border-radius:999px;background:#fff7ed;border:1px solid #fed7aa;font-weight:900;color:#1b1202">${mensualiteTxt}</span> <span style="color:#6b7280">hors assurance</span>.</li>
            <li><b>Protégez-vous des hausses</b> — Devenez propriétaire de votre production.</li>
          </ul>
        </div>
        <div style="background:#fffbeb;border:1px solid #fde68a;border-radius:14px;padding:16px;text-align:center;margin:12px 0">
          <div style="color:#92400e;font-weight:800;font-size:1.05rem;margin-bottom:6px">Offre spéciale “Groupage chantiers”</div>
          <div style="display:flex;justify-content:center;align-items:center;gap:10px;font-size:1.2rem;font-weight:800;color:#1b1202;margin-bottom:2px">
            <span style="display:inline-block;background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#1b1202;padding:8px 14px;border-radius:999px;font-weight:900;box-shadow:0 6px 16px rgba(245,158,11,.25);">${Number.isFinite(scenario.remiseChantier) ? scenario.remiseChantier.toLocaleString('fr-FR') : "—"} €</span>
            <span>de remise immédiate</span>
          </div>
          <div style="font-size:.92rem;color:#6b7280">Offre valable jusqu’au <strong>31 octobre 2025</strong></div>
        </div>
        <div style="background:#fff;border-left:4px solid var(--accent);border-radius:12px;padding:14px;margin-top:10px;color:#1f2937;border:1px solid var(--border)">
          <div style="margin-bottom:10px;line-height:1.55">
            <div style="margin-bottom:6px"><span style="font-weight:700;color:#111827">Installation ${esc(scenario.puissance)} :</span> <span style="display:inline-block;background:#111827;color:#fff;padding:2px 8px;border-radius:999px;font-weight:700;margin-left:6px">${scenario.prix.toLocaleString('fr-FR')} € TTC</span> <span style="color:#6b7280;font-size:.9em;margin-left:8px">(prix indicatif hors options)</span></div>
            <div style="font-weight:700;color:#0b61d8;margin-bottom:4px">Option financement <span style="color:#6b7280;font-weight:600">(facultatif)</span></div>
            <div>
              <span style="display:inline-block;background:#111827;color:#fff;padding:2px 8px;border-radius:999px;font-weight:700">${mensualiteTxt}</span> / mois (hors assurance)
              • Durée : <span style="display:inline-block;background:#111827;color:#fff;padding:2px 8px;border-radius:999px;font-weight:700">${dureeTxt}</span>
              • TAEG fixe : <span style="display:inline-block;background:#111827;color:#fff;padding:2px 8px;border-radius:999px;font-weight:700">${taegTxt}</span>
            </div>
            <div style="margin-top:6px">Prix total : <span style="display:inline-block;background:#111827;color:#fff;padding:2px 8px;border-radius:999px;font-weight:700">${totalTxt}</span></div>
            <div style="margin-top:6px;color:#374151">Financement proposé par notre partenaire Projexio, sous réserve d’acceptation.</div>
          </div>
          <div style="color:#6b7280;font-size:12px">⚠️ Un crédit vous engage et doit être remboursé. Vérifiez vos capacités de remboursement avant de vous engager.</div>
          <div style="color:#6b7280;font-size:12px;margin-top:6px">Estimation indicative. Une visite technique est nécessaire pour un devis ferme.</div>
        </div>`;

      const section = document.getElementById('lockedSection');
      section.style.display='block'; section.style.visibility='visible'; section.style.height='auto';

      // Conversion Ads
      if(!window.__simConvSent){ gtag_report_simulation(); window.__simConvSent = true; }

      // Masquer les blocs “avant sim”
      hideAfterSimulationBlocks();

      if(isUnlocked()) { unlockUI(); }

      // Envoi anonyme (POST)
      const fd = new FormData();
      fd.append("code_postal", codePostal);
      fd.append("conso", Math.round(conso));
      fd.append("conso_reelle", consoReelleVal);
      fd.append("source_conso", sourceConso);
      fd.append("facture", facture);
      fd.append("prod", scenario.prod);
      fd.append("eco1", Math.round(economieAnnuelle));
      fd.append("ecomensuelle", Math.round(economieMensuelle));
      fd.append("eco15", Math.round(gain15ans));
      fd.append("puissance", scenario.puissance);
      fd.append("panneaux", scenario.panels);
      fd.append("prix", scenario.prix);
      fd.append("mensualite", Number.isFinite(scenario.mensualite) ? scenario.mensualite : "");
      fd.append("taeg", Number.isFinite(scenario.taeg) ? scenario.taeg : "");
      fd.append("totalcredit", Number.isFinite(scenario.total) ? scenario.total : "");
      fd.append("mois", Number.isFinite(scenario.dureeMois) ? scenario.dureeMois : "");
      fd.append("email", ""); fd.append("tel", "");
      fd.append("emailUser", ""); fd.append("telephone", "");
      fd.append("unlock", "0");

      const ads = (typeof __getAdsTrack === 'function') ? __getAdsTrack() : {};
      fd.append('utm_source',    ads.utm_source    || '');
      fd.append('utm_medium',    ads.utm_medium    || '');
      fd.append('utm_campaign',  ads.utm_campaign  || '');
      fd.append('utm_adgroup',   ads.utm_adgroup   || '');
      fd.append('utm_term',      ads.utm_term      || '');
      fd.append('utm_matchtype', ads.utm_matchtype || '');
      fd.append('utm_device',    ads.utm_device    || '');
      fd.append('gclid',         ads.gclid         || '');
      fd.append('gbraid',        ads.gbraid        || '');
      fd.append('wbraid',        ads.wbraid        || '');

      fetch('https://script.google.com/macros/s/AKfycbwhlyD_FMMm2g9JIQAm2Se2xehUqIM2MzWMl1YGl_gP1DJKM_-jZFj_YStDMhWi-0F8XA/exec',{method:'POST',mode:'no-cors',body:fd});
    }
    finally {
      hideCalcOverlay();
      const b = document.getElementById('simuler'); if(b){ b.disabled=false; b.style.opacity='1'; }
    }
  }

  function submitUnlock(e){
    if(e){ e.preventDefault(); e.stopPropagation(); }
    const email = (document.getElementById('emailUnlock').value||'').trim();
    const tel = (document.getElementById('telUnlock').value||'').replace(/\D/g,'');
    const consent = document.getElementById('rgpdUnlock').checked;
    if(email && !/^\S+@\S+\.\S+$/.test(email)) { alert("Email invalide."); return; }
    if(!tel || tel.length<10){ alert("Téléphone invalide (10 chiffres)."); return; }
    if(!consent){ alert("Merci de cocher la case de consentement."); return; }
    if(!selectedScenario){ alert("Veuillez d’abord lancer une simulation."); return; }

    const codePostal = document.getElementById('codePostal').value.trim();
    const facture = parseFloat((document.getElementById('facture').value + '').replace(',', '.').replace(/\s/g,''));

    const consoInput = document.getElementById('conso');
    let conso, prixKwh, consoReelleVal="", sourceConso="estimee";
    if (consoInput && consoInput.value) {
      const v = parseFloat((consoInput.value + '').replace(',', '.').replace(/\s/g,''));
      if (!isNaN(v) && v > 0) { conso=v; prixKwh=facture/conso; consoReelleVal=Math.round(v); sourceConso="reelle"; }
    }
    if (!conso) { prixKwh = selectedScenario.prixKwh; conso = facture / prixKwh; }

    const autoKwh = selectedScenario.prod * 0.6;
    const stockKwh = selectedScenario.prod * 0.4;
    const acheminement = 0.05;

    const factureAvant = conso * prixKwh;
    const autoValue = autoKwh * prixKwh;
    const stockValue = stockKwh * prixKwh;
    const coutAcheminement = stockKwh * acheminement;

    const factureApres = factureAvant - autoValue - stockValue + coutAcheminement;
    const economieAnnuelle = factureAvant - factureApres;
    const economieMensuelle = economieAnnuelle / 12;

    let gain15ans = 0, prixActuel = prixKwh;
    for (let i=0;i<15;i++){
      const autoVal = autoKwh * prixActuel;
      const stockVal = stockKwh * prixActuel;
      const coutAch = stockKwh * acheminement;
      const factureAv = conso * prixActuel;
      const factureAp = factureAv - autoVal - stockVal + coutAch;
      gain15ans += (factureAv - factureAp);
      prixActuel *= 1.05;
    }

    const recapHTML  = document.getElementById('recap')?.outerHTML || "";
    const resultHTML = document.getElementById('lockedContent')?.outerHTML || "";

    const fd = new FormData();
    fd.append("code_postal", codePostal);
    fd.append("conso", Math.round(conso));
    fd.append("conso_reelle", consoReelleVal);
    fd.append("source_conso", sourceConso);
    fd.append("facture", facture);
    fd.append("prod", selectedScenario.prod);
    fd.append("eco1", Math.round(economieAnnuelle));
    fd.append("ecomensuelle", Math.round(economieMensuelle));
    fd.append("eco15", Math.round(gain15ans));
    fd.append("puissance", selectedScenario.puissance);
    fd.append("panneaux", selectedScenario.panels);
    fd.append("prix", selectedScenario.prix);
    fd.append("mensualite", Number.isFinite(selectedScenario.mensualite) ? selectedScenario.mensualite : "");
    fd.append("taeg", Number.isFinite(selectedScenario.taeg) ? selectedScenario.taeg : "");
    fd.append("totalcredit", Number.isFinite(selectedScenario.total) ? selectedScenario.total : "");
    fd.append("mois", Number.isFinite(selectedScenario.dureeMois) ? selectedScenario.dureeMois : "");
    fd.append("email", email); fd.append("tel", tel);
    fd.append("emailUser", email); fd.append("telephone", tel);
    fd.append("unlock", "1");
    fd.append("sendEmail",  email ? "1" : "0");
    fd.append("recapHTML",  recapHTML);
    fd.append("resultHTML", resultHTML);

    const ads = (typeof __getAdsTrack === 'function') ? __getAdsTrack() : {};
    fd.append('utm_source',    ads.utm_source    || '');
    fd.append('utm_medium',    ads.utm_medium    || '');
    fd.append('utm_campaign',  ads.utm_campaign  || '');
    fd.append('utm_adgroup',   ads.utm_adgroup   || '');
    fd.append('utm_term',      ads.utm_term      || '');
    fd.append('utm_matchtype', ads.utm_matchtype || '');
    fd.append('utm_device',    ads.utm_device    || '');
    fd.append('gclid',         ads.gclid         || '');
    fd.append('gbraid',        ads.gbraid        || '');
    fd.append('wbraid',        ads.wbraid        || '');

    fetch('https://script.google.com/macros/s/AKfycbwhlyD_FMMm2g9JIQAm2Se2xehUqIM2MzWMl1YGl_gP1DJKM_-jZFj_YStDMhWi-0F8XA/exec',{method:'POST',mode:'no-cors',body:fd});

    try{ gtag('event','unlock_report',{method:'overlay'}); gtag_report_conversion(); }catch(e){}
    unlockUI(); setUnlocked(24);
  }
</script>

</body>
</html>
