<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />

<title>Coût installation panneaux solaires | Eure-et-Loir (28)</title> 
<meta name="description" content="Coût installation panneaux solaires dans l'Eure-et-Loir (28) : estimation claire et immédiate, gratuite et sans engagement. Calculez votre coût et vos économies en 1 minute.">

<link rel="canonical" href="https://www.solution-solaire.pro/28/cout-installation-panneaux-solaires.html"> 

<meta name="robots" content="index, follow"> 
<link rel="preconnect" href="https://raw.githubusercontent.com" crossorigin>
<link rel="dns-prefetch" href="//raw.githubusercontent.com">
<link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
<link rel="dns-prefetch" href="//www.googletagmanager.com">

<script async src="https://www.googletagmanager.com/gtag/js?id=AW-11242044118"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }

  /* Consent par défaut : refus */
  gtag('consent', 'default', {
    ad_storage: 'denied',
    analytics_storage: 'denied',
    ad_user_data: 'denied',
    ad_personalization: 'denied',
    wait_for_update: 500
  });

  /* Recos Google */
  gtag('set', 'ads_data_redaction', true);
  gtag('set', 'url_passthrough', true);

  /* Init */
  gtag('js', new Date());
  gtag('config', 'AW-11242044118');
</script>

<script>
  function gtag_report_conversion() {
    try { gtag('event','conversion',{ send_to:'AW-11242044118/MslOCKGZzo0bENb1z_Ap' }); } catch(e){}
    return true;
  }
  
  // Flag pour ne déclencher la simulation qu'une fois
  window.__simConvSent = false;
  
  function gtag_report_simulation() {
    if (window.__simConvSent) return; // Ne pas renvoyer
    try {
      gtag('event','conversion',{
        send_to:'AW-11242044118/TM3qCM3e1Z8bENbiz_Ap',
        value:1.0,currency:'EUR'
      });
      window.__simConvSent = true; // Marquer comme envoyé
    } catch(e){}
  }
</script>

<style>
  :root{
    /* Layout */
    --hero-h-desktop: 95vh;
    --hero-h-mobile: 100svh;
    --hero-min: 700px;
    --maxw: 1100px;

    /* Palette */
    --accent:#f59e0b;
    --accent-2:#f7b733;
    --ink:#0f172a;
    --muted:#64748b;
    --border:#e6e8ef;
    --ok:#16a34a;
    --card:#ffffff;
    --surface:#f9fafb;
  }

  /* Base */
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font:16px/1.45 system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
    color:var(--ink); background:var(--surface);
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    font-variant-numeric:tabular-nums;
  }

  /* ================== HERO ================== */
  header.hero{
    position:relative; height:var(--hero-h-desktop); min-height:var(--hero-min);
    overflow:hidden; isolation:isolate;
  }
  header.hero::before{
    content:""; position:absolute; inset:0;
    background:
      linear-gradient(90deg, rgba(5,12,24,.82) 0%, rgba(7,16,30,.66) 34%, rgba(10,18,28,.42) 62%, rgba(12,20,28,.22) 100%),
      url("https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/1ea92369de57361354807811188559129b45985c/foto%20fond.webp")
      center 35%/cover no-repeat;
    z-index:-1;
  }
  .hero__inner{
    max-width:var(--maxw); margin:0 auto;
    padding:60px clamp(16px,4vw,40px);
    display:grid; grid-template-columns:1.1fr 0.9fr; gap:clamp(20px,4vw,42px);
    height:100%; align-items:center; color:#fff;
  }
  @media (max-width:860px){
    .hero__inner{grid-template-columns:1fr;text-align:center;align-items:flex-end;padding-bottom:80px;}
  }
  .title{margin:0 0 14px;font-weight:900;line-height:1.1;font-size:clamp(28px,4.4vw,52px);color:#fff}
  .title em{color:var(--accent);font-style:normal;text-shadow:0 2px 10px rgba(245,158,11,.3);}
  .lead{margin:8px 0 0;color:rgba(255,255,255,.92);max-width:54ch;}

  .panel{display:flex;flex-direction:column;gap:12px;width:100%;}
/* Ligne ~116 */
.pill{
  display:flex;align-items:center;justify-content:center;min-height:46px;
  background: linear-gradient(180deg, #fbbf24, #f59e0b);
  color:#111827;font-weight:800;border-radius:12px;border:0;
  box-shadow:0 4px 12px rgba(245,158,11,.35), inset 0 -2px 4px rgba(0,0,0,.15);
  padding:14px 16px;
  transition:transform .2s ease, box-shadow .2s ease;
  margin-bottom:10px;
  text-align: center;
  font-size: 20px; /* <-- AJOUTEZ CETTE LIGNE */
}
  .pill:hover{transform:translateY(-1px);box-shadow:0 12px 28px rgba(245,158,11,.32);}
  .row{display:flex;flex-direction:column;gap:10px;max-width:900px;margin-inline:auto;}
  .rect,.option{
    display:flex;align-items:center;padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.22);
  }
  input{width:100%;background:transparent;border:0;color:#fff;font:inherit;min-width:0}
  header.hero .panel input::placeholder{
    color:#ffffff;background:rgba(0,0,0,.25);padding:4px 6px;border-radius:6px;
    text-shadow:0 0 4px rgba(0,0,0,.5);font-size:15px;
  }
  /* Confort sur fond photo */
  input { backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px); }

  .cta{
    display:inline-flex;align-items:center;justify-content:center;gap:8px;
    min-height:58px;width:100%;
    background:#0f172a; color:#fff; font-weight:900; font-size:17px;
    border:2px solid var(--accent); border-radius:14px; cursor:pointer;
    box-shadow:0 10px 26px rgba(245,158,11,.35), 0 0 12px rgba(245,158,11,.20);
    transition:transform .2s ease, box-shadow .2s ease, filter .2s ease;
    max-width:900px; margin-inline:auto;
  }
  .cta:hover{transform:translateY(-1px);box-shadow:0 14px 32px rgba(245,158,11,.45), 0 0 14px rgba(245,158,11,.24);}
  .cta:focus-visible{outline:2px solid var(--accent);outline-offset:2px;}

  /* Logos certifications (héros) */
  .certifs{position:absolute;top:18px;left:18px;display:flex;align-items:center;gap:12px;z-index:5;}
  .certifs__img{height:36px;width:auto;display:block;filter:drop-shadow(0 1px 3px rgba(0,0,0,.25));}
  .certifs__img--main{height:76px;margin:0 3px;}
  .certifs__img[src*="qualipv"]{height:44px;}
  .certifs__img[src*="RGE.webp"]{height:32px;}
  @media (max-width:860px){
    .certifs{top:12px;left:12px;gap:8px;}
    .certifs__img{height:28px;}
    .certifs__img--main{height:52px;}
    .certifs__img[src*="qualipv"]{height:34px;}
    .certifs__img[src*="RGE.webp"]{height:26px;}
  }

  /* ================== SECTION 3 ÉTAPES ================== */
  .steps-2025{background:#fff;padding:clamp(40px,7vw,80px) 16px;color:var(--ink);}
  .steps-2025__inner{max-width:var(--maxw);margin:0 auto;text-align:center;}
  .steps-2025__title{font-weight:800;font-size:clamp(26px,3.8vw,44px);margin-bottom:6px;}
  .steps-2025__subtitle{color:var(--muted);margin-bottom:clamp(28px,5vw,48px);}
  .steps-2025__grid{display:grid;gap:clamp(14px,2vw,20px);grid-template-columns:1fr;}
  @media(min-width:860px){.steps-2025__grid{grid-template-columns:repeat(3,1fr);}}
  .steps-2025__item{
    background:#fff;border:1px solid var(--border);border-radius:16px;
    padding:clamp(18px,2.2vw,24px);
    box-shadow:0 4px 14px rgba(15,23,42,.05);
    display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;
  }
  .steps-2025__num{
    width:72px;height:72px;border-radius:50%;display:grid;place-items:center;
    font-weight:800;color:#fff;background:linear-gradient(135deg,var(--accent),#fdba74);
    box-shadow:0 8px 22px rgba(245,158,11,.25);font-size:22px;margin-bottom:12px;
  }
  .steps-2025__heading{margin:0;font-weight:800;font-size:clamp(18px,2.2vw,22px);}
  .steps-2025__text{margin:6px 0 0;color:var(--muted);font-size:clamp(14px,1.6vw,16px);}
  .steps-2025__note{margin:clamp(40px,6vw,60px) 0 0;display:flex;flex-direction:column;align-items:center;gap:18px;}
  .steps-2025__note p{font-weight:700;color:var(--ink);font-size:clamp(16px,2vw,20px);}

  /* ================== CHIFFRES CLÉS ================== */
  .stats-bg{
    width:100vw;margin-left:calc(50% - 50vw);margin-top:clamp(72px,9vw,140px);
    position:relative;padding:clamp(48px,9vw,96px) 16px;color:#fff;overflow:hidden;isolation:isolate;
  }
  .stats-bg::before{
    content:"";position:absolute;inset:0;
    background:url("https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/687b0f048a98e03f86e7852020887ff4f05eb913/bande%20panneaux%20full%20black.webp") center/cover no-repeat;
    filter:brightness(1.02) saturate(.95);z-index:-1;
  }
  .stats-bg__inner{max-width:var(--maxw);margin:0 auto;display:grid;grid-template-columns:1fr;gap:clamp(14px,3vw,20px);text-align:center;}
  @media (min-width:820px){.stats-bg__inner{grid-template-columns:repeat(4,1fr);}}
  .stat{padding:clamp(10px,2vw,14px);}
  .stat__value{font-weight:900;letter-spacing:-.02em;font-size:clamp(34px,5.5vw,56px);line-height:1.05;color:var(--accent);text-shadow:0 2px 10px rgba(0,0,0,.25);}
  .stat__label{margin-top:4px;font-size:clamp(14px,1.7vw,16px);color:rgba(255,255,255,.92);text-shadow:0 1px 4px rgba(0,0,0,.25);}

  .sr-only{position:absolute !important;width:1px;height:1px;margin:-1px;padding:0;border:0;overflow:hidden;clip:rect(0 0 0 0);clip-path:inset(50%);}

  /* ================== AVIS CLIENTS ================== */
  .testi{background:#fff;color:var(--ink);margin-top:clamp(40px,6vw,80px);padding:clamp(28px,6vw,60px) 16px;}
  .testi__inner{max-width:var(--maxw);margin:0 auto;}
  .testi__head{text-align:center;margin-bottom:clamp(18px,3vw,28px);}
  .testi__title{font-weight:900;line-height:1.15;font-size:clamp(26px,3.6vw,40px);margin:0 0 8px;}
  .testi__meta{color:var(--muted);font-size:clamp(14px,1.8vw,16px);}
  .testi__grid{display:grid;gap:clamp(16px,2.6vw,22px);grid-template-columns:1fr;}
  @media (min-width:1024px){.testi__grid{grid-template-columns:repeat(3,1fr);}}
  .tcard{
    background:#fff;border:1px solid var(--border);border-radius:16px;
    padding:clamp(16px,2.2vw,22px); box-shadow:0 4px 14px rgba(15,23,42,.05);
    display:flex;flex-direction:column;gap:12px;
  }
  .tcard__top{display:flex;align-items:center;gap:12px;}
  .avatar{
    width:44px;height:44px;border-radius:999px;display:grid;place-items:center;
    font-weight:700;color:#111827;background:linear-gradient(180deg,#fff6e5,#ffe4bf);
    border:1px solid #f1c987;
  }
  .tcard__name{font-weight:800;}
  .tcard__loc{color:var(--muted);font-size:14px;margin-top:2px;}
  .stars{display:flex;gap:2px;}
  .stars svg{width:18px;height:18px}
  .tcard__text{color:#334155;font-style:italic}

  /* ================== POURQUOI LE SOLAIRE ================== */
  .why{background:#f7f9fc;color:var(--ink);padding:clamp(40px,7vw,90px) 16px;margin-top:clamp(40px,6vw,80px);}
  .why__inner{max-width:var(--maxw);margin:0 auto;}
  .why__head{text-align:center;margin-bottom:clamp(22px,4vw,34px);}
  .why__title{font-weight:900;line-height:1.1;font-size:clamp(28px,4vw,48px);margin:0 0 10px;}
  .why__subtitle{color:var(--muted);font-size:clamp(14px,1.9vw,18px);}
  .why__grid{display:grid;gap:clamp(14px,2.4vw,20px);grid-template-columns:1fr;}
  @media (min-width:860px){ .why__grid{grid-template-columns:repeat(2,1fr);} }
  @media (min-width:1180px){ .why__grid{grid-template-columns:repeat(4,1fr);} }
  .why__card{
    background:#fff;border:1px solid var(--border);border-radius:16px;
    padding:clamp(18px,2.2vw,24px); box-shadow:0 4px 14px rgba(15,23,42,.05);
  }
  .why__top{display:flex;align-items:center;gap:12px;margin-bottom:10px;}
  .why__icon{
    width:42px;height:42px;border-radius:12px;display:grid;place-items:center;flex:0 0 auto;
    background:linear-gradient(180deg,#fff3db,#ffe1b3); border:1px solid #f4c981;color:#b45309;
  }
  .why__heading{font-weight:800;font-size:clamp(16px,2vw,20px);margin:0;}
  .why__text{color:var(--muted);margin:6px 0 0;font-size:clamp(14px,1.7vw,16px);line-height:1.45;}

  /* ================== FAQ ================== */
  .faq{background:#f7f9fc;color:var(--ink);margin-top:clamp(56px,8vw,96px);padding:clamp(32px,7vw,80px) 16px;}
  .faq__inner{max-width:var(--maxw);margin:0 auto;}
  .faq__head{text-align:center;margin-bottom:clamp(18px,3.6vw,28px);}
  .faq__title{font-weight:900;font-size:clamp(28px,4vw,48px);margin:0 0 8px;line-height:1.1;}
  .faq__subtitle{color:var(--muted);font-size:clamp(14px,1.9vw,18px);}
  .faq__list{display:grid;gap:12px;}
  .faq details{background:#fff;border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(15,23,42,.05);overflow:hidden;}
  .faq summary{list-style:none;cursor:pointer;display:flex;align-items:center;gap:10px;padding:18px 20px;font-weight:800;font-size:clamp(15px,1.9vw,17px);color:var(--ink);transition:color .2s ease;}
  .faq summary:hover, details[open] summary{color:var(--accent);}
  .faq summary::-webkit-details-marker{display:none;}
  .faq__chev{margin-left:auto;transition:transform .2s ease;flex:0 0 auto;opacity:.7;}
  details[open] .faq__chev{transform:rotate(180deg);opacity:1;}
  .faq__panel{padding:0 20px 18px 20px;color:var(--muted);font-size:clamp(14px,1.8vw,16px);line-height:1.55;border-top:1px solid var(--border);background:#fbfbfd;}
  .faq{padding-top:clamp(20px,4vw,40px);}
  .faq h2{margin-bottom:clamp(10px,2vw,16px);}
  .faq__list{margin-top:6px;}

  /* Mentions légales */
  .legal{background:#f7f9fc;color:var(--ink);padding:24px 16px;margin-top:clamp(40px,6vw,80px)}
  .legal__inner{max-width:var(--maxw);margin:0 auto;text-align:center}
  .legal__link{
    color:#6b7280 !important; font-weight:400 !important; text-decoration:none !important; cursor:pointer;
  }
  .legal__link:hover{ color:#374151 !important; text-decoration:underline !important; }
  .legal__link:visited{ color:#6b7280 !important; }
  .legal .sep{border:0;border-top:1px solid var(--border);margin:16px auto 0;max-width:var(--maxw)}
  #mentions-popup{display:none;position:fixed;left:50%;bottom:64px;transform:translateX(-50%);width:360px;max-width:95vw;background:#fff;color:var(--ink);border:1px solid var(--border);border-radius:14px;padding:18px 20px 14px;box-shadow:0 10px 36px rgba(2,6,23,.15);z-index:9999;font-size:13px;line-height:1.7}
  #close-mentions{position:absolute;top:6px;right:12px;background:none;border:0;color:var(--ink);font-size:20px;font-weight:800;cursor:pointer}

  /* === Overlay calcul (étape 1) === */
  body.no-scroll{overflow:hidden;}
  #calc-overlay{position:fixed;inset:0;background:rgba(2,6,23,.35);backdrop-filter:blur(2px);display:none;z-index:9998;align-items:center;justify-content:center;padding:20px;}
  #calc-overlay .panel{width:100%;max-width:360px;background:#fff;color:#111827;border:1px solid var(--border);border-radius:14px;box-shadow:0 10px 36px rgba(2,6,23,.15);padding:18px;text-align:center;outline:none;}
  #calc-overlay .spinner{
    width:46px;height:46px;margin:6px auto 12px;border-radius:50%;
    background:conic-gradient(from 0turn at 50% 50%, var(--accent) 0 25%, rgba(245,158,11,0) 25% 100%);
    -webkit-mask: radial-gradient(farthest-side,#0000 62%,#000 63%); mask: radial-gradient(farthest-side,#0000 62%,#000 63%);
    animation: spin360 .9s linear infinite; box-shadow:0 0 0 1px rgba(0,0,0,.04) inset, 0 0 12px rgba(245,158,11,.18);
  }
  #calc-overlay .spinner::after{
    content:""; position:absolute; inset:0; border-radius:50%;
    background:radial-gradient(circle 6px at 80% 50%, var(--accent), rgba(245,158,11,0) 60%);
    animation: spin360 .9s linear infinite; mix-blend-mode:normal; pointer-events:none;
  }
  @keyframes spin360{ to { transform: rotate(360deg); } }
  #calc-overlay .desc{color:#374151;font-size:14px;margin:0;}

  /* ============== MODE RÉSULTAT ============== */
  body.results-mode header.hero{height:var(--hero-h-desktop);min-height:var(--hero-min);padding-bottom:0;}
  @media (max-width:860px){ body.results-mode header.hero{ height: var(--hero-h-mobile); } }
  body.results-mode header.hero::before{opacity:1 !important;}
  body.results-mode .panel{margin-bottom:0;}
  body.results-mode main > *{display:none !important;}
  body.results-mode main > #recap, body.results-mode main > .legal{display:block !important;}
  body.results-mode main > .legal{margin-top:24px;}
  body.results-mode #recap{display:block !important;margin-top:12px;}

  /* ===== Résultats – style 2025 ===== */
  .result-card{
    max-width: 860px; margin: 16px auto; padding: 18px;
    background:#fff; color:var(--ink); border:1px solid var(--border);
    border-radius:16px; box-shadow:0 6px 18px rgba(15,23,42,.06);
  }
  .result-card h2{ margin:0 0 20px; font-weight:900; font-size:clamp(20px,2.4vw,24px); }
  .result-grid{ display:grid; gap:12px; grid-template-columns:1fr; }
  @media(min-width:780px){ .result-grid{ grid-template-columns:repeat(2,1fr); } }

  .kpi{ background:#fff; border:1px solid var(--border); border-radius:12px; padding:12px; }
  .kpi .label{ color:#64748b; font-size:13px; margin-bottom:4px; }
  .kpi .value{ font-weight:800; font-size:18px; color:var(--ink); }

  .kpi--highlight{ position:relative; background:#fff; border-color:var(--border); }
  .kpi--highlight::before{
    content:""; position:absolute; left:-1px; top:-1px; bottom:-1px; width:4px;
    border-radius:12px 0 0 12px; background:var(--accent);
  }

  .financial-banner{
    margin:24px 0 0; padding:18px; text-align:center;
    background:#fffaf2; border:1px solid #fde68a; border-radius:12px; box-shadow:none;
  }
  .financial-card{
    margin-top:12px; padding:16px; background:#fff; border:1px solid var(--border);
    border-radius:14px; box-shadow:0 6px 18px rgba(15,23,42,.06);
  }
  .financial-title{ font-size:18px; font-weight:900; margin:0 0 10px; color:var(--ink); }
  .tokens{ display:flex; flex-wrap:wrap; gap:8px; margin:8px 0 10px; }
  .token{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:#f8fafc; font-weight:700; }
  .note{ color:#64748b; font-size:13px; line-height:1.5; }
  .note-alert{ margin-top:10px; padding:10px 12px; background:#fff; border:0; border-radius:10px; }

  /* Pavés financiers pleine largeur dans la grille */
  .result-grid .financial-banner,
  .result-grid .financial-card{ grid-column: 1 / -1; }

  /* ===== Overlay de déblocage (Lovable/CSS 2025) ===== */
  .lock-zone{ position:relative; }
  .lock-zone .lock-blur{
    filter: blur(4px); opacity:.85; pointer-events:none; user-select:none;
    transition:filter .2s ease, opacity .2s ease;
  }

  .gate-overlay{
    position:absolute; inset:0; z-index:10;
    display:flex; align-items:center; justify-content:center;
    padding:20px; background:rgba(255,255,255,.92); backdrop-filter:blur(1px);
  }
  .gate-card{
    width:min(780px,92vw); background:#fff; border:1px solid var(--border); border-radius:16px;
    box-shadow:0 12px 32px rgba(0,0,0,.12); padding:clamp(18px,3vw,28px); text-align:center;
  }

  .gate-title{ margin:0 0 6px; font-weight:900; font-size:clamp(20px,2.6vw,26px); color:var(--ink); }
  .gate-sub{ color:#334155; margin:6px 0 10px; }
  .gate-sub strong{ color:var(--ink); }
  .gate-deadline{ color:#b45309; font-weight:800; }

  /* Grille formulaire gate */
  .gate-form{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap:14px 18px;
    justify-items:center;
    max-width:680px;
    margin:14px auto 0;
  }
  .gate-form .full{ grid-column:1 / -1; }

  /* Champs Lovable 2025 — légères bordures et halo focus */
.gate-input{
  height:52px; width:100%;
  border-radius:12px;
  border:1.5px solid #e5e7eb;      /* contour doux gris clair */
  padding:0 14px;
  font:inherit; background:#fff; color:#111827;
  box-shadow:inset 0 1px 2px rgba(0,0,0,.04);
  transition:border-color .2s ease, box-shadow .2s ease;
}

.gate-input::placeholder{
  color:#9ca3af;
}

.gate-input:focus{
  border-color:#f59e0b;           /* orange accent au focus */
  box-shadow:0 0 0 3px rgba(245,158,11,.15);
  outline:none;
}


/* CTA — Lovable CSS 2025 */
.gate-cta{
  --cta-from:#f59e0b;     /* orangé principal */
  --cta-to:#fbbf24;       /* orangé clair */
  --cta-ring:#fed7aa;     /* anneau focus doux */

  position:relative;
  display:inline-flex;
  align-items:center; justify-content:center; gap:10px;

  width:min(520px,100%); height:58px;
  padding:0 22px;
  border:0; border-radius:14px; cursor:pointer;

  background:linear-gradient(180deg,var(--cta-from),var(--cta-to));
  color:#111827; font-weight:900; font-size:16px; letter-spacing:.2px;

  box-shadow:
    0 12px 30px rgba(245,158,11,.35),
    inset 0 -2px 0 rgba(0,0,0,.08);
  transition: transform .15s ease, box-shadow .15s ease, filter .15s ease;
  z-index:0;
}
.gate-cta::before{
  content:"";
  position:absolute; inset:-10px -14px;
  border-radius:18px;
  background:radial-gradient(60% 60% at 50% 30%, rgba(245,158,11,.35), transparent 70%);
  filter:blur(18px); opacity:.55;
  z-index:-1; pointer-events:none;
}
.gate-cta:hover{
  transform:translateY(-1px);
  box-shadow:0 16px 36px rgba(245,158,11,.42), inset 0 -2px 0 rgba(0,0,0,.08);
}
.gate-cta:active{
  transform:translateY(0);
  filter:saturate(.98);
  box-shadow:0 10px 24px rgba(245,158,11,.32), inset 0 -1px 0 rgba(0,0,0,.10);
}
.gate-cta:focus-visible{
  outline:0;
  box-shadow:
    0 0 0 3px var(--cta-ring),
    0 16px 36px rgba(245,158,11,.42),
    inset 0 -2px 0 rgba(0,0,0,.08);
}
.gate-cta[disabled]{
  opacity:.65; cursor:not-allowed; transform:none;
  box-shadow:none;
}
.gate-cta .arrow{
  display:inline-flex; align-items:center; justify-content:center;
  width:26px; height:26px; border-radius:999px;
  background:rgba(255,255,255,.85);
  box-shadow:0 2px 8px rgba(0,0,0,.08) inset;
  font-weight:900; font-size:14px; color:#111827;
}
@media (max-width:480px){
  .gate-cta{ height:56px; }
}

  .gate-note{ margin-top:10px; font-size:12px; color:#64748b; }

  /* Champs nets dans la card (anti-blur) — version Lovable 2025 */
.gate-card .gate-input{
  -webkit-backdrop-filter:none !important;
  backdrop-filter:none !important;
  background:#fff !important;
  color:#111827;

  /* >>> entourage + relief */
  border:1.5px solid #e5e7eb;
  border-radius:12px;
  box-shadow:inset 0 1px 2px rgba(0,0,0,.04);

  transition:border-color .2s ease, box-shadow .2s ease;
}
.gate-card .gate-input::placeholder{
  color:#9ca3af;
  text-shadow:none;
  opacity:1;
}
.gate-card .gate-input:focus{
  border-color:#f59e0b;               /* accent */
  box-shadow:0 0 0 3px rgba(245,158,11,.15);
  outline:none;
}


  /* Badges confiance */
  .gate-badges{
    display:flex; flex-wrap:wrap; gap:10px; justify-content:center;
    margin:12px auto 16px; max-width:720px;
  }
  .badge{
    display:inline-flex; align-items:center; gap:8px;
    padding:10px 14px; border-radius:999px;
    background:#fff; border:1px solid var(--border);
    box-shadow:0 6px 16px rgba(15,23,42,.06);
    font-weight:700; color:#111827;
  }
  .badge span{ opacity:.85; font-weight:700; }
  .badge b{ font-weight:800; }

  /* RGPD inline (sans case) */
.gate-hint{
  max-width:520px;
  margin:8px auto 0;
  font-size:13px;
  line-height:1.45;
  color:#334155;
  text-align:center;
}
#rgpd-info{ font-weight:600; }

.gate-proof{
  max-width:520px;
  margin:10px auto 0;
  padding:10px 12px;
  border-radius:10px;
  background:#ecfdf5;
  border:1px solid #a7f3d0;
  color:#065f46;
  font-size:14px;
  font-weight:600;
}

  /* Patch visibilité inputs (force la bordure + focus) */
.gate-card .gate-input{
  border:2px solid #d1d5db !important;   /* plus contrasté, et vraiment 2px */
  box-shadow:inset 0 1px 2px rgba(0,0,0,.04) !important;
  background:#fff !important;
  color:#111827 !important;
}

.gate-card .gate-input::placeholder{
  color:#9ca3af !important;           /* placeholder plus lisible */
  opacity:1 !important;
}

.gate-card .gate-input:hover{
  border-color:#cbd5e1 !important;       /* léger feedback au survol */
}

.gate-card .gate-input:focus{
  border-color:#f59e0b !important;       /* accent net au focus */
  box-shadow:0 0 0 3px rgba(245,158,11,.18) !important;
  outline:0 !important;
}

/* Patch final — champs Lovable 2025 : neutre au repos, orangé au focus */
.gate-card .gate-input{
  border:2px solid #d1d5db !important;
  background:#fff !important;
  color:#111827 !important;
  transition:border-color .2s ease, box-shadow .2s ease, background-color .2s ease;
}
.gate-card .gate-input:hover{
  border-color:#cbd5e1 !important;
}
.gate-card .gate-input:focus{
  border-color:#f59e0b !important;
  box-shadow:0 0 0 3px rgba(245,158,11,.18) !important;
  outline:0 !important;
}

  /* ===== Patch UI (champs + espacement) ===== */

/* Contour plus net au repos */
:where(.gate-card) .gate-input{
  border:2px solid #d1d5db;             /* + lisible */
  box-shadow: inset 0 1px 2px rgba(0,0,0,.04);
}

/* Léger feedback au survol */
:where(.gate-card) .gate-input:hover{
  border-color:#cbd5e1;
}

/* Focus très visible (access + esthétique) */
:where(.gate-card) .gate-input:focus{
  border-color:#f59e0b;
  box-shadow:
    0 0 0 3px rgba(245,158,11,.18),
    inset 0 1px 2px rgba(0,0,0,.04);
  outline:0;
}

/* Aération sous le CTA */
.gate-card .gate-note{
  margin-top:14px;                   /* + respiration sous le bouton */
}

/* DEBUT CSS BANDEAU COOKIE */
#consent-banner {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  background: #fff;
  border-top: 1px solid var(--border);
  color: var(--ink);
  padding: 12px;
  z-index: 9999;
  display: none;
  box-shadow: 0 -6px 26px rgba(0, 0, 0, .12);
  font: 14px/1.5 system-ui, Segoe UI, Roboto;
  min-height: 56px;
  /* Styles pour l'animation d'apparition */
  opacity: 0;
  transform: translateY(10px);
  transition: opacity .18s ease, transform .18s ease;
}
.consent-inner {
  max-width: 900px;
  margin: 0 auto;
  display: flex;
  gap: 14px;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
}
.consent-text {
  flex: 1 1 520px;
  font-size: 14px;
  color: #374151;
}
.consent-buttons {
  display: flex;
  gap: 10px;
}
#consent-reject {
  padding: 8px 16px;
  border-radius: 999px;
  font-weight: 700;
  cursor: pointer;
  border: none;
  font-size: 14px;
  background: #111827;
  color: #fff;
}
#consent-accept {
  padding: 8px 16px;
  border-radius: 999px;
  font-weight: 700;
  cursor: pointer;
  border: none;
  font-size: 14px;
  background: linear-gradient(180deg, var(--accent), var(--accent-2));
  color: #1b1202;
}
/* FIN CSS BANDEAU COOKIE */
/* === Impression PDF : ne garder que le récap + mentions === */
/* === Impression PDF Premium : #recap uniquement, A4 propre, couleurs respectées === */
/* === Impression PDF : tout sur une seule page A4 nette === */
@media print {
  @page { size: A4; margin: 10mm 14mm; } /* marges réduites pour tenir sur 1 page */

  html, body {
    background: #fff !important;
    color: #111 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    height: auto !important;
    overflow: visible !important;
  }

  /* Ne garder que le récap */
  header.hero, #consent-banner, .steps-2025, .why, .stats-bg,
  .testi, .faq, .gate-overlay, .certifs { display: none !important; }
  main > *:not(#recap) { display: none !important; }

  /* Mise en page compacte */
  #recap {
    margin: 0 !important;
    padding: 0 !important;
  }

  #recap .result-card {
    border: 0;
    box-shadow: none;
    color: #111;
    padding: 0;
    margin: 0 auto;
    max-width: 100%;
    page-break-after: avoid;
    page-break-before: avoid;
    page-break-inside: avoid;
  }

  /* Réduction des espacements internes */
  #recap .kpi {
    margin: 2mm 0 !important;
    padding: 0 !important;
  }

  #recap .value {
    font-size: 15px !important;
    line-height: 1.3 !important;
  }

  /* Supprime boutons, notes, etc. */
 .gate-cta, .gate-note{ display:none !important; } /* on NE masque plus .financial-banner .note */
.financial-banner .note{
  display:block !important;
  color:#111 !important;
  font-size:12px !important;
  margin-top:4px !important;
}


  /* En-tête premium */
  .print-header {
    display: block !important;
    margin: 0 0 6mm 0 !important;
    page-break-after: avoid;
  }

  /* Pas de coupure sur les cartes de résultat */
  #recap * {
    page-break-before: avoid !important;
    page-break-after: avoid !important;
    page-break-inside: avoid !important;
  }
}

/* === HOTFIX MOBILE (≤860px) — résultats après téléphone uniquement === */
@media (max-width: 860px){

  /* conteneur */
  body.results-mode #recap{
    padding: 0 12px !important;
    margin: 12px auto !important;
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
    overflow-x: hidden !important;
  }

  /* carte + grille = 1 colonne, jamais 2, jamais de rognage */
  body.results-mode #recap .result-card{
    padding: 12px !important;
    margin: 12px 0 !important;
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
    overflow: visible !important;
  }

  body.results-mode #recap .result-grid{
    display: grid !important;
    grid-template-columns: 1fr !important;
    gap: 12px !important;
    background: none !important;
    overflow: visible !important;
  }

  /* tous les blocs internes = largeur fluide */
  body.results-mode #recap .kpi,
  body.results-mode #recap .financial-card,
  body.results-mode #recap .financial-banner{
    display: block !important;
    width: 100% !important;
    max-width: 100% !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    box-sizing: border-box !important;
    overflow: visible !important;
  }

  /* pas de pseudo-ornements qui coupent */
  body.results-mode #recap .result-card::before,
  body.results-mode #recap .result-card::after,
  body.results-mode #recap .result-grid::before,
  body.results-mode #recap .result-grid::after{
    content: none !important;
    display: none !important;
  }

  /* empêcher toute chaîne longue de créer un débordement */
  body.results-mode #recap *,
  body.results-mode #recap .kpi .value,
  body.results-mode #recap .note{
    min-width: 0 !important;
    white-space: normal !important;
    overflow-wrap: anywhere !important;
    word-break: break-word !important;
  }

  /* les pastilles “token” doivent pouvoir revenir à la ligne */
  body.results-mode #recap .tokens{ flex-wrap: wrap !important; }
  body.results-mode #recap .token{
    white-space: normal !important;
    overflow-wrap: anywhere !important;
    max-width: 100% !important;
  }

  /* CTA PDF et divers */
  body.results-mode #recap .gate-cta{
    width: 100% !important;
    height: 54px !important;
  }

  /* sur tous petits écrans */
  @media (max-width: 480px){
    body.results-mode #recap .kpi{ padding: 10px !important; margin: 6px 0 !important; }
    body.results-mode #recap .kpi .value{ font-size: 15px !important; line-height: 1.3 !important; }
    body.results-mode #recap .financial-card,
    body.results-mode #recap .financial-banner{ padding: 12px !important; }
  }
}
/* === Correction espacement avant le bloc "Vous avez vu vos panneaux..." === */
#recap {
  margin-bottom: 32px !important; /* resserre la fin du bloc résultats */
}

/* Cible le bloc de transition "Vous avez vu vos panneaux..." */
section.why,
section.stats-bg,
section.after-results {
  margin-top: 24px !important;   /* rapproche-le du bloc précédent */
  padding-top: 0 !important;     /* supprime tout espace interne excessif */
}

/* Optionnel : sur mobile, encore un peu plus serré */
@media (max-width: 860px){
  section.why,
  section.stats-bg,
  section.after-results {
    margin-top: 16px !important;
  }
}


  
</style>
</head>

<body>

<div id="consent-banner" role="dialog" aria-live="polite" aria-label="Préférences de confidentialité">
  <div class="consent-inner">
    <div class="consent-text">Nous utilisons des technologies pour la mesure et la publicité. Vous pouvez refuser.</div>
    <div class="consent-buttons">
      <button id="consent-reject" type="button">Tout refuser</button>
      <button id="consent-accept" type="button">Tout accepter</button>
    </div>
  </div>
</div>
<header class="hero">

    <div class="certifs" aria-label="Labels et certifications">
      <img class="certifs__img" src="https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/687b0f048a98e03f86e7852020887ff4f05eb913/icone%20RGE.webp" alt="Label RGE – Reconnu Garant de l’Environnement">
      <img class="certifs__img certifs__img--main" src="https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/687b0f048a98e03f86e7852020887ff4f05eb913/logo%20SSP.webp" alt="Solution Solaire Pro">
      <img class="certifs__img" src="https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/687b0f048a98e03f86e7852020887ff4f05eb913/icone%20qualipv.webp" alt="Certification QualiPV 2025">
    </div>

  <div class="hero__inner">
    <div>
      <h1 class="title">
        Coût installation<br>panneaux solaires dans<br><em>l’Eure-et-Loir (28)</em>
      </h1>
      <p class="lead">Estimez gratuitement le coût d’installation, la production et vos économies en moins d’une minute.</p>
    </div>

    <div class="panel">
      <form onsubmit="return __handleSubmitEtape1(event)" novalidate>
        <div class="pill">Votre étude 100% en ligne :<br>Prix • Économies • Dimensionnement</div>

        <div class="row">
          <label class="rect">
            <span class="sr-only">Votre code postal</span>
            <input
              id="codePostal"
              type="text"
              placeholder="Votre code postal (ex : 28000)"
              inputmode="numeric"
              maxlength="5"
              pattern="[0-9]{5}"
              autocomplete="postal-code"
              required
            >
          </label>

          <label class="rect">
            <span class="sr-only">Votre facture électricité par an</span>
            <input
              id="facture"
              type="text"
              placeholder="Votre facture élec / an (ex : 1 800 €)"
              inputmode="decimal"
              autocomplete="off"
              required
            >
          </label>
        </div>

        <label class="option">
          <span class="sr-only">Consommation en kWh par an (facultatif)</span>
          <input
            id="conso"
            type="text"
            placeholder="kWh/an – pour affiner le calcul (facultatif)"
            inputmode="decimal"
            autocomplete="off"
          >
        </label>

        <button id="simuler" class="cta" type="submit">⚡ Calculer mon coût maintenant</button>
      </form>
    </div>
  </div>
</header>


<main>
  <div id="recap" style="display:none"></div>
  <div id="lockedSection" style="display:none"></div>

  <section class="steps-2025">
    <div class="steps-2025__inner">
      <h2 class="steps-2025__title">Un simulateur qui va à l’essentiel</h2>
      <p class="steps-2025__subtitle">Un processus simple et transparent en 3 étapes</p>

      <div class="steps-2025__grid">
        <article class="steps-2025__item">
          <span class="steps-2025__num">01</span>
          <h3 class="steps-2025__heading">Étude personnalisée</h3>
          <p class="steps-2025__text">Votre étude personnalisée selon votre consommation.</p>
        </article>
        <article class="steps-2025__item">
          <span class="steps-2025__num">02</span>
          <h3 class="steps-2025__heading">Économies estimées</h3>
          <p class="steps-2025__text">Vos économies estimées dès la 1<sup>re</sup> année.</p>
        </article>
        <article class="steps-2025__item">
          <span class="steps-2025__num">03</span>
          <h3 class="steps-2025__heading">Coût précis & financement</h3>
          <p class="steps-2025__text">Le coût précis de l’installation et son financement.</p>
        </article>
      </div>

      <div class="steps-2025__note">
        <p>Rien de superflu. Juste les chiffres qui comptent.</p>
        <div class="steps-2025__check">
          <svg viewBox="0 0 24 24" width="60" height="60" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <circle cx="12" cy="12" r="11" fill="#22c55e"/>
            <path d="M7 12.5l3.2 3.2L17 9" fill="none" stroke="#ffffff" stroke-width="2.6" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>
    </div>
  </section> 

  <section class="why" aria-labelledby="why-title">
    <div class="why__inner">
      <header class="why__head">
        <h2 id="why-title" class="why__title">Pourquoi passer à l’énergie solaire&nbsp;?</h2>
        <p class="why__subtitle">Les bénéfices concrets d’une installation photovoltaïque chez vous</p>
      </header>

      <div class="why__grid">
        <article class="why__card">
          <div class="why__top">
            <div class="why__icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M4 7h2.9l5.2 6.2 3.2-3.4H20v2h-3.7l-3.2 3.4L6.9 9H4z"/></svg>
            </div>
            <h3 class="why__heading">Économies importantes</h3>
          </div>
          <p class="why__text">Baissez durablement votre facture d’électricité grâce à l’autoconsommation.</p>
        </article>

        <article class="why__card">
          <div class="why__top">
            <div class="why__icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M12 3C6 3 3 9 3 13c0 4 3 8 9 8 6 0 9-4 9-8 0-6-3-10-9-10zm1.6 6.2c2.4 0 4.4 1.8 4.4 4.1 0 2.9-2.2 5.6-6 6.2-2.6.4-5.2-.9-5.2-3.3 0-3.6 3.8-7 6.8-7z"/></svg>
            </div>
            <h3 class="why__heading">Énergie propre</h3>
          </div>
          <p class="why__text">Produisez localement une énergie renouvelable et réduisez votre empreinte carbone.</p>
        </article>

        <article class="why__card">
          <div class="why__top">
            <div class="why__icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M13 3L4 14h6l-1 7 9-11h-6l1-7z"/></svg>
            </div>
            <h3 class="why__heading">Performance actuelle</h3>
          </div>
          <p class="why__text">Panneaux de dernière génération, rendement élevé et suivi transparent de la production.</p>
        </article>

        <article class="why__card">
          <div class="why__top">
            <div class="why__icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M12 2l8 3v6c0 5-3.5 9.7-8 11-4.5-1.3-8-6-8-11V5l8-3z"/></svg>
            </div>
            <h3 class="why__heading">Garantie et pérennité</h3>
          </div>
          <p class="why__text">Matériel garanti, installation durable et service après-vente local.</p>
        </article>
      </div>
    </div>
  </section>

  <section class="stats-bg" aria-labelledby="stats-title">
    <h2 id="stats-title" class="sr-only">Chiffres clés</h2>
    <div class="stats-bg__inner">
      <div class="stat">
        <div class="stat__value">+300</div>
        <div class="stat__label">Installations en Centre-Val de Loire</div>
      </div>
      <div class="stat">
        <div class="stat__value">30 ans</div>
        <div class="stat__label">Garantie matériel</div>
      </div>
      <div class="stat">
        <div class="stat__value">70%</div>
        <div class="stat__label">d’économies moyennes</div>
      </div>
      <div class="stat">
        <div class="stat__value">98%</div>
        <div class="stat__label">Clients satisfaits</div>
      </div>
    </div>
  </section>

  <section class="testi" aria-labelledby="testi-title">
    <div class="testi__inner">
      <header class="testi__head">
        <h2 id="testi-title" class="testi__title">Ils ont utilisé notre simulateur</h2>
        <p class="testi__meta" aria-label="Note moyenne">
          ★★★★☆ &nbsp; <strong>4,7 / 5</strong> — extraits d’avis clients récents (12 derniers mois)
        </p>
      </header>

      <div class="testi__grid" style="grid-template-columns:repeat(auto-fit,minmax(280px,1fr));max-width:950px;margin:0 auto;">
        <article class="tcard" aria-label="Avis client">
          <div class="tcard__top">
            <div class="avatar" aria-hidden="true">HB</div>
            <div>
              <div class="tcard__name">Hervé B.</div>
              <div class="tcard__loc">Chartres (28) · 05/2025</div>
            </div>
          </div>
          <div class="stars" aria-label="Note 5 sur 5">
            <svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)"><path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/></svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)"><path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/></svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)"><path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/></svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)"><path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/></svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)"><path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/></svg>
          </div>
          <p class="tcard__text">“Estimation rapide et claire. Les chiffres annoncés sont cohérents avec ma conso.”</p>
        </article>

        <article class="tcard" aria-label="Avis client">
          <div class="tcard__top">
            <div class="avatar" aria-hidden="true">CR</div>
            <div>
              <div class="tcard__name">Camille R.</div>
              <div class="tcard__loc">Dreux (28) · 06/2025</div>
            </div>
          </div>
          <div class="stars" aria-label="Note 4 sur 5">
            <svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)"><path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/></svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)"><path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/></svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)"><path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/></svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)"><path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/></svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:#d1d5db)"><path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/></svg>
          </div>
          <p class="tcard__text">“Présentation simple et résultats fiables. Permet de juger si le projet est cohérent.”</p>
        </article>

        <article class="tcard" aria-label="Avis client">
          <div class="tcard__top">
            <div class="avatar" aria-hidden="true">JM</div>
            <div>
              <div class="tcard__name">Julie M.</div>
              <div class="tcard__loc">Lucé (28) · 04/2025</div>
            </div>
          </div>
          <div class="stars" aria-label="Note 5 sur 5">
            <svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)"><path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/></svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)"><path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/></svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)"><path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/></svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)"><path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/></svg><svg viewBox="0 0 24 24" fill="currentColor" style="color:var(--accent)"><path d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.24l7.19-.62L12 2l2.81 6.62 7.19.62-5.46 4.76 1.64 7.03z"/></svg>
          </div>
          <p class="tcard__text">“Le coût est affiché noir sur blanc, avec une projection claire sur 15 ans.”</p>
        </article>
      </div>
    </div>
  </section>

  <section class="faq" aria-labelledby="faq-title">
    <div class="faq__inner">
      <header class="faq__head">
        <h2 id="faq-title" class="faq__title">Questions fréquentes</h2>
        <p class="faq__subtitle">Tout ce qu’il faut savoir avant de passer à l’énergie solaire</p>
      </header>
      <div class="faq__list faq">
        <details> <summary> Comment est calculée mon estimation ? <svg class="faq__chev" width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> </summary> <div class="faq__panel"> Elle s’appuie sur votre consommation annuelle (ou facture), un prix du kWh indicatif, l’ensoleillement local et un scénario technique standard. Les résultats restent des ordres de grandeur. </div> </details>
        <details> <summary> Combien de panneaux pour mon cas ? <svg class="faq__chev" width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> </summary> <div class="faq__panel"> Cela dépend de votre conso, de l’espace disponible, de l’orientation/inclinaison et des ombres. Le simulateur propose une fourchette dimensionnée. </div> </details>
        <details> <summary> Quelles économies puis-je espérer ? <svg class="faq__chev" width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> </summary> <div class="faq__panel"> Elles varient selon votre profil et votre taux d’autoconsommation. Nous affichons un ordre de grandeur la 1<sup>re</sup> année et une projection à 15 ans, sans promesse fixe. </div> </details>
        <details> <summary> Revente d’électricité&nbsp;: est-ce intéressant ? <svg class="faq__chev" width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> </summary> <div class="faq__panel"> Aujourd’hui, l’autoconsommation reste le levier principal. La revente à prix de marché est faible&nbsp;(~centimes/kWh). Nous dimensionnons d’abord pour consommer sur place. </div> </details>
        <details> <summary> Quelles contraintes pour ma toiture ? <svg class="faq__chev" width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> </summary> <div class="faq__panel"> Toiture saine et étanche, absence d’amiante, charge admissible OK. Orientation sud idéale, est/ouest acceptable. Les ombres proches sont à éviter. </div> </details>
        <details> <summary> Combien de temps dure l’installation ? <svg class="faq__chev" width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> </summary> <div class="faq__panel"> La pose standard prend 1 à 2 jours. Les démarches (Enedis, Consuel, administratif) suivent un calendrier séparé. </div> </details>
        <details> <summary> Garanties et entretien ? <svg class="faq__chev" width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> </summary> <div class="faq__panel"> Garanties fabricant 25–30 ans selon les modèles (puissance dégressive). Peu d’entretien&nbsp;: contrôle visuel et rinçage ponctuel si dépôts. </div> </details>
        <details> <summary> Aides financières et financement ? <svg class="faq__chev" width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> </summary> <div class="faq__panel"> Nous privilégions la transparence&nbsp;: coût posé noir sur blanc, sans artifices. Des mensualités sont possibles. Les aides évoluent&nbsp;: nous précisons ce qui est éligible lors de l’étude. </div> </details>
      </div>
    </div>
  </section>

  <div class="legal">
    <div class="legal__inner">
      <span id="mentions-legales-link" class="legal__link">Mentions légales</span>
      <hr class="sep">
    </div>
  </div>

</main> 

<div id="mentions-popup" role="dialog" aria-modal="true" aria-labelledby="mentions-title">
  <button id="close-mentions" type="button" aria-label="Fermer">&times;</button>
  <strong id="mentions-title">Mentions légales :</strong><br>
  Solution Solaire Pro, marque de Biofrance Énergies<br>
  SIRET : 422 231 928 00025<br>
  Adresse : 4 rue du Pont Saint Jean, 27530 Ézy-sur-Eure<br>
  Contact : solutionsolairepro@gmail.com<br>
  Hébergeur : GitHub Pages, 88 Colin P. Kelly Jr. Street, San Francisco CA 94107 USA<br>
  Données personnelles : Les informations saisies sont utilisées uniquement pour traiter votre demande. Aucun démarchage ni revente.<br>
  RGPD : Suppression possible sur simple demande par e-mail.
</div>


<script>
// Script pour ouvrir/fermer FAQ et Popup Mentions
document.addEventListener('click', (e)=>{ if(e.target.closest('summary')){ const d = e.target.closest('details'); if(!d) return; const group = d.parentElement; group.querySelectorAll('details[open]').forEach(x => { if(x!==d) x.removeAttribute('open'); }); } });
document.addEventListener("DOMContentLoaded", ()=>{ const link=document.getElementById("mentions-legales-link"), popup=document.getElementById("mentions-popup"), close=document.getElementById("close-mentions"); if(link && popup && close){ link.addEventListener("click", e=>{e.preventDefault();popup.style.display="block";}); close.addEventListener("click", e=>{e.preventDefault();popup.style.display="none";}); } });
</script>

<div id="calc-overlay" role="alertdialog" aria-modal="true" aria-labelledby="calc-title" aria-describedby="calc-desc">
  <div class="panel" tabindex="-1"> <div class="spinner" aria-hidden="true"></div> <h3 id="calc-title" class="title">Calcul en cours…</h3> <p id="calc-desc" class="desc"> ⚡ Nous préparons votre estimation…<br> <small>(calcul en cours)</small> </p> </div>
</div>

<script>
// Script Masque Téléphone
function attachPhoneMask() { const telInput = document.getElementById('gate-phone'); if (!telInput) return; telInput.setAttribute('inputmode','numeric'); telInput.setAttribute('maxlength','14'); const format = v => v.replace(/\D/g,'').substring(0,10).replace(/(\d{2})(?=\d)/g,'$1 ').trim(); telInput.addEventListener('input', () => { telInput.value = format(telInput.value); }); telInput.addEventListener('paste', (e) => { e.preventDefault(); const txt = (e.clipboardData || window.clipboardData).getData('text') || ''; telInput.value = format(txt); }); }
document.addEventListener('DOMContentLoaded', attachPhoneMask);
</script>

<script>
  (function(){
    let simulationData = {}; // Pour stocker les données entre étapes
    const overlay    = document.getElementById('calc-overlay');
    const btn        = document.getElementById('simuler');
    const inputCP    = document.getElementById('codePostal');
    const inputFact  = document.getElementById('facture');
    const G_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwhlyD_FMMm2g9JIQAm2Se2xehUqIM2MzWMl1YGl_gP1DJKM_-jZFj_YStDMhWi-0F8XA/exec'; // URL unique Apps Script

    // Fonctions utilitaires (overlay, validation)
    function showCalcOverlay(msg){ if (!overlay) return; if (msg) { const t = overlay.querySelector('#calc-title'); if (t) t.textContent = msg; } overlay.style.display = 'flex'; document.body.classList.add('no-scroll'); overlay.querySelector('.panel')?.focus(); if (btn) { btn.disabled = true; btn.style.opacity = '0.7'; } }
    function hideCalcOverlay(){ if (!overlay) return; overlay.style.display = 'none'; document.body.classList.remove('no-scroll'); if (btn) { btn.disabled = false; btn.style.opacity = '1'; } }
    function validateStep1(){ const cp = (inputCP?.value || '').trim(); const factureRaw = (inputFact?.value || ''); const num = parseFloat(factureRaw.replace(/\s/g,'').replace(',', '.').replace(/[^0-9.]/g,'')); const okCP = /^[0-9]{5}$/.test(cp); const okFact = Number.isFinite(num) && num > 0; if (!okCP) { alert('Veuillez entrer un code postal valide (5 chiffres).'); return false; } if (!okFact){ alert("Veuillez indiquer une facture annuelle valide."); return false; } return true; }
    
    // Récupération des scénarios depuis Google Sheet
    async function fetchScenarios(departement){
      try{
        const r = await fetch(G_SCRIPT_URL); // Utilisation de l'URL définie
        if (!r.ok) throw new Error(`HTTP error! status: ${r.status}`);
        const data = await r.json();
        return (data || [])
          .filter(row => String(row.Departement||'') === String(departement))
          .map(row => ({ // Transformation en objet propre
            prixKwh: parseFloat(String(row.PrixKwh||'').replace(',', '.').replace(/[^0-9.]/g,'') || 0.25), // Fallback prix kWh
            puissance: String(row.Puissance || ''), prod: parseFloat(row.Prod || 0), seuil: parseFloat(row.Seuil || 0),
            panels: parseInt(row.Panels || 0), prix: parseFloat(row.Prix || 0),
            remiseChantier: parseFloat(String(row.RemiseChantier||'').replace(',', '.').replace(/[^0-9.]/g,'') || 0),
            mensualite: parseFloat(row.Mensualite || 0), taeg: parseFloat(row.Taeg || 0),
            total: parseFloat(row.Total || 0), dureeMois: parseInt(row.Mois || 0)
          }));
      }catch(e){ console.error('fetchScenarios error', e); alert("Impossible de charger les données de simulation. Veuillez réessayer."); return []; }
    }

    // Gestion de la soumission du premier formulaire (Étape 1)
    window.__handleSubmitEtape1 = async function(ev){
      ev.preventDefault();
      showCalcOverlay('Calcul en cours…');
      if (!validateStep1()){ hideCalcOverlay(); return false; }
      
      const departement = (inputCP.value.trim()).substring(0,2); 
      const scenarios = await fetchScenarios(departement);
      if (!scenarios.length){ hideCalcOverlay(); /* Message d'erreur déjà dans fetchScenarios */ return false; }
      
      console.log('Scénarios chargés:', scenarios.length, scenarios);

      // Calculs
      const cp = inputCP.value.trim();
      const facture = parseFloat((inputFact.value || '').replace(/\s/g,'').replace(',', '.').replace(/[^0-9.]/g,''));
      const inputConsoElem = document.getElementById('conso');
      let conso, prixKwh, sourceConso = "facture"; 
      if (inputConsoElem && inputConsoElem.value.trim()) {
        const consoVal = parseFloat((inputConsoElem.value || '').replace(/\s/g,'').replace(',', '.').replace(/[^0-9.]/g,''));
        if (Number.isFinite(consoVal) && consoVal > 0) {
          conso = consoVal;
          prixKwh = (conso > 0) ? facture / conso : (scenarios[0]?.prixKwh || 0.25); // Eviter division par zéro
          sourceConso = "kwh";
        } else { 
          alert("Consommation kWh invalide, calcul basé sur la facture uniquement.");
          prixKwh = scenarios[0]?.prixKwh || 0.25; 
          conso = (prixKwh > 0) ? facture / prixKwh : 0; // Eviter division par zéro
        }
      } else {
        prixKwh = scenarios[0]?.prixKwh || 0.25; 
        conso = (prixKwh > 0) ? facture / prixKwh : 0; // Eviter division par zéro
      }
      
      // Choix du scénario pertinent
      const minProd = Math.min(...scenarios.map(s => s.prod || Infinity), Infinity); // Ajout Infinity pour cas vide
      if (conso < minProd) { alert("Consommation trop faible : installation non conseillée."); hideCalcOverlay(); return false; }
      let sc = scenarios.filter(s => (s.prod||0) <= conso).sort((a,b)=> (b.prod||0) - (a.prod||0))[0];
      if (!sc) sc = scenarios.sort((a,b)=> (b.prod||0) - (a.prod||0))[0]; 
      if (!sc) { alert("Erreur: Aucun scénario applicable trouvé."); hideCalcOverlay(); return false; } 

      // Calculs financiers
      const autocons = Math.min(sc.prod || 0, conso || 0); 
      const gainAn   = autocons * (Number.isFinite(prixKwh) && prixKwh > 0 ? prixKwh : 0);
      const gainMois = gainAn / 12;
      const tauxHausse = 0.03; 
      const dureeProjection = 15;
      const facteurCumul = (tauxHausse > 0) ? (Math.pow(1 + tauxHausse, dureeProjection) - 1) / tauxHausse : dureeProjection; // Gère taux = 0
      const gain15 = gainAn * facteurCumul;

      // Stockage des données
      simulationData = { 
        cp, facture, conso: Math.round(conso), prixKwh, sc, 
        gainAn: Math.round(gainAn), gainMois: Math.round(gainMois), gain15: Math.round(gain15), 
        autocons: Math.round(autocons), sourceConso 
      };

      // Rendu HTML
      const recapDiv = document.getElementById('recap');
      if (!recapDiv){ console.warn('#recap manquant'); hideCalcOverlay(); return false; }
      
      recapDiv.innerHTML = `
        <div class="result-card" role="region" aria-label="Votre estimation personnalisée">
          <h2>Votre estimation personnalisée</h2>
          <div class="result-grid" style="margin-top:12px">
            ${generateVisiblePartHTML(simulationData)} 
          </div>
          <div class="lock-zone" id="lock-zone">
            <div class="result-grid lock-blur" id="lock-blur" style="margin-top:12px">
              ${generateLockedPartHTML(simulationData)}
            </div>
            ${generateGateHTML()}
          </div>
        </div>`;

      attachPhoneMask(); 
      recapDiv.style.display = 'block';
      document.body.classList.add('results-mode');
      recapDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });

      // Déclenchement Conversion Simulation
      if (typeof gtag_report_simulation === 'function') { gtag_report_simulation(); }

      // Initialiser Formulaire Gate
      initGateForm();

      hideCalcOverlay();
      return false; 
    }; // Fin __handleSubmitEtape1

    // Initialisation et gestion du formulaire Gate (Étape 2)
    function initGateForm(){
      const form  = document.getElementById('gate-form');
      const blurDiv = document.getElementById('lock-blur');
      const gateDiv = document.getElementById('gate-overlay');
      if(!form || !blurDiv || !gateDiv) { console.error("Éléments Gate manquants."); return; }

      form.addEventListener('submit', (e)=>{
        e.preventDefault();
        const phoneInput = document.getElementById('gate-phone');
        const emailInput = document.getElementById('gate-email');
        const phone = String(phoneInput?.value || '').trim();
        const email = String(emailInput?.value || '').trim();
        const digits = phone.replace(/\D/g,''); 

        // Validation
        if(digits.length < 10){ alert('Merci d’indiquer un numéro de téléphone valide (10 chiffres).'); phoneInput?.focus(); return; }
        if(email && !/^\S+@\S+\.\S+$/.test(email)) { alert('Merci d\'indiquer un email valide.'); emailInput?.focus(); return; }


        // 1. Déclenchement Conversion Lead
        if (typeof gtag_report_conversion === 'function') { gtag_report_conversion(); }

        // 2. Envoi Google Sheet
        if (simulationData && simulationData.sc) {
          const fd = new FormData();
          const sc = simulationData.sc; 
          
          fd.append("timestamp", new Date().toISOString()); 
          fd.append("code_postal", simulationData.cp || '');
          fd.append("facture", simulationData.facture || 0);
          fd.append("conso", simulationData.conso || 0);
          fd.append("source_conso", simulationData.sourceConso || '');
          fd.append("prix_kwh", simulationData.prixKwh || 0);
          fd.append("puissance", sc.puissance || '');
          fd.append("panneaux", sc.panels || 0);
          fd.append("prod", sc.prod || 0);
          fd.append("prix", sc.prix || 0);
          fd.append("remise", sc.remiseChantier || 0);
          fd.append("mensualite", sc.mensualite || 0);
          fd.append("taeg", sc.taeg || 0);
          fd.append("totalcredit", sc.total || 0);
          fd.append("mois", sc.dureeMois || 0);
          fd.append("eco1", simulationData.gainAn || 0);
          fd.append("ecomensuelle", simulationData.gainMois || 0);
          fd.append("eco15", simulationData.gain15 || 0);
          fd.append("email", email); 
          fd.append("telephone", digits); 
          fd.append("emailUser", email); 
          fd.append("tel", digits);      
          fd.append("unlock", "1");      
          
          if (typeof window.__getAdsTrack === 'function') {
            const ads = window.__getAdsTrack();
            Object.keys(ads).forEach(key => fd.append(key, ads[key] || ''));
          }

          fetch(G_SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: fd })
            .then(() => console.log("Données envoyées à GSheet."))
            .catch(err => console.error('Erreur lors de l\'envoi GSheet:', err));
            
        } else { console.warn("Données de simulation non disponibles. Envoi GSheet annulé."); }

        // 3. Déverrouillage UI
        blurDiv.classList.remove('lock-blur');
        gateDiv.remove(); 
        insertPdfCta();   // le bouton PDF apparaît maintenant, uniquement après le téléphone

        
      }); // Fin listener submit
    } // Fin initGateForm
    // Injecte le bouton PDF en bas des résultats APRÈS déverrouillage
function insertPdfCta(){
  if (document.getElementById('btn-pdf')) return; // déjà présent
  const card = document.querySelector('#recap .result-card');
  if (!card) return;

  const wrapper = document.createElement('div');
  wrapper.className = 'kpi';
  wrapper.style.cssText = 'grid-column:1/-1; text-align:center; padding-top:6px;';
  wrapper.innerHTML = `
  <button id="btn-pdf" type="button" class="gate-cta" style="width:min(420px,100%);">
    Télécharger mon estimation en PDF
    <span class="arrow" aria-hidden="true">→</span>
  </button>
`;

  card.appendChild(wrapper);
  attachPdfHandler();
}

function attachPdfHandler(){
  const btn = document.getElementById('btn-pdf');
  if(!btn) return;
  btn.addEventListener('click', () => {
    try{ prepareAndPrint(); }
    catch(e){ console.error('Erreur impression PDF', e); alert("Impossible de préparer le PDF. Réessayez."); }
  });
}

// En-tête imprimable + window.print + nettoyage
// En-tête premium + pied de page + impression, puis nettoyage
function prepareAndPrint(){
  const recap = document.getElementById('recap');
  if(!recap){ window.print(); return; }

  // Récupération d'infos utiles si disponibles
  const cp = (window.simulationData && window.simulationData.cp) ? String(window.simulationData.cp) : '';
  const dep = cp ? cp.slice(0,2) : '28'; // fallback 28 si non dispo
  const sc  = (window.simulationData && window.simulationData.sc) ? window.simulationData.sc : {};
  const titreLigne = `Estimation photovoltaïque – Eure-et-Loir (${dep})`;
  const sousTitre  = cp ? `Code postal : ${cp} · Puissance : ${sc.puissance || '—'} · Production : ${(sc.prod || 0).toLocaleString('fr-FR')} kWh/an` 
                        : `Puissance : ${sc.puissance || '—'} · Production : ${(sc.prod || 0).toLocaleString('fr-FR')} kWh/an`;

  // En-tête imprimable (centré, barre accent)
  const header = document.createElement('div');
  header.className = 'print-header';
  header.innerHTML = `
    <div style="text-align:center;">
      <img src="https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/687b0f048a98e03f86e7852020887ff4f05eb913/logo%20SSP.webp"
           alt="Solution Solaire Pro" style="height:48px;width:auto;display:inline-block;margin-bottom:6px;">
      <div style="font-weight:900;font-size:18px;line-height:1.2;color:#111">${titreLigne}</div>
      <div style="font-size:12px;color:#374151;margin-top:2px;">${sousTitre}</div>
      <div style="font-size:12px;color:#6b7280;margin-top:2px;">Édité le ${new Date().toLocaleDateString('fr-FR')}</div>
      <div style="height:6px;margin:10px auto 0;width:100%;max-width:120px;border-radius:999px;
                  background:linear-gradient(180deg,#f59e0b,#fbbf24);"></div>
    </div>
  `;


  // Insertion en tête de la carte + pied après la carte
  const card = recap.querySelector('.result-card');
  if(card){
    card.insertAdjacentElement('afterbegin', header);

  }

  // Impression puis nettoyage
  const cleanup = () => {
    header.remove(); footer.remove();
    window.removeEventListener('afterprint', cleanup);
  };
  window.addEventListener('afterprint', cleanup);
  window.print();
}


    // --- Fonctions pour générer le HTML des résultats ---
    function generateVisiblePartHTML(data) {
      const { cp = 'N/A', conso = 0, prixKwh = 0, facture = 0, sc = {} } = data;
      return `
        <div class="kpi"> <div class="label">Code postal</div> <div class="value">${cp}</div> </div>
        <div class="kpi"> <div class="label">Conso annuelle estimée</div> <div class="value" style="color:#0f172a">${conso.toLocaleString('fr-FR')} kWh</div> </div>
        <div class="kpi"> <div class="label">Prix du kWh utilisé</div> <div class="value">${Number(prixKwh).toFixed(3)} €</div> </div>
        <div class="kpi"> <div class="label">Facture annuelle</div> <div class="value">${Number(facture).toLocaleString('fr-FR')} €</div> </div>
        <div class="kpi kpi--highlight" style="grid-column:1/-1"> <div class="label">Dimensionnement proposé</div> <div class="value"> ${sc.puissance || 'N/A'} — ${sc.panels || 0} panneaux (500 W) • Production estimée <span style="color:#16a34a;font-weight:800">${(sc.prod || 0).toLocaleString('fr-FR')} kWh/an</span> </div> </div>`;
    }

    function generateLockedPartHTML(data) {
      const { sc = {}, gainAn = 0, gainMois = 0, gain15 = 0, autocons = 0, conso = 0 } = data;
      const pctCouverture = (conso > 0) ? ((autocons / conso) * 100).toFixed(1) : 0;
      const tauxHausse = 0.03; // Assurez-vous que cette variable est définie ou passée
      return `
        <div class="kpi" style="grid-column:1/-1"> <div class="value" style="font-size:18px;font-weight:700;color:#16a34a;margin-bottom:6px"> ${pctCouverture} % <span style="color:#0f172a;font-weight:600">de votre consommation est couverte par votre production</span> </div> <div style="color:#334155;font-size:13px;line-height:1.5;margin-top:2px"> Votre production est valorisée à 100&nbsp;% grâce à la batterie virtuelle... <em>Hypothèse standard...</em> </div> </div>
        <div class="kpi"> <div class="label">Gain 1ʳᵉ année (ordre de grandeur)</div> <div class="value" style="color:#16a34a"> ${gainAn.toLocaleString('fr-FR')} € / an </div> </div>
        <div class="kpi"> <div class="label">Économie moyenne mensuelle</div> <div class="value" style="color:#16a34a"> ${gainMois.toLocaleString('fr-FR')} € / mois </div> </div>
        <div class="kpi" style="grid-column:1/-1"> <div class="label">Économie cumulée sur 15 ans</div> <div class="value" style="color:#16a34a"> ${gain15.toLocaleString('fr-FR')} € </div> <div class="note" style="margin-top:4px"> Hypothèses&nbsp;: prix du kWh +${(tauxHausse*100)}&nbsp;%/an... </div> </div>
        ${generateRemiseBannerHTML(sc)}
        ${generateFinancementCardHTML(sc)}`;
    }
    
    function generateRemiseBannerHTML(sc) {
      if (Number.isFinite(sc?.remiseChantier) && sc.remiseChantier > 0) {
        return `
          <div class="financial-banner" style="grid-column: 1 / -1;">
            <div style="font-weight:700; color:#7c2d12; margin-bottom:4px">Offre spéciale « Groupage chantiers »</div>
            <div style="font-size:22px; font-weight:900; color:#7c2d12;"> ${Math.round(sc.remiseChantier).toLocaleString('fr-FR')} € de remise immédiate </div>
            <div class="note" style="margin-top:6px; color:#334155">(à déduire du prix TTC indiqué ci-dessous)</div>
            <div class="note" style="margin-top:4px; color:#334155"><strong>Valable jusqu’au 31 octobre 2025</strong></div>
          </div>`;
      } return '';
    }

function generateFinancementCardHTML(sc) {
      const prixHTML = Number.isFinite(sc?.prix) ? `<p style="margin:0 0 8px"><strong>Installation ${sc.puissance || ''}</strong> : <span class="token">${Math.round(sc.prix).toLocaleString('fr-FR')} € TTC</span> <span class="note">(prix indicatif hors options)</span> </p>` : '';
      let financementDetailsHTML = '';
      if (Number.isFinite(sc?.mensualite) && sc.mensualite > 0) { // Ajout vérification > 0
        const dureeHTML = Number.isFinite(sc?.dureeMois) && sc.dureeMois > 0 ? `<span class="token">Durée : ${sc.dureeMois} mois</span>` : '';
        const taegHTML = Number.isFinite(sc?.taeg) ? `<span class="token">TAEG fixe : ${sc.taeg}%</span>` : '';
        const totalHTML = Number.isFinite(sc?.total) && sc.total > 0 ? `<p style="margin:6px 0 0"><strong>Prix total</strong> : <span class="token">${Number(sc.total).toLocaleString('fr-FR', {minimumFractionDigits:2, maximumFractionDigits:2})} €</span> </p>` : '';
    	  financementDetailsHTML = `
          <p style="margin:10px 0 4px; font-weight:700">Option financement <span class="note">(facultatif)</span></p>
          <div class="tokens">
          	<span class="token">${(sc.mensualite).toLocaleString('fr-FR', {minimumFractionDigits:2, maximumFractionDigits:2})} € / mois</span>
          	${dureeHTML} ${taegHTML}
          </div>
          ${totalHTML}
          <p class="note" style="margin:10px 0 0">Financement proposé par notre partenaire, sous réserve d’acceptation.</p>
          <div class="note note-alert">⚠️Un crédit vous engage et doit être remboursé. Vérifiez vos capacités de remboursement avant de vous engager.</div>
          <p class="note" style="margin:8px 0 0">Estimation indicative. Visite technique nécessaire...</p>
      	  <p style="margin: 18px 0 4px; text-align: center; font-size: 16px; font-weight: 700; color: var(--accent); line-height: 1.5;">
      	  	<span style="white-space: nowrap;">Cette estimation vous a été offerte par Solution Solaire Pro filiale de Biofrance energies.</span>
      	  	<br>
      	  	<span style="white-space: nowrap;">Vous pouvez contacter votre conseiller régional</span>
      	  	<br>
      	  	<span style="white-space: nowrap;">
      	  	  au <a href="tel:0648893480" style="color: inherit; text-decoration: underline; font-weight: 800;">06 48 89 34 80</a>.
      	  	</span>
      	  </p>
`;
      }
      // Toujours afficher la carte, même sans détails de financement si le prix est connu
      if(prixHTML || financementDetailsHTML) {
        return `
          <div class="financial-card" style="grid-column: 1 / -1;">
          	<h3 class="financial-title">Coût et financement</h3>
          	${prixHTML}
          	${financementDetailsHTML}
          </div>`;
      }
      return ''; // Ne rien afficher si ni prix ni financement ne sont valides
    }
    function generateGateHTML() {
      // Le HTML du formulaire Gate est statique.
      return `
        <div class="gate-overlay" id="gate-overlay" role="dialog" aria-modal="true" aria-labelledby="gate-title">
          <div class="gate-card">
            <h3 id="gate-title" class="gate-title">Vous avez vu vos panneaux et votre production…</h3>
            <p class="gate-sub"><strong>Et si on allait plus loin&nbsp;?</strong></p>
            <p class="gate-sub">Découvrez le coût précis, vos économies et votre mensualité fixe.<br> Profitez de <strong>la remise immédiate</strong> <span class="gate-deadline">(jusqu’au 31/10/2025)</span>.</p>
            <div class="gate-badges" aria-hidden="true"> <div class="badge"><span>🔒</span><b>Données protégées</b></div> <div class="badge"><span>⚡</span><b>Étude affichée immédiatement à l’écran</b></div> </div>
            <form id="gate-form" class="gate-form" novalidate>
              <label style="width:100%"> <span class="sr-only">Votre email (facultatif)</span> <input id="gate-email" class="gate-input" type="email" placeholder="Votre email (facultatif)" autocomplete="email" /> </label>
              <label style="width:100%"> <span class="sr-only">Téléphone (obligatoire)</span> <input id="gate-phone" class="gate-input" type="tel" placeholder="Téléphone (obligatoire)" autocomplete="tel" required /> </label>
              <p class="gate-hint full" id="rgpd-info"> En validant, vous acceptez d’être contacté uniquement par <strong>SMS</strong> pour votre étude photovoltaïque.</p>
              <div class="gate-hint full" aria-hidden="true"> Un SMS de confirmation vous sera envoyé. Libre à vous d’échanger ensuite.</div>
              <div class="gate-proof full"> ✅ Votre projet s’autofinance grâce à vos économies. Vérifiez-le par vous-même&nbsp;!</div>
              <button class="gate-cta full" type="submit" aria-label="Voir mon étude complète et mes économies"> Voir mon étude complète et mes économies <span class="arrow" aria-hidden="true">→</span> </button>
            </form>
            <div class="gate-note">Vos données ne seront jamais revendues ni utilisées à d’autres fins.</div>
          </div>
        </div>`;
    }

  })(); // Fin IIFE principale
</script>

<script>
  // Logique du bandeau cookie
  (function(){ const KEY='consent_v2', banner=document.getElementById('consent-banner'), btnAccept=document.getElementById('consent-accept'), btnReject=document.getElementById('consent-reject'); if (!banner || !btnAccept || !btnReject) return; function updateConsent(state){ gtag('consent','update',{ analytics_storage: state.analytics ? 'granted' : 'denied', ad_storage: state.ads ? 'granted' : 'denied', ad_user_data: state.adUserData ? 'granted' : 'denied', ad_personalization: state.adPersonal ? 'granted' : 'denied' }); } function save(s){ try{ localStorage.setItem(KEY, JSON.stringify(s)); }catch(e){} } function load(){ try{ return JSON.parse(localStorage.getItem(KEY)||'null'); }catch(e){ return null; } } const saved=load(); if(saved){ updateConsent(saved); banner.style.display='none'; } else{ banner.style.display='block'; requestAnimationFrame(()=>{ banner.style.opacity='1'; banner.style.transform='translateY(0)'; }); } btnAccept.addEventListener('click', ()=>{ const s={analytics:true,ads:true,adUserData:true,adPersonal:true}; updateConsent(s); save(s); banner.style.display='none'; }); btnReject.addEventListener('click', ()=>{ const s={analytics:false,ads:false,adUserData:false,adPersonal:false}; updateConsent(s); save(s); banner.style.display='none'; }); })();
</script>
<script>
  // Trace UTM/GCLID
  (function(){ const p = new URLSearchParams(location.search); const track = { utm_source:(p.get('utm_source')||''), utm_medium:(p.get('utm_medium')||''), utm_campaign:(p.get('utm_campaign')||''), utm_adgroup:(p.get('utm_adgroup')||''), utm_term:(p.get('utm_term')||''), utm_matchtype:(p.get('utm_matchtype')||''), utm_device:(p.get('utm_device')||''), gclid:(p.get('gclid')||''), gbraid:(p.get('gbraid')||''), wbraid:(p.get('wbraid')||'') }; const isAds = track.gclid || track.gbraid || track.wbraid || (track.utm_source.toLowerCase()==='google' && track.utm_medium.toLowerCase()==='cpc'); if(isAds){ try{ localStorage.setItem('ads_tracking_v1', JSON.stringify({ t: Date.now(), ...track })); }catch(e){} } window.__getAdsTrack = function(){ try{ const raw = localStorage.getItem('ads_tracking_v1'); if(!raw) return track; const obj = JSON.parse(raw); /* Données expirent après 7 jours */ if(Date.now()-(obj.t||0) > 7*24*60*60*1000) { localStorage.removeItem('ads_tracking_v1'); return track; } /* Retourne les données sauvegardées */ return obj; }catch(e){ return track; } }; })();
</script>

</body>
</html>
