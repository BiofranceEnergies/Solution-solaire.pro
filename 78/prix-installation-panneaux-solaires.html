<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex,nofollow,noarchive">

 <title>Prix installation panneaux solaires dans les Yvelines (78) | Gratuit & sans engagement</title>

 <meta name="description" content="Prix installation panneaux solaires dans les Yvelines (78) : estimation claire et immédiate, gratuite et sans engagement. Calculez votre installation et vos économies en 1 minute.">

  <link rel="canonical" href="https://www.solution-solaire.pro/78/prix-installation-panneaux-solaires.html">


  <!-- Préconnexions -->
  <link rel="preconnect" href="https://raw.githubusercontent.com" crossorigin>
  <link rel="dns-prefetch" href="//raw.githubusercontent.com">
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
  <link rel="dns-prefetch" href="//www.googletagmanager.com">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-11242044118"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }

    /* Consent par défaut : refus */
    gtag('consent', 'default', {
      ad_storage: 'denied',
      analytics_storage: 'denied',
      ad_user_data: 'denied',
      ad_personalization: 'denied',
      wait_for_update: 500
    });

    /* Recos Google */
    gtag('set', 'ads_data_redaction', true);
    gtag('set', 'url_passthrough', true);

    /* Init */
    gtag('js', new Date());
    gtag('config', 'AW-11242044118');

    /* Mise à jour au consentement */
    window.__grantAdsConsent = function(){
      gtag('consent','update', {
        ad_storage:'granted',
        analytics_storage:'granted',
        ad_user_data:'granted',
        ad_personalization:'granted'
      });
    };
  </script>

  <!-- Conversions Google Ads -->
  <script>
    function gtag_report_conversion() {
      try { gtag('event','conversion',{ send_to:'AW-11242044118/MslOCKGZzo0bENb1z_Ap' }); } catch(e){}
      return true;
    }
    window.__simConvSent = false;
    function gtag_report_simulation() {
      try {
        gtag('event','conversion',{
          send_to:'AW-11242044118/TM3qCM3e1Z8bENbiz_Ap',
          value:1.0,currency:'EUR'
        });
      } catch(e){}
    }
  </script>

  <style>
    :root{
      --bg:#f5f7fb; --card:#ffffff; --text:#111827; --muted:#6b7280; --border:#e5e7eb;
      --accent:#f59e0b; --accent-2:#fbbf24; --accent-dark:#d97706; --ok:#16a34a;
      --radius:14px; --shadow:0 14px 36px rgba(2,6,23,.10); --accent-soft:#fff7ed;
      --content-w: 720px; /* largeur commune des cartes */
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;color:var(--text);font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;min-height:100%}
    body{background:transparent}
    /* Fond + overlay */
    body::before{content:"";position:fixed;inset:0;z-index:0;background:url("https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/1ea92369de57361354807811188559129b45985c/foto%20fond.webp") center 35%/cover no-repeat}
    body::after{content:"";position:fixed;inset:0;z-index:1;background:linear-gradient(180deg,rgba(17,24,39,.65),rgba(31,41,55,.55) 45%,rgba(55,65,81,.4) 100%)}

    .wrap{max-width:980px;margin:0 auto;padding:28px 14px;position:relative;z-index:2}

    /* Titres sur overlay (hors cartes) */
    h1{font-size:clamp(28px,3vw,42px);font-weight:800;text-align:center;margin:6px 0 16px;color:#fff;line-height:1.2}
    h1 em{color:var(--accent);font-style:normal}
    h2{font-size:clamp(18px,2.2vw,22px);text-align:center;color:#fff;margin:0 0 10px;font-weight:800;text-shadow:0 1px 2px rgba(0,0,0,.35)}
    /* Titres DANS cartes = noir */
    .card h1,.card h2,.card h3{color:#111827 !important;text-shadow:none !important}

    .lead-sub{color:#fff;text-align:center;margin:8px auto 14px;max-width:760px;line-height:1.5;text-shadow:0 1px 2px rgba(0,0,0,.35)}

    .card{
      background:var(--card);border:1px solid var(--border);
      border-radius:var(--radius);box-shadow:var(--shadow);
      padding:18px;margin:0 auto 18px;color:#111827;
    }
    /* Alignement commun */
    .content-card{max-width:var(--content-w);margin-left:auto;margin-right:auto}

    .form-section{max-width:var(--content-w)}
    .inputs{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:640px){.inputs{grid-template-columns:1fr}}
    input,button{width:100%;padding:12px 14px;border-radius:12px;border:1.5px solid var(--border);background:#fff;color:#111827;font-size:17px}
    input::placeholder{color:#9ca3af}
    a.helper{color:#0b61d8;text-decoration:underline;font-size:14px}

    #lockedSection input[type="email"],#lockedSection input[type="tel"]{border:2px solid var(--accent)}
    #lockedSection input[type="email"]:focus,#lockedSection input[type="tel"]:focus{outline:none;border-color:var(--accent-dark);box-shadow:0 0 0 3px rgba(245,158,11,0.3)}

    button.primary{background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#1b1202;border:0;font-weight:900;letter-spacing:.2px;cursor:pointer;box-shadow:0 8px 22px rgba(245,158,11,.25)}
    button.primary:hover{filter:brightness(1.03)}
    button.primary:focus{outline:2px solid #fde68a;outline-offset:2px}

    .counter-wrap{display:flex;justify-content:center;margin:8px 0 18px}
    .counter-badge{display:inline-block;background:#fff;color:#111827;border:1px solid var(--border);border-radius:999px;padding:8px 14px;font-weight:800;letter-spacing:.2px;box-shadow:var(--shadow)}

    .recap{max-width:var(--content-w)}
    .recap-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:560px){.recap-grid{grid-template-columns:1fr}}
    .recap-item{background:#fff;border:1px solid var(--border);border-radius:12px;padding:12px 14px}
    .recap-item .label{color:#374151;font-size:13px}
    .recap .value-ok{color:var(--ok);font-weight:700}

    .note{display:block;text-align:center;margin:14px 0;color:#065f46;background:#d1fae5;border:1px solid #a7f3d0;padding:10px 12px;border-radius:12px;font-weight:700;font-size:clamp(14px,1.2vw,16px)}

    .kpi{max-width:var(--content-w)}
    .kpi-box{padding:10px 12px;border-radius:12px;background:#ecfdf5;border:1px solid #a7f3d0;margin-bottom:10px}
    .kpi-box b{color:var(--ok)}

    #lockedSection{max-width:var(--content-w);position:relative}
    .lockedContent{filter:blur(7px);user-select:none;pointer-events:none}
    .veil{position:absolute;inset:0;border-radius:var(--radius);background:linear-gradient(180deg,rgba(255,255,255,.75),rgba(255,255,255,.98));backdrop-filter:blur(2px);display:flex;flex-direction:column;align-items:center;justify-content:flex-start;gap:12px;text-align:center;padding:60px 20px 20px;border:1px solid var(--border)}
    @media(max-width:640px){.veil{padding-top:30px}}
    .unlock{display:grid;grid-template-columns:1fr 1fr;gap:10px;max-width:560px;width:100%}
    @media(max-width:580px){.unlock{grid-template-columns:1fr}}
    .unlock input{background:#fff;border:1.5px solid var(--border)}
    .consent{display:flex;gap:8px;align-items:flex-start;color:#374151;font-size:13px;text-align:left}
    .consent input{width:auto;margin-top:3px}

    /* Mentions légales (mini-modal) */
    #mentions-legales-container{width:100%;text-align:center;margin:26px 0 8px;display:block}
    #mentions-legales-link{color:#0b61d8;text-decoration:underline;cursor:pointer}
    #mentions-popup{display:none;position:fixed;bottom:60px;left:50%;transform:translateX(-50%);width:340px;max-width:95vw;background:#fff;color:#111827;border-radius:13px;box-shadow:0 8px 32px rgba(0,0,0,.15);padding:18px 20px 12px;z-index:10000;font-size:13px;line-height:1.7;border:1px solid var(--border)}
    #close-mentions{position:absolute;top:6px;right:12px;background:none;color:#111827;border:none;font-size:18px;font-weight:bold;cursor:pointer;padding:0}

    .sep{border:none;border-top:2px solid var(--border);margin:30px 0 16px}

    /* Overlay calcul */
    body.no-scroll{overflow:hidden}
    #calc-overlay{position:fixed;inset:0;background:rgba(2,6,23,.35);backdrop-filter:blur(2px);display:none;z-index:9998;align-items:center;justify-content:center;padding:20px}
    #calc-overlay .panel{width:100%;max-width:360px;background:#fff;border:1px solid var(--border);border-radius:14px;box-shadow:var(--shadow);padding:18px;text-align:center;outline:none}
    #calc-overlay .spinner{width:42px;height:42px;margin:6px auto 12px;border:4px solid #e5e7eb;border-top:4px solid var(--accent);border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    #calc-overlay .title{color:#111827;font-weight:800;margin:0 0 6px}
    #calc-overlay .desc{color:#374151;font-size:14px;margin:0}

    /* Logos header */
    .header-logos{display:flex;align-items:center;justify-content:center;gap:20px;margin:0 auto 12px;max-width:var(--content-w)}
    .logo-main{width:130px;height:auto;filter:drop-shadow(0 2px 8px rgba(0,0,0,.08))}
    .logo-side{width:70px;height:auto;opacity:.95}

    /* Étoiles or avec remplissage partiel */
    .stars{ --rating:4.7; position:relative; display:inline-block; font-size:18px; line-height:1; letter-spacing:1px; }
    .stars::before{ content:"★★★★★"; color:#e5e7eb; }
    .stars::after{ content:"★★★★★"; position:absolute; left:0; top:0; width:calc(var(--rating) / 5 * 100%); overflow:hidden; white-space:nowrap; color:#f59e0b; }
  </style>
</head>

<body>

  <!-- Consent Mode V2 – bandeau -->
  <div id="consent-banner" class="consent-banner" role="dialog" aria-live="polite" aria-label="Préférences de confidentialité" style="position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid var(--border);color:#111827;padding:12px;z-index:9999;display:none;box-shadow:0 -6px 26px rgba(0,0,0,.12);font:14px/1.5 system-ui,Segoe UI,Roboto;min-height:56px">
    <div class="consent-inner" style="max-width:900px;margin:0 auto;display:flex;gap:14px;align-items:center;justify-content:space-between;flex-wrap:wrap">
      <div class="consent-text" style="flex:1 1 520px;font-size:14px;color:#374151">Nous utilisons des technologies pour la mesure et la publicité. Vous pouvez refuser.</div>
      <div class="consent-buttons" style="display:flex;gap:10px">
        <button id="consent-reject" type="button" style="padding:8px 16px;border-radius:999px;font-weight:700;cursor:pointer;border:none;font-size:14px;background:#111827;color:#fff">Tout refuser</button>
        <button id="consent-accept" type="button" style="padding:8px 16px;border-radius:999px;font-weight:700;cursor:pointer;border:none;font-size:14px;background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#1b1202">Tout accepter</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <!-- Header logos -->
    <div class="header-logos">
      <img src="https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/4064855dc178a214f463137266443f8de49a2cfa/icone%20RGE.webp" alt="Certification RGE" class="logo-side" width="70" height="70" loading="lazy">
      <img src="https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/52db4f3ab1c38909b33d9037e74d7371c32a9cf5/logo%20SSP.webp" alt="Logo Solution Solaire Pro" class="logo-main" fetchpriority="high" decoding="async" width="130" height="40">
      <img src="https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/4064855dc178a214f463137266443f8de49a2cfa/icone%20qualipv.webp" alt="Certification QualiPV" class="logo-side" width="70" height="70" loading="lazy">
    </div>

    <!-- Compteur -->
    <div class="counter-wrap">
      <div class="counter-badge">
        <span id="compteurValeur" style="font-weight:900;letter-spacing:.2px">250</span>
        <span style="opacity:.85"> simulations depuis le 1ᵉʳ mai 2025</span>
      </div>
    </div>

 <!-- Accroche principale (sur overlay) -->
<h1><em>Prix installation panneaux solaires</em> dans les Yvelines (78)</h1>
<p class="lead-sub">
  Obtenez le <strong>prix installation panneaux solaires</strong> pour votre maison en 1 minute&nbsp;:
  nombre de panneaux, production et économies estimées (≈ 1 000 à 1 500 €/an selon profil).
</p>

<h2 style="margin-top:6px">Calculez votre installation solaire en 1 minute</h2>


    <!-- Formulaire -->
    <div class="card form-section content-card" style="border:2px solid var(--accent)">
      <h2>Coût de votre installation & économies en direct</h2>

      <form onsubmit="calculerSimulation(); return false;" novalidate>
        <div class="inputs" style="margin-bottom:8px">
          <input type="text" id="codePostal" placeholder="Votre code postal (ex : 78000)" maxlength="5" inputmode="numeric" pattern="[0-9]{5}" autocomplete="postal-code" required>
          <input type="text" id="facture" placeholder="Votre facture élec /an (ex : 1 800 €)" inputmode="decimal" autocomplete="off" required>
        </div>
        <div id="modeAvance" style="display:none">
          <input type="text" id="conso" placeholder="Conso annuelle (kWh, optionnel)" inputmode="decimal" autocomplete="off">
        </div>
        <a href="#" id="lienAvance" class="helper">➕ Vous connaissez votre consommation annuelle ? Cliquez ici pour une estimation ultra-précise</a>
        <div style="margin-top:6px;font-size:13px;color:#6b7280;text-align:center">Pas votre conso ? La facture suffit.</div>
        <div style="height:10px"></div>
        <button id="simuler" type="submit" class="primary" aria-label="Calculer le coût installation panneaux solaires">
⚡ Calculer mon coût maintenant
</button>

      </form>
    </div>

    <!-- Bloc Info -->
    <div class="card content-card" id="bloc-info" data-hide-after-sim="1">
      <h2>Un simulateur qui va à l’essentiel</h2>
      <p style="text-align:center;color:#374151;font-size:15.5px;line-height:1.6;margin:0 0 18px">
        Obtenez en <strong>1 minute</strong> une estimation claire de votre projet solaire :
        production, panneaux et couverture de votre consommation.
      </p>
      <ul style="list-style:none;margin:0;padding:0">
        <li style="display:flex;align-items:center;gap:10px;margin:10px 0;font-size:15.5px;color:#1f2937">
          <span style="flex:0 0 28px;height:28px;border-radius:50%;background:#faa825;color:#fff;font-weight:700;display:flex;align-items:center;justify-content:center;font-size:14px">1</span>
          <span><strong>Votre étude personnalisée</strong> selon votre consommation</span>
        </li>
        <li style="display:flex;align-items:center;gap:10px;margin:10px 0;font-size:15.5px;color:#1f2937">
          <span style="flex:0 0 28px;height:28px;border-radius:50%;background:#faa825;color:#fff;font-weight:700;display:flex;align-items:center;justify-content:center;font-size:14px">2</span>
          <span><strong>Vos économies estimées</strong> dès la 1ʳᵉ année</span>
        </li>
        <li style="display:flex;align-items:center;gap:10px;margin:10px 0;font-size:15.5px;color:#1f2937">
          <span style="flex:0 0 28px;height:28px;border-radius:50%;background:#faa825;color:#fff;font-weight:700;display:flex;align-items:center;justify-content:center;font-size:14px">3</span>
          <span><strong>Le coût précis</strong> de l’installation et son financement</span>
        </li>
      </ul>
      <p style="margin-top:18px;text-align:center;background:#fff7eb;padding:10px 14px;border-radius:10px;color:#b45309;font-weight:700;font-size:15px">
        👉 Rien de superflu. Juste les chiffres qui comptent.
      </p>
    </div>

    <!-- Bloc Confiance -->
    <div class="card content-card" id="bloc-toiture" data-hide-after-sim="1" style="text-align:center;padding:16px">
      <img src="https://raw.githubusercontent.com/BiofranceEnergies/biofrance-images/4e6404b6e080e1db51a9fbb9ed22c24dd00e62d5/Pose%20pv%202.webp"
           alt="Pose de panneaux photovoltaïques en Nouvelle-Aquitaine"
           width="720" height="405"
           style="display:block;margin:0 auto 12px;border-radius:12px;max-width:100%;height:auto" loading="lazy">
      <ul style="list-style:none;padding:0;margin:0;font-size:15px;line-height:1.55;color:#111827;text-align:left;max-width:640px;display:inline-block">
        <li style="margin:2px 0">🔒 <strong>30 ans de garanties fabricants</strong></li>
        <li style="margin:2px 0">– Plus de <strong>300 installations</strong> déjà posées en Nouvelle-Aquitaine</li>
        <li style="margin:2px 0">– Nous nous occupons de <strong>toutes les démarches administratives</strong></li>
      </ul>
    </div>

  <!-- Témoignages -->
<div class="card temoins content-card" id="bloc-temoins" data-hide-after-sim="1">
  <h2>Ils l'ont testé</h2>
  <div style="display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:14px;font-weight:700">
    <span class="stars" style="--rating:4.7" aria-label="Note moyenne 4,7 sur 5"></span>
    <span style="color:#111827;font-size:15px"><strong>4,7 / 5</strong> – Nos clients satisfaits</span>
  </div>
  <div style="display:grid;gap:14px">
    <div style="background:#fff;border:1px solid var(--border);border-left:4px solid var(--accent);border-radius:10px;padding:14px 16px;box-shadow:0 4px 12px rgba(2,6,23,.06)">
      <blockquote style="margin:0;color:#111827;font-size:15.5px;line-height:1.55">“Étude claire et chiffrée. En quelques minutes, on visualise immédiatement la rentabilité du projet.”</blockquote>
      <cite style="display:block;margin-top:8px;color:#6b7280;font-style:normal;font-size:14px">— <strong>Patrick D.</strong>, Versailles · 06/2025</cite>
    </div>
    <div style="background:#fff;border:1px solid var(--border);border-left:4px solid var(--accent);border-radius:10px;padding:14px 16px;box-shadow:0 4px 12px rgba(2,6,23,.06)">
      <blockquote style="margin:0;color:#111827;font-size:15.5px;line-height:1.55">“Simulation rapide et transparente, sans démarchage. Résultats fiables et réalistes.”</blockquote>
      <cite style="display:block;margin-top:8px;color:#6b7280;font-style:normal;font-size:14px">— <strong>Sandrine L.</strong>, Rambouillet · 06/2025</cite>
    </div>
    <div style="background:#fff;border:1px solid var(--border);border-left:4px solid var(--accent);border-radius:10px;padding:14px 16px;box-shadow:0 4px 12px rgba(2,6,23,.06)">
      <blockquote style="margin:0;color:#111827;font-size:15.5px;line-height:1.55">“En moins de deux minutes, j’ai eu mon estimation complète. C’est clair et bien présenté.”</blockquote>
      <cite style="display:block;margin-top:8px;color:#6b7280;font-style:normal;font-size:14px">— <strong>Olivier G.</strong>, Poissy · 05/2025</cite>
    </div>
    <div style="background:#fff;border:1px solid var(--border);border-left:4px solid var(--accent);border-radius:10px;padding:14px 16px;box-shadow:0 4px 12px rgba(2,6,23,.06)">
      <blockquote style="margin:0;color:#111827;font-size:15.5px;line-height:1.55">“Très bon contact, étude sérieuse. Les économies annoncées sont réalistes et vérifiables.”</blockquote>
      <cite style="display:block;margin-top:8px;color:#6b7280;font-style:normal;font-size:14px">— <strong>Isabelle F.</strong>, Mantes-la-Jolie · 05/2025</cite>
    </div>
    <div style="background:#fff;border:1px solid var(--border);border-left:4px solid var(--accent);border-radius:10px;padding:14px 16px;box-shadow:0 4px 12px rgba(2,6,23,.06)">
      <blockquote style="margin:0;color:#111827;font-size:15.5px;line-height:1.55">“Interface simple, résultats précis. Très pratique pour se faire une idée avant d’aller plus loin.”</blockquote>
      <cite style="display:block;margin-top:8px;color:#6b7280;font-style:normal;font-size:14px">— <strong>Jean-Marc P.</strong>, Saint-Germain-en-Laye · 06/2025</cite>
    </div>
  </div>
</div>


    <!-- Récap (VISIBLE) -->
    <div id="recap" class="card recap content-card" style="display:none;visibility:hidden;height:0;overflow:hidden;"></div>

    <!-- SECTION VERROUILLÉE (floue) -->
    <div id="lockedSection" class="card content-card" style="display:none;visibility:hidden;height:0;overflow:hidden; border:5px solid var(--accent); border-radius:16px; padding:20px;">
      <div id="lockedContent" class="lockedContent"></div>
      <div class="veil" id="veil">
        <h2 style="margin:0 0 15px">Vous avez vu vos panneaux et votre production…<br><span style="color:#f97316">💡 Et si on allait plus loin ?</span></h2>
        <ul style="margin:12px auto;color:#374151;list-style:none;padding:0;max-width:600px;font-size:1rem;line-height:1.55">
          <li style="margin:6px 0"><strong style="color:#111827">Découvrez</strong> le coût précis de votre installation</li>
          <li style="margin:6px 0"><strong style="color:#111827">Voyez immédiatement</strong> vos économies et votre mensualité fixe</li>
          <li style="margin:6px 0"><strong style="color:var(--accent-dark)">Profitez</strong> de 800 € de remise immédiate <span style="color:#d97706">(jusqu’au 31/10/2025)</span></li>
        </ul>

        <div style="display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin:10px 0 0 0">
          <span style="display:flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:#fff;box-shadow:var(--shadow);min-height:42px;font-weight:700"><span>🔒</span><span>Données protégées</span></span>
          <span style="display:flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:#fff;box-shadow:var(--shadow);min-height:42px;font-weight:700"><span>⚡</span><span>Étude affichée immédiatement à l’écran</span></span>
        </div>

        <div class="unlock" style="margin-top:10px">
          <div class="field">
            <label for="emailUnlock" class="label">Email <span style="color:#6b7280;font-weight:600">(facultatif)</span></label>
            <input type="email" id="emailUnlock" placeholder="Votre email (facultatif)" autocomplete="email">
          </div>
          <div class="field">
            <label for="telUnlock" class="label">Téléphone <span>(obligatoire)</span></label>
            <input type="tel" id="telUnlock" placeholder="06 12 34 56 78" autocomplete="tel" required>
            <div class="help" style="font-size:13px;color:#6b7280;margin-top:4px">Un SMS de confirmation vous sera envoyé. Libre à vous d’échanger ensuite.</div>
          </div>
          <label class="consent" style="grid-column:1/-1">
            <input type="checkbox" id="rgpdUnlock" required aria-required="true">
            <span>Je consens à être contacté <strong>par SMS uniquement</strong>.</span>
          </label>
          <div style="grid-column:1/-1;text-align:center;margin:6px 0;color:#111827;font-size:14px;font-style:italic">
            ✅ Votre projet s’autofinance grâce à vos économies .<br>Vérifiez-le par vous-même !
          </div>
          <button type="button" class="primary" style="grid-column:1/-1" onclick="submitUnlock(event)"><span aria-hidden="true">📊</span> Voir mon étude complète et mes économies</button>
          <div class="foot" style="grid-column:1/-1;text-align:center;color:#6b7280;font-size:12px;margin-top:6px">Vos données ne seront jamais revendues ni utilisées à d’autres fins.</div>
        </div>
      </div>
    </div>

      <!-- FAQ -->
<div class="card content-card" id="bloc-faq" data-hide-after-sim="1"
     style="border:2px solid var(--accent);
            background:#fffefb;
            box-shadow:0 8px 22px rgba(245,158,11,.15);
            margin-top:16px;
            opacity:0;
            transform:translateY(20px);
            transition:opacity 0.6s ease, transform 0.6s ease;">
  <h2 style="text-align:center;">Questions fréquentes</h2>

  <div class="faq-item" style="margin-bottom:12px">
    <h3 style="margin:0 0 6px">Qu’est-ce que l’autoconsommation solaire&nbsp;?</h3>
    <p style="margin:0;color:#374151;line-height:1.55">
      L’<strong>autoconsommation</strong>, c’est utiliser votre électricité solaire
      <strong>en continu, à l’instant T</strong> (pendant que les panneaux produisent).
      Ce que vous ne consommez pas tout de suite peut être <strong>stocké en batterie virtuelle</strong>
      puis <strong>réinjecté pour vous</strong> le soir, la nuit ou en hiver. Résultat&nbsp;:
      vous valorisez <strong>100&nbsp;% de votre production</strong> et réduisez fortement votre facture.
    </p>
  </div>

  <div class="faq-item" style="margin-bottom:12px">
    <h3 style="margin:0 0 6px">Combien coûte une installation pour une maison de 150&nbsp;m²&nbsp;?</h3>
    <p style="margin:0;color:#374151;line-height:1.55">
      On ne dimensionne pas sur la surface de la maison, mais sur la
      <strong>consommation annuelle</strong> et la <strong>toiture</strong>.
      À titre indicatif, beaucoup de foyers autour de 150&nbsp;m² consomment 8&nbsp;000–10&nbsp;000&nbsp;kWh/an,
      ce qui donne un budget type de <strong>8&nbsp;000 à 12&nbsp;000&nbsp;€ TTC</strong>.
      <br>👉 Lancez la simulation ci-dessous pour votre chiffrage précis.
    </p>
  </div>

  <div class="faq-item" style="margin-bottom:12px">
    <h3 style="margin:0 0 6px">Quelle puissance d’installation choisir&nbsp;?</h3>
    <p style="margin:0;color:#374151;line-height:1.55">
      La puissance se calcule en fonction de votre <strong>consommation annuelle</strong> et de votre
      <strong>taux d’autoconsommation visé</strong>. En moyenne, une famille consomme environ
      <strong>4&nbsp;000 à 5&nbsp;000&nbsp;kWh/an</strong>, soit une installation d’environ
      <strong>4 à 5&nbsp;kWc (8 à 10 panneaux de 500&nbsp;W)</strong>.
      Notre simulateur ajuste automatiquement la puissance idéale selon votre profil.
    </p>
  </div>

  <div class="faq-item" style="margin-bottom:12px">
    <h3 style="margin:0 0 6px">En combien de temps l’installation est-elle rentable&nbsp;?</h3>
    <p style="margin:0;color:#374151;line-height:1.55">
      En moyenne, une installation solaire est <strong>rentabilisée entre 7 et 9 ans</strong>,
      selon votre région et votre consommation.
      <br>Après cette période, vous profitez de <strong>15 à 20 ans d’électricité gratuite</strong>.
      La batterie virtuelle accélère encore cette rentabilité en valorisant 100&nbsp;% de votre production.
    </p>
  </div>

  <div class="faq-item" style="margin-bottom:12px">
    <h3 style="margin:0 0 6px">Est-ce intéressant de vendre le surplus&nbsp;?</h3>
    <p style="margin:0;color:#374151;line-height:1.55">
      Aujourd’hui, le rachat du surplus est d’environ <strong>0,04&nbsp;€/kWh</strong>,
      alors que votre électricité achetée coûte <strong>~0,25–0,30&nbsp;€/kWh</strong>.
      Il est donc bien plus rentable de <strong>consommer votre production</strong>
      (autoconsommation) que de la revendre.
    </p>
  </div>

  <div class="faq-item" style="margin-bottom:12px">
    <h3 style="margin:0 0 6px">La batterie virtuelle, c’est vraiment un plus&nbsp;?</h3>
    <p style="margin:0;color:#374151;line-height:1.55">
      Oui. Plutôt que revendre à 0,04&nbsp;€/kWh, votre surplus est
      <strong>crédité</strong> et <strong>réutilisé</strong> plus tard (soir/nuit/hiver).
      Vous maximisez ainsi l’autoconsommation et vos économies, sans matériel à poser chez vous.
    </p>
  </div>

  <div class="faq-item">
    <h3 style="margin:0 0 6px">Faut-il un entretien annuel&nbsp;?</h3>
    <p style="margin:0;color:#374151;line-height:1.55">
      Pas d’entretien lourd&nbsp;: un <strong>rinçage à l’eau claire</strong> 1–2 fois/an suffit
      pour garder un bon rendement. Certains installateurs proposent un
      <strong>contrat d’entretien (facultatif)</strong>, mais il n’est pas obligatoire.
    </p>
  </div>
</div>

<style>
  /* Ombre légère au survol */
  #bloc-faq:hover {
    box-shadow: 0 10px 28px rgba(245,158,11,.25);
  }

  /* Apparition douce au scroll */
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .faq-visible {
    animation: fadeUp 0.7s ease forwards;
  }
</style>

<script>
  /* Animation d’apparition au chargement */
  document.addEventListener("DOMContentLoaded", function(){
    const faq = document.getElementById("bloc-faq");
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          faq.classList.add("faq-visible");
        }
      });
    }, { threshold: 0.3 });
    observer.observe(faq);
  });
</script>
<!-- /FAQ -->

   <!-- Mentions -->
<div class="content-card">
  <div id="mentions-legales-container">
    <span id="mentions-legales-link">Mentions légales</span>
  </div>
  <hr class="sep">
</div>

<!-- Popup (inchangée, peut rester en dehors) -->
<div id="mentions-popup" role="dialog" aria-modal="true" aria-labelledby="mentions-title">
  <button id="close-mentions" type="button" aria-label="Fermer">&times;</button>
  <strong id="mentions-title">Mentions légales :</strong><br>
  Solution Solaire Pro webmaster marque de Biofrance Energies<br>
  SIRET : 422 231 928 00025<br>
  Adresse : 4 rue du Pont Saint Jean, 27530 Ézy-sur-Eure<br>
  Contact : solutionsolairepro@gmail.com<br>
  Hébergeur : GitHub Pages, 88 Colin P. Kelly Jr. Street, San Francisco, CA 94107, USA<br>
  Données personnelles : Les informations saisies sont utilisées uniquement pour traiter votre demande. Aucun démarchage ni revente.<br>
  RGPD : Vous pouvez demander la suppression de vos données à tout moment par simple email.
</div>


    
 

  <!-- Overlay calcul -->
  <div id="calc-overlay" role="alertdialog" aria-modal="true" aria-labelledby="calc-title" aria-describedby="calc-desc">
    <div class="panel" tabindex="-1">
      <div class="spinner" aria-hidden="true"></div>
      <h3 id="calc-title" class="title">Calcul en cours…</h3>
      <p id="calc-desc" class="desc">Nous générons votre estimation (quelques secondes).</p>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    /* Compteur local : animation d'arrivée + incrément sur vraie simulation */
    document.addEventListener("DOMContentLoaded", () => {
      const el = document.getElementById('compteurValeur');
      const start = 0, end = 250, duration = 800, t0 = performance.now();
      function anim(t){
        const p = Math.min(1,(t - t0) / duration), e = 1 - (1 - p)*(1 - p);
        el.textContent = Math.round(start + (end - start) * e).toLocaleString('fr-FR');
        if(p < 1) requestAnimationFrame(anim);
      }
      requestAnimationFrame(anim);

      // Mentions légales
      const link = document.getElementById('mentions-legales-link');
      const popup = document.getElementById('mentions-popup');
      const closeBtn = document.getElementById('close-mentions');
      if (link && popup && closeBtn) {
        link.onclick = (e)=>{ e.preventDefault(); popup.style.display='block'; };
        closeBtn.onclick = (e)=>{ e.preventDefault(); popup.style.display='none'; };
      }

      // Conso avancée
      const lienAvance = document.getElementById('lienAvance');
      if (lienAvance) {
        lienAvance.onclick = function(e){
          e.preventDefault();
          document.getElementById('modeAvance').style.display='block';
          this.style.display='none';
        };
      }

      // Format tel FR
      const telUnlock = document.getElementById('telUnlock');
      if(telUnlock){
        telUnlock.addEventListener('input', function(e){
          let val = e.target.value.replace(/\D/g,'').slice(0,10);
          e.target.value = val.replace(/(\d{2})(?=\d)/g,'$1 ').trim();
        });
      }

      ['emailUnlock','telUnlock'].forEach(id=>{
        const el = document.getElementById(id);
        if(el){
          el.addEventListener('keydown', (ev)=>{
            if(ev.key === 'Enter'){ ev.preventDefault(); ev.stopPropagation(); }
          });
        }
      });
    });

    function incrementCompteur(){
      const el = document.getElementById('compteurValeur'); if(!el) return;
      const cur = parseInt(el.textContent.replace(/\s/g,''),10) || 0;
      el.textContent = (cur + 1).toLocaleString('fr-FR');
    }

    /* Helpers masquage */
    function hideAfterSimulationBlocks(){ document.querySelectorAll('[data-hide-after-sim]').forEach(el => el.style.display='none'); }
    function showAfterSimulationBlocks(){ document.querySelectorAll('[data-hide-after-sim]').forEach(el => el.style.display=''); }

    /* Persistance unlock */
    const qs = new URLSearchParams(location.search);
    const UNLOCK_KEY = 'pv_unlock_until_v3';
    const FORCE_LOCK = qs.get('lock') === '1';

    function esc(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    let scenarios = [];
    let selectedScenario = null;

    function isUnlocked(){ if (FORCE_LOCK) return false; try{ return Date.now() < parseInt(localStorage.getItem(UNLOCK_KEY)||'0',10);}catch(e){return false;} }
    function setUnlocked(hours){ if (FORCE_LOCK) return; try{ localStorage.setItem(UNLOCK_KEY, String(Date.now()+(hours||24)*3600*1000)); }catch(e){} }
    function unlockUI(){
      const lc = document.getElementById('lockedContent'); if(lc){ lc.style.filter='none'; lc.style.userSelect='auto'; lc.style.pointerEvents='auto'; }
      const veil = document.getElementById('veil'); if(veil){ veil.style.display='none'; }
    }

    function showCalcOverlay(msg){
      const ov = document.getElementById('calc-overlay'); if(!ov) return;
      if (msg) { const t = ov.querySelector('#calc-title'); if (t) t.textContent = msg; }
      ov.style.display='flex'; document.body.classList.add('no-scroll'); ov.querySelector('.panel')?.focus();
    }
    function hideCalcOverlay(){ const ov = document.getElementById('calc-overlay'); if(!ov) return; ov.style.display='none'; document.body.classList.remove('no-scroll'); }

    function fetchScenarios(departement){
      return fetch('https://script.google.com/macros/s/AKfycbwhlyD_FMMm2g9JIQAm2Se2xehUqIM2MzWMl1YGl_gP1DJKM_-jZFj_YStDMhWi-0F8XA/exec')
        .then(r=>r.json())
        .then(data=>data.filter(row=>String(row.Departement||'')==String(departement)).map(row=>({
          prixKwh: parseFloat((row.PrixKwh||'').toString().replace(',', '.').replace(/[^0-9.]/g,'')),
          puissance: row.Puissance,
          prod: parseFloat(row.Prod),
          seuil: parseFloat(row.Seuil),
          panels: parseInt(row.Panels),
          prix: parseFloat(row.Prix),
          remiseChantier: parseFloat((row.RemiseChantier||'').toString().replace(',', '.').replace(/[^0-9.]/g,'')),
          mensualite: parseFloat(row.Mensualite),
          taeg: parseFloat(row.Taeg),
          total: parseFloat(row.Total),
          dureeMois: parseInt(row.Mois)
        })))
        .catch(_=>{ alert("Impossible de charger les données, réessayez plus tard."); return []; });
    }

    async function calculerSimulation(){
      const btn = document.getElementById('simuler');
      if(btn){ btn.disabled=true; btn.style.opacity='0.7'; }
      showCalcOverlay('Calcul en cours…');
      try{
        ['recap','lockedSection'].forEach(id=>{
          const el=document.getElementById(id);
          el.style.display='none'; el.style.visibility='hidden'; el.style.height='0';
          if(id==='lockedSection'){ const lc=document.getElementById('lockedContent'); if(lc) lc.innerHTML=''; const v=document.getElementById('veil'); if(v) v.style.display=''; }
        });

        const codePostal = document.getElementById('codePostal').value.trim();
        const facture = parseFloat((document.getElementById('facture').value + '').replace(',', '.'));
        const consoInput = document.getElementById('conso');

        if(!/^[0-9]{5}$/.test(codePostal)){ alert("Veuillez entrer un code postal valide."); return; }
        if(isNaN(facture) || facture<=0){ alert("Merci de remplir correctement tous les champs."); return; }

        const departement = codePostal.substring(0,2);
        const data = await fetchScenarios(departement);
        if(data.length===0){ alert("Aucune donnée disponible pour ce département."); return; }
        scenarios = data;

        let conso, prixKwh, consommationEstimee, consoReelleVal="", sourceConso="estimee";
        if(consoInput && consoInput.value){
          const v = parseFloat((consoInput.value + '').replace(',', '.'));
          if(isNaN(v) || v<=0){ alert("Merci d’indiquer une consommation kWh correcte."); return; }
          conso = v; prixKwh = facture / conso; consommationEstimee = conso; consoReelleVal = Math.round(v); sourceConso = "reelle";
        }else{
          prixKwh = scenarios[0].prixKwh; consommationEstimee = facture / prixKwh; conso = consommationEstimee;
        }

        const minProd = Math.min(...scenarios.map(s=>s.prod));
        if(consommationEstimee < minProd){ alert("Consommation trop faible : installation non conseillée."); return; }
        let scenario = scenarios.filter(s=>s.prod <= consommationEstimee).sort((a,b)=>b.prod - a.prod)[0];
        if(!scenario) scenario = scenarios.sort((a,b)=>b.prod - a.prod)[0];
        selectedScenario = scenario;

        const autoKwh = scenario.prod * 0.6;
        const stockKwh = scenario.prod * 0.4;
        const acheminement = 0.05;

        const factureAvant = conso * prixKwh;
        const autoValue = autoKwh * prixKwh;
        const stockValue = stockKwh * prixKwh;
        const coutAcheminement = stockKwh * acheminement;

        const factureApres = factureAvant - autoValue - stockValue + coutAcheminement;
        const economieAnnuelle = factureAvant - factureApres;
        const economieMensuelle = economieAnnuelle / 12;

        let gain15ans = 0, prixActuel = prixKwh;
        for(let i=0;i<15;i++){
          const autoVal = autoKwh * prixActuel, stockVal = stockKwh * prixActuel, coutAch = stockKwh * acheminement;
          const factureAv = conso * prixActuel, factureAp = factureAv - autoVal - stockVal + coutAch;
          gain15ans += (factureAv - factureAp); prixActuel *= 1.05;
        }

        const taegTxt = Number.isFinite(scenario.taeg) ? scenario.taeg.toFixed(2) + " %" : "—";
        const mensualiteTxt = Number.isFinite(scenario.mensualite) ? scenario.mensualite.toLocaleString('fr-FR',{minimumFractionDigits:2,maximumFractionDigits:2}) + " €" : "—";
        const totalTxt = Number.isFinite(scenario.total) ? scenario.total.toLocaleString('fr-FR',{minimumFractionDigits:2,maximumFractionDigits:2}) + " €" : "—";
        const dureeTxt = Number.isFinite(scenario.dureeMois) ? scenario.dureeMois + " mois" : "—";

        /* Récap (dans carte) */
        const recapEl = document.getElementById('recap');
        const libConso = (sourceConso === "reelle") ? "Conso annuelle (réelle)" : "Conso annuelle estimée";
        recapEl.innerHTML = `
          <h2>Votre estimation personnalisée</h2>
          <div class="recap-grid">
            <div class="recap-item"><div class="label">Code postal</div><div class="value">${esc(codePostal)}</div></div>
            <div class="recap-item"><div class="label">${libConso}</div><div class="value value-ok">${Math.round(conso).toLocaleString('fr-FR')} kWh</div></div>
            <div class="recap-item"><div class="label">Prix kWh TTC utilisé</div><div class="value">${prixKwh.toFixed(3)} €</div></div>
            <div class="recap-item"><div class="label">Facture annuelle</div><div class="value">${facture.toLocaleString('fr-FR')} €</div></div>
            <div class="recap-item" style="grid-column:1/-1">
              <div class="label">Puissance & production</div>
              <div class="value value-ok" style="font-size:18px">
                ${esc(scenario.puissance)} — ${scenario.panels} panneaux (500 W) • ${scenario.prod.toLocaleString('fr-FR')} kWh/an
              </div>
            </div>
          </div>`;
        recapEl.style.display='block'; recapEl.style.visibility='visible'; recapEl.style.height='auto';

        /* Contenu verrouillé */
        const locked = document.getElementById('lockedContent');
        const pctCouverture = ((scenario.prod / conso) * 100).toFixed(2);
        locked.innerHTML = `
          <div style="max-width:720px;margin:0 auto 12px">
            <div class="recap-item" style="border:1px solid var(--border);border-radius:12px;padding:12px 14px;background:#fff;margin-bottom:10px">
              <div class="label">% de votre conso couverte</div>
              <div class="value value-ok">${pctCouverture} %</div>
            </div>
            <span class="note">Votre production est valorisée à 100 % grâce à la batterie virtuelle, même si elle ne couvre pas 100 % de votre consommation.</span>
            <div style="text-align:center;color:#9ca3af;font-size:11px;margin-top:6px;font-style:italic">Hypothèse standard : exposition Sud/Sud, pente de toit 35°</div>
          </div>

          <div class="kpi">
            <div class="kpi-box"><strong>Gain estimé la 1ʳᵉ année :</strong> <b>${Math.round(economieAnnuelle).toLocaleString('fr-FR')} €</b></div>
          </div>
          <div class="kpi-box"><strong>Soit un gain par mois de :</strong> <b>${Math.round(economieMensuelle).toLocaleString('fr-FR')} €</b></div>
          <div class="kpi-box"><strong>Économie cumulée sur 15 ans :</strong> <b>${Math.round(gain15ans).toLocaleString('fr-FR')} €</b></div>

          <div style="border-top:1px solid var(--border);margin:10px 0 12px"></div>

          <div>
            <div style="font-weight:800;color:#111827;margin-bottom:10px">Ce que nous vous proposons</div>
            <ul style="list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:10px">
              <li><b>Remplacer votre facture par un investissement</b><br>Une partie de votre budget électricité finance votre installation solaire.</li>
              <li><b>Autofinancement simple</b><br>Les économies générées couvrent votre mensualité.</li>
              <li><b>Mensualité fixe</b><br><span style="display:inline-block;padding:2px 10px;border-radius:999px;background:var(--accent-soft);border:1px solid #fed7aa;font-weight:900;color:#1b1202">${mensualiteTxt}</span> &nbsp;hors assurance.</li>
              <li><b>Protégez-vous des hausses</b><br>Devenez propriétaire de votre production et sécurisez vos coûts.</li>
            </ul>
          </div>

          <div style="background:#fffbeb;border:1px solid #fde68a;border-radius:14px;padding:16px;text-align:center;margin:12px 0">
            <div style="color:#92400e;font-weight:800;font-size:1.05rem;margin-bottom:6px">Offre spéciale “Groupage chantiers”</div>
            <div style="display:flex;justify-content:center;align-items:center;gap:10px;font-size:1.2rem;font-weight:800;color:#1b1202;margin-bottom:2px">
              <span style="display:inline-block;background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#1b1202;padding:8px 14px;border-radius:999px;font-weight:900;box-shadow:0 6px 16px rgba(245,158,11,.25);">
                ${Number.isFinite(scenario.remiseChantier) ? scenario.remiseChantier.toLocaleString('fr-FR') : "—"} €
              </span>
              <span>de remise immédiate</span>
            </div>
            <div style="font-size:.92rem;color:#374151;margin-bottom:6px">(à déduire du prix TTC affiché ci-dessous)</div>
            <div style="font-size:.92rem;color:#6b7280">Offre valable jusqu’au <strong>31 octobre 2025</strong> — Places limitées</div>
          </div>

          <div style="background:#fff;border-left:4px solid var(--accent);border-radius:12px;padding:14px;margin-top:10px;color:#1f2937;border:1px solid var(--border)">
            <div style="margin-bottom:10px;line-height:1.55">
              <div style="margin-bottom:6px">
                <span style="font-weight:700;color:#111827">Installation ${esc(scenario.puissance)} :</span>
                <span style="display:inline-block;background:#111827;color:#fff;padding:2px 8px;border-radius:999px;font-weight:700;margin-left:6px">${scenario.prix.toLocaleString('fr-FR')} € TTC</span>
                <span style="color:#6b7280;font-size:.9em;margin-left:8px">(prix indicatif hors options)</span>
              </div>
              <div style="font-weight:700;color:#0b61d8;margin-bottom:4px">Option financement <span style="color:#6b7280;font-weight:600">(facultatif)</span></div>
              <div>
                <span style="display:inline-block;background:#111827;color:#fff;padding:2px 8px;border-radius:999px;font-weight:700">${mensualiteTxt}</span> / mois (hors assurance)
                • Durée : <span style="display:inline-block;background:#111827;color:#fff;padding:2px 8px;border-radius:999px;font-weight:700">${dureeTxt}</span>
                • TAEG fixe : <span style="display:inline-block;background:#111827;color:#fff;padding:2px 8px;border-radius:999px;font-weight:700">${taegTxt}</span>
              </div>
              <div style="margin-top:6px">Prix total : <span style="display:inline-block;background:#111827;color:#fff;padding:2px 8px;border-radius:999px;font-weight:700">${totalTxt}</span></div>
              <div style="margin-top:6px;color:#374151">Financement proposé par notre partenaire Projexio, sous réserve d’acceptation.</div>
            </div>
            <div style="color:#6b7280;font-size:12px">⚠️ Un crédit vous engage et doit être remboursé. Vérifiez vos capacités de remboursement avant de vous engager.</div>
            <div style="color:#6b7280;font-size:12px;margin-top:6px">Estimation indicative. Une visite technique est nécessaire pour un devis ferme.</div>
          </div>
        `;

        const section = document.getElementById('lockedSection');
        section.style.display='block'; section.style.visibility='visible'; section.style.height='auto';

        // Conversion Ads
        if(!window.__simConvSent){ gtag_report_simulation(); window.__simConvSent = true; }

        // Compteur local : +1 (simulation réelle)
        incrementCompteur();

        // Masquer les blocs “avant sim”
        hideAfterSimulationBlocks();

        if(isUnlocked()) { unlockUI(); }

        // Envoi anonyme
        const fd = new FormData();
        fd.append("code_postal", codePostal);
        fd.append("conso", Math.round(conso));
        fd.append("conso_reelle", consoReelleVal);
        fd.append("source_conso", sourceConso);
        fd.append("facture", facture);
        fd.append("prod", scenario.prod);
        fd.append("eco1", Math.round(economieAnnuelle));
        fd.append("ecomensuelle", Math.round(economieMensuelle));
        fd.append("eco15", Math.round(gain15ans));
        fd.append("puissance", scenario.puissance);
        fd.append("panneaux", scenario.panels);
        fd.append("prix", scenario.prix);
        fd.append("mensualite", Number.isFinite(scenario.mensualite) ? scenario.mensualite : "");
        fd.append("taeg", Number.isFinite(scenario.taeg) ? scenario.taeg : "");
        fd.append("totalcredit", Number.isFinite(scenario.total) ? scenario.total : "");
        fd.append("mois", Number.isFinite(scenario.dureeMois) ? scenario.dureeMois : "");
        fd.append("email", ""); fd.append("tel", "");
        fd.append("emailUser", ""); fd.append("telephone", "");
        fd.append("unlock", "0");

        const ads = (typeof __getAdsTrack === 'function') ? __getAdsTrack() : {};
        fd.append('utm_source',    ads.utm_source    || '');
        fd.append('utm_medium',    ads.utm_medium    || '');
        fd.append('utm_campaign',  ads.utm_campaign  || '');
        fd.append('utm_adgroup',   ads.utm_adgroup   || '');
        fd.append('utm_term',      ads.utm_term      || '');
        fd.append('utm_matchtype', ads.utm_matchtype || '');
        fd.append('utm_device',    ads.utm_device    || '');
        fd.append('gclid',         ads.gclid         || '');
        fd.append('gbraid',        ads.gbraid        || '');
        fd.append('wbraid',        ads.wbraid        || '');

        fetch('https://script.google.com/macros/s/AKfycbwhlyD_FMMm2g9JIQAm2Se2xehUqIM2MzWMl1YGl_gP1DJKM_-jZFj_YStDMhWi-0F8XA/exec',{method:'POST',mode:'no-cors',body:fd});

      } finally {
        hideCalcOverlay();
        const btn = document.getElementById('simuler'); if(btn){ btn.disabled=false; btn.style.opacity='1'; }
      }
    }

    function submitUnlock(e){
      if(e){ e.preventDefault(); e.stopPropagation(); }
      const email = (document.getElementById('emailUnlock').value||'').trim();
      const tel = (document.getElementById('telUnlock').value||'').replace(/\D/g,'');
      const consent = document.getElementById('rgpdUnlock').checked;
      if(email && !/^\S+@\S+\.\S+$/.test(email)) { alert("Email invalide."); return; }
      if(!tel || tel.length<10){ alert("Téléphone invalide (10 chiffres)."); return; }
      if(!consent){ alert("Merci de cocher la case de consentement."); return; }
      if(!selectedScenario){ alert("Veuillez d’abord lancer une simulation."); return; }

      const codePostal = document.getElementById('codePostal').value.trim();
      const facture = parseFloat((document.getElementById('facture').value + '').replace(',', '.'));

      const consoInput = document.getElementById('conso');
      let conso, prixKwh, consoReelleVal="", sourceConso="estimee";
      if (consoInput && consoInput.value) {
        const v = parseFloat((consoInput.value + '').replace(',', '.'));
        if (!isNaN(v) && v > 0) { conso=v; prixKwh=facture/conso; consoReelleVal=Math.round(v); sourceConso="reelle"; }
      }
      if (!conso) { prixKwh = selectedScenario.prixKwh; conso = facture / prixKwh; }

      const autoKwh = selectedScenario.prod * 0.6;
      const stockKwh = selectedScenario.prod * 0.4;
      const acheminement = 0.05;

      const factureAvant = conso * prixKwh;
      const autoValue = autoKwh * prixKwh;
      const stockValue = stockKwh * prixKwh;
      const coutAcheminement = stockKwh * acheminement;

      const factureApres = factureAvant - autoValue - stockValue + coutAcheminement;
      const economieAnnuelle = factureAvant - factureApres;
      const economieMensuelle = economieAnnuelle / 12;

      let gain15ans = 0, prixActuel = prixKwh;
      for (let i=0;i<15;i++){
        const autoVal = autoKwh * prixActuel;
        const stockVal = stockKwh * prixActuel;
        const coutAch = stockKwh * acheminement;
        const factureAv = conso * prixActuel;
        const factureAp = factureAv - autoVal - stockVal + coutAch;
        gain15ans += (factureAv - factureAp);
        prixActuel *= 1.05;
      }

      const recapHTML  = document.getElementById('recap')?.outerHTML || "";
      const resultHTML = document.getElementById('lockedContent')?.outerHTML || "";

      const fd = new FormData();
      fd.append("code_postal", codePostal);
      fd.append("conso", Math.round(conso));
      fd.append("conso_reelle", consoReelleVal);
      fd.append("source_conso", sourceConso);
      fd.append("facture", facture);
      fd.append("prod", selectedScenario.prod);
      fd.append("eco1", Math.round(economieAnnuelle));
      fd.append("ecomensuelle", Math.round(economieMensuelle));
      fd.append("eco15", Math.round(gain15ans));
      fd.append("puissance", selectedScenario.puissance);
      fd.append("panneaux", selectedScenario.panels);
      fd.append("prix", selectedScenario.prix);
      fd.append("mensualite", Number.isFinite(selectedScenario.mensualite) ? selectedScenario.mensualite : "");
      fd.append("taeg", Number.isFinite(selectedScenario.taeg) ? selectedScenario.taeg : "");
      fd.append("totalcredit", Number.isFinite(selectedScenario.total) ? selectedScenario.total : "");
      fd.append("mois", Number.isFinite(selectedScenario.dureeMois) ? selectedScenario.dureeMois : "");
      fd.append("email", email); fd.append("tel", tel);
      fd.append("emailUser", email); fd.append("telephone", tel);
      fd.append("unlock", "1");
      fd.append("sendEmail",  email ? "1" : "0");
      fd.append("recapHTML",  recapHTML);
      fd.append("resultHTML", resultHTML);

      const ads = (typeof __getAdsTrack === 'function') ? __getAdsTrack() : {};
      fd.append('utm_source',    ads.utm_source    || '');
      fd.append('utm_medium',    ads.utm_medium    || '');
      fd.append('utm_campaign',  ads.utm_campaign  || '');
      fd.append('utm_adgroup',   ads.utm_adgroup   || '');
      fd.append('utm_term',      ads.utm_term      || '');
      fd.append('utm_matchtype', ads.utm_matchtype || '');
      fd.append('utm_device',    ads.utm_device    || '');
      fd.append('gclid',         ads.gclid         || '');
      fd.append('gbraid',        ads.gbraid        || '');
      fd.append('wbraid',        ads.wbraid        || '');

      fetch('https://script.google.com/macros/s/AKfycbwhlyD_FMMm2g9JIQAm2Se2xehUqIM2MzWMl1YGl_gP1DJKM_-jZFj_YStDMhWi-0F8XA/exec',{method:'POST',mode:'no-cors',body:fd});

      try{ gtag('event','unlock_report',{method:'overlay'}); gtag_report_conversion(); }catch(e){}
      unlockUI(); setUnlocked(24);
    }
  </script>

  <!-- Consent Mode – logique bandeau -->
  <script>
    (function(){
      const KEY='consent_v2';
      const banner=document.getElementById('consent-banner');
      const btnAccept=document.getElementById('consent-accept');
      const btnReject=document.getElementById('consent-reject');

      function updateConsent(state){
        gtag('consent','update',{
          analytics_storage:   state.analytics ? 'granted' : 'denied',
          ad_storage:          state.ads ? 'granted' : 'denied',
          ad_user_data:        state.adUserData ? 'granted' : 'denied',
          ad_personalization:  state.adPersonal ? 'granted' : 'denied'
        });
      }
      function save(s){ try{ localStorage.setItem(KEY, JSON.stringify(s)); }catch(e){} }
      function load(){ try{ return JSON.parse(localStorage.getItem(KEY)||'null'); }catch(e){ return null; } }

      const saved=load();
      if(saved){ updateConsent(saved); banner.style.display='none'; }
      else{
        banner.style.display='block'; banner.style.opacity='0'; banner.style.transform='translateY(10px)';
        requestAnimationFrame(()=>{ banner.style.transition='opacity .18s ease, transform .18s ease'; banner.style.opacity='1'; banner.style.transform='translateY(0)'; });
      }

      btnAccept.addEventListener('click', ()=>{ const s={analytics:true,ads:true,adUserData:true,adPersonal:true}; updateConsent(s); save(s); banner.style.display='none'; });
      btnReject.addEventListener('click', ()=>{ const s={analytics:false,ads:false,adUserData:false,adPersonal:false}; updateConsent(s); save(s); banner.style.display='none'; });
    })();
  </script>

  <!-- Trace UTM/GCLID -->
  <script>
    (function(){
      const p = new URLSearchParams(location.search);
      const track = {
        utm_source:(p.get('utm_source')||''), utm_medium:(p.get('utm_medium')||''), utm_campaign:(p.get('utm_campaign')||''),
        utm_adgroup:(p.get('utm_adgroup')||''), utm_term:(p.get('utm_term')||''), utm_matchtype:(p.get('utm_matchtype')||''),
        utm_device:(p.get('utm_device')||''), gclid:(p.get('gclid')||''), gbraid:(p.get('gbraid')||''), wbraid:(p.get('wbraid')||'')
      };
      const isAds = track.gclid || track.gbraid || track.wbraid ||
                    (track.utm_source.toLowerCase()==='google' && track.utm_medium.toLowerCase()==='cpc');
      if(isAds){ try{ localStorage.setItem('ads_tracking_v1', JSON.stringify({ t: Date.now(), ...track })); }catch(e){} }
      window.__getAdsTrack = function(){
        try{
          const raw = localStorage.getItem('ads_tracking_v1'); if(!raw) return track;
          const obj = JSON.parse(raw); if(Date.now()-(obj.t||0) > 7*24*60*60*1000) return track; return obj;
        }catch(e){ return track; }
      };
    })();
  </script>

</body>
</html>
